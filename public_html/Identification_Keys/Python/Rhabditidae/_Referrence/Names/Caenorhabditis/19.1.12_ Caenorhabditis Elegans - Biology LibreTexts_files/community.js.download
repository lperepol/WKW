!function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function n(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,l,"next",e)}function l(e){t(o,i,a,s,l,"throw",e)}s(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,n){return(d=u()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&c(i,n.prototype),i}).apply(null,arguments)}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var g="undefined"==typeof window?"node":"browser",v={get environment(){return g},base64:{encode:function(e){return"node"===g?new Buffer(e).toString("base64"):window.btoa(e)},decode:function(e){return"node"===g?new Buffer(e,"base64").toString("utf8"):window.atob(e)}},get URL(){return"browser"===g?window.URL:require("url").URL},get URLSearchParams(){return"browser"===g?window.URLSearchParams:require("url").URLSearchParams},get defaultHost(){return"browser"===g?window.location.origin:global.__DefaultMindTouchHost||""}};function y(e){if(!e.headers.has("location"))return!1;var t=e.status;return 301===t||302===t||303===t||307===t||308===t}function b(e){var t=this;return new Promise((function(n,r){var i=y(e);i&&t._followRedirects&&null!==t._cookieManager?n(e):!i||t._followRedirects?e.ok||304===e.status?n(e):e.text().then((function(t){r({message:e.statusText,status:e.status,responseText:t})})):n(e)}))}function w(e){return null!==this._cookieManager?this._cookieManager.getCookieString(e.url).then((function(t){""!==t&&e.headers.set("Cookie",t)})).then((function(){return e})):Promise.resolve(e)}function _(e){if(null!==this._cookieManager){var t=e.headers.getAll?e.headers.getAll("Set-Cookie"):e.headers.get("Set-Cookie").split(",");return this._cookieManager.storeCookies(e.url,t).then((function(){return e}))}return Promise.resolve(e)}function k(e){var t=this,n=e.url,r=e.method,i=e.headers,a=e.body,o=void 0===a?null:a,s=new Headers(i),l=o,c={method:r,headers:s,credentials:"include",redirect:this._followRedirects&&null===this._cookieManager?"follow":"manual",keepalive:this._keepAlive};null!==o&&(c.body=l);var u=new Request(n,c);return w.call(this,u).then(this._fetch).then(b.bind(this)).then(_.bind(this)).then((function(e){return t._followRedirects&&y(e)?k.call(t,{url:e.headers.get("location"),method:307!==e.status&&308!==e.status?"GET":u.method,headers:s,body:l}):e}))}function P(e){for(var t=function e(t){return t.reduce((function(t,n){return Array.isArray(n)?t+=e(n):("/"===n[0]&&(n=n.slice(1)),t+="/".concat(n)),t}),"")},n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=t(r),o=e.pathname;"/"===o&&(o=""),e.pathname="".concat(o).concat(a)}function T(e,t){"q=+%2B"!==new v.URLSearchParams({q:" +"}).toString()?Object.keys(t).forEach((function(n){var r=t[n].toString().includes(" ")?t[n].split(" ").map(encodeURIComponent).join(" "):t[n];e.searchParams.append(n,r)})):Object.keys(t).forEach((function(n){e.searchParams.append(n,t[n])}))}var S=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.uriParts,a=void 0===i?{}:i,o=n.headers,s=void 0===o?{}:o,l=n.timeout,c=void 0===l?null:l,u=n.beforeRequest,d=void 0===u?function(e){return e}:u,h=n.cookieManager,m=void 0===h?null:h,f=n.followRedirects,p=void 0===f||f,g=n.keepAlive,y=void 0!==g&&g,b=n.fetchImpl,w=void 0===b?fetch:b;if(r(this,e),!t)throw new Error("A full, valid URL must be specified");try{this._url=new v.URL(t)}catch(e){throw new Error("Unable to construct a URL object from ".concat(t))}"segments"in a&&P(this._url,a.segments),"query"in a&&T(this._url,a.query),"excludeQuery"in a&&this._url.searchParams.delete(a.excludeQuery),this._beforeRequest=d,this._timeout=c,this._headers=Object.assign({},s),this._cookieManager=m,this._followRedirects=p,this._keepAlive=y,this._fetch=w}return a(e,[{key:"at",value:function(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.push(t.toString())})),new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{segments:e},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withParam",value:function(e,t){var n={};return n[e]=t,new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{query:n},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{query:e},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withoutParam",value:function(e){return new this.constructor(this._url.toString(),{headers:this._headers,timeout:this._timeout,beforeRequest:this._beforeRequest,uriParts:{excludeQuery:e},cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withHeader",value:function(e,t){var n=Object.assign({},this._headers);return n[e]=t,new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:n,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withHeaders",value:function(e){var t=Object.assign({},this._headers);return Object.keys(e).forEach((function(n){t[n]=e[n]})),new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:t,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withoutHeader",value:function(e){var t=Object.assign({},this._headers);return delete t[e],new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:t,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withFollowRedirects",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:!0,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withoutFollowRedirects",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:!1,keepAlive:this._keepAlive,fetchImpl:this._fetch})}},{key:"withKeepAlive",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:!0,fetchImpl:this._fetch})}},{key:"withoutKeepAlive",value:function(){return new this.constructor(this._url.toString(),{timeout:this._timeout,beforeRequest:this._beforeRequest,headers:this._headers,cookieManager:this._cookieManager,followRedirects:this._followRedirects,keepAlive:!1,fetchImpl:this._fetch})}},{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=this._beforeRequest({url:this._url.toString(),method:e,headers:Object.assign({},this._headers)});return k.call(this,t)}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",r=Object.assign({},this._headers);t&&(r["Content-Type"]=t);var i=this._beforeRequest({url:this._url.toString(),method:n,body:e,headers:r});return k.call(this,i)}},{key:"put",value:function(e,t){return this.post(e,t,"PUT")}},{key:"head",value:function(){return this.get("HEAD")}},{key:"options",value:function(){return this.get("OPTIONS")}},{key:"delete",value:function(){return this.post(null,null,"DELETE")}},{key:"url",get:function(){return this._url.toString()}},{key:"headers",get:function(){return new Headers(this._headers)}},{key:"followingRedirects",get:function(){return this._followRedirects}}]),e}(),E=v.defaultHost,C=null,x={"dream.out.format":"json"},R={"X-Deki-Client":"mindtouch-martian"},j=null,A=null;function I(e){var t={};return Object.keys(e).forEach((function(n){t[n]=e[n]})),t}var N=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.host,i=void 0===n?E:n,a=t.queryParams,o=void 0===a?x:a,s=t.headers,l=void 0===s?R:s,c=t.token,u=void 0===c?j:c,d=t.origin,h=void 0===d?C:d;r(this,e),this._host=i,this._token=u,this._origin=h,this._queryParams=I(o),this._headers=I(l)}return a(e,null,[{key:"cookieManager",get:function(){return A},set:function(e){A=e}},{key:"default",get:function(){return{get token(){return j},set token(e){j=e},get host(){return E},set host(e){E=e},get origin(){return C},set origin(e){C=e},get headers(){return R},set headers(e){R=e},get queryParams(){return x},set queryParams(e){x=e},reset:function(){E=v.defaultHost,x={"dream.out.format":"json"},j=null,R={"X-Deki-Client":"mindtouch-martian"},C=null}}}}]),a(e,[{key:"_beforeRequest",value:function(e){if(null!==this._token){var t=this._token;"function"==typeof t&&(t=this._token()),e.headers["X-Deki-Token"]=t}return e}},{key:"host",get:function(){return this._host}},{key:"token",get:function(){return this._token}},{key:"origin",get:function(){return this._origin}},{key:"plugConfig",get:function(){var e=this;return{uriParts:{query:this._queryParams},headers:this._headers,beforeRequest:function(t){return e._beforeRequest(t)},cookieManager:A}}}]),e}(),D={to:{boolean:function(e){return!0===e||"true"===e||"True"===e},date:function(e){var t=new Date(e);if(isNaN(t.getTime()))throw new Error("Failed converting to date");return t},apiDate:function(e){if(!/^\d{8}$|^\d{14}$/.test(e))throw new Error("Failed converting an API date: The raw value must be a string of digits and of length 8 or 14");var t=[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,12),e.slice(12)].map((function(e){return parseInt(e,10)})).filter((function(e){return!isNaN(e)}));return t[1]--,d(Date,p(t))},number:function(e){if("number"==typeof e)return e;if("string"!=typeof e||""===e)return null;var t=Number(e);if(Number.isNaN(t))throw new Error("Failed converting to integer");return t}},isValid:function(e){return void 0!==e},forceArray:function(e){return D.isValid(e)&&""!==e?Array.isArray(e)?e:[e]:[]},getValue:function(t){if(t&&"object"===e(t)){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=r.shift();if(a in t){var o=1===r.length&&"#text"===r[0]&&"string"==typeof t[a];return 0===r.length||o?t[a]:D.getValue.apply(D,[t[a]].concat(r))}}},processModelAndData:function(e,t){var n=null,r=null;return e&&e.model?(n=e.preProcessor,r=e.model):r=e,"function"==typeof n&&(t=n(t)),[r,t]},transformValue:function(e,t){var n=e;if("string"==typeof t)n=D.to[t](e);else if(Array.isArray(t)||t.model){var r=f(D.processModelAndData(t,e),2),i=r[0],a=r[1];n=D.createParser(i)(a)}else{if("function"!=typeof t)throw new Error("Invalid value used for the transform parameter while trying to convert ".concat(e));n=t(e)}return n},parseProperty:function(t,n,r){var i=r.field,a=r.name,o=r.isArray,s=r.transform,l=r.constructTransform;if(!t||"object"!==e(t))throw new TypeError("Cannot parse a non-object");if(void 0===i)throw new TypeError("The 'field' property must be included in every model entry");var c=D.forceArray(i),u=D.getValue.apply(D,[t].concat(p(c)));if(l&&"function"==typeof l){s=l(u);var d=f(D.processModelAndData(s,u),2);s=d[0],u=d[1]}if(o&&(u=D.forceArray(u)),(s&&D.isValid(u)||"function"==typeof s)&&(u=o?u.map((function(e){return D.transformValue(e,s)})):D.transformValue(u,s)),(a=a||c[0])in n)throw new Error('Duplicate "'.concat(a,'" in parsing model'));D.isValid(u)&&(n[a]=u)},createParser:function(e){return function(t){""===t&&(t={});var n=f(D.processModelAndData(e,t),2),r=n[0],i=n[1],a={};return r.forEach((function(e){return D.parseProperty(i,a,e)})),a}}},L=[{field:"context",name:"contextIds",isArray:!0}],F={preProcessor:function(e){return e.context?e.context:e},model:[{field:"description"},{field:"id"}]},q=[{field:"@date",name:"date",transform:"date"},{field:"@count",name:"count",transform:"number"},{field:"@seated.count",name:"seatedCount",transform:"number"},{field:"@unseated.count",name:"unseatedCount",transform:"number"},{field:"@anonymous.count",name:"anonymousCount",transform:"number"},{field:"@score",name:"score",transform:"number"},{field:"@seated.score",name:"seatedScore",transform:"number"},{field:"@unseated.score",name:"unseatedScore",transform:"number"},{field:"@anonymous.score",name:"anonymousScore",transform:"number"},{field:"@score.trend",name:"scoreTrend",transform:"number"},{field:"@seated.score.trend",name:"seatedScoreTrend",transform:"number"},{field:"@unseated.score.trend",name:"unseatedScoreTrend",transform:"number"},{field:"user.ratedby",name:"userRatedBy",transform:[{field:"@id",name:"id",transform:"number"},{field:"@score",name:"score",transform:"number"},{field:"@date",name:"date",transform:"date"},{field:"@href",name:"href"},{field:"@seated",name:"seated",transform:"boolean"}]}],M=[{field:["operations","#text"],transform:function(e){var t=[];return"string"==typeof e&&(t=e.split(",")),t}},{field:"role",transform:function(t){var n={};return"string"==typeof t?n.name=t:t&&"object"===e(t)&&("#text"in t&&(n.name=t["#text"]),"@id"in t&&(n.id=parseInt(t["@id"],10)),"@href"in t&&(n.href=t["@href"])),n}},{field:"restriction",transform:[{field:"@id",name:"id",transform:"number"},{field:"#text",name:"name"}]}],z=[{field:"@id",name:"id",transform:"number"},{field:"@href",name:"href"},{field:"groupname",name:"groupName"},{field:"permissions.group",name:"groupPermissions",transform:M},{field:"users",transform:[{field:"@count",name:"count"},{field:"@href",name:"href"}]}],O=[{field:"@id",name:"id",transform:"number"},{field:"@anonymous",name:"anonymous",transform:"boolean"},{field:"@wikiid",name:"wikiId"},{field:"@href",name:"href"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.lastlogin",name:"lastLoginDate",transform:"date"},{field:"email"},{field:"fullname"},{field:["license.seat","#text"],name:"seated",transform:"boolean"},{field:["license.seat","@owner"],name:"siteOwner",transform:"boolean"},{field:"nick"},{field:["password","@exists"],name:"passwordExists",transform:"boolean"},{field:"status"},{field:"username"},{field:"permissions.user",name:"userPermissions",transform:M},{field:["groups","group"],name:"groups",isArray:!0,transform:z}],U=[{field:"@id",name:"id",transform:"number"},{field:"title"},{field:"@guid",name:"guid"},{field:"uri.ui",name:"uri"},{field:"@href",name:"href"},{field:"@state",name:"state"},{field:"@draft.state",name:"draftState"},{field:"article"},{field:"language"},{field:"namespace"},{field:"language.effective",name:"languageEffective"},{field:"timeuuid"},{field:["path","#text"]},{field:["path","@type"],name:"pathType"},{field:["path","@seo"],name:"pathSeo",transform:"boolean"},{field:"restriction"},{field:"@revision",name:"revision",transform:"number"},{field:"path.original",name:"originalPath",transform:function(e){if(e)return decodeURIComponent(e)}},{field:"@deleted",name:"deleted",transform:"boolean"},{field:"@publish",name:"publish",transform:"boolean"},{field:"@unpublish",name:"unpublish",transform:"boolean"},{field:"@deactivate",name:"deactivate",transform:"boolean"},{field:"@virtual",name:"virtual",transform:"boolean"},{field:"@subpages",name:"hasSubpages",transform:"boolean"},{field:"@files",name:"files",transform:"number"},{field:"@terminal",name:"terminal",transform:"boolean"},{field:"overview"},{field:"user.author",name:"userAuthor",transform:O},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.modified",name:"dateModified",transform:"date"},{field:"date.edited",name:"dateEdited",transform:"date"},{field:["revisions","@count"],name:"revisionCount",transform:"number"},{field:["comments","@count"],name:"commentCount",transform:"number"},{field:["permissions","permissions.page"],name:"permissions",transform:M},{field:["security","permissions.effective"],name:"effectivePermissions",transform:M},{field:"rating",constructTransform:function(t){if("object"===e(t)&&null!==t)return q}},{field:"metrics",transform:[{field:"metric.charcount",name:"charCount",transform:"number"},{field:"metric.views",name:"views",transform:"number"}]},{field:["tags","tag"],isArray:!0,transform:[{field:"@href",name:"href"},{field:"@id",name:"id",transform:"number"},{field:"@value",name:"value"},{field:"title"},{field:"type"},{field:"uri"}]}];U.push({field:"page.parent",name:"pageParent",transform:U}),U.push({field:"draft",transform:U});var B=[{field:"@default",name:"default",transform:"boolean"},{field:"@exists",name:"exists",transform:"boolean"},{field:"description"},{field:"id"},{field:"language"},{field:"page",transform:U},{field:["pageid","#text"],transform:"number"}],H=[{field:"contextmap",name:"contextMaps",isArray:!0,transform:B},{field:["languages","language"],isArray:!0}],W={preProcessor:function(e){if("responseText"in e){try{e.errorInfo=JSON.parse(e.responseText)}catch(t){e.errorText=e.responseText}delete e.responseText}return e},model:[{field:"status"},{field:"message"},{field:"errorInfo",name:"info",transform:[{field:["arguments","argument"],name:"arguments",isArray:!0},{field:"exception"},{field:"message"},{field:"resource"},{field:"data"}]},{field:"errorText"}]},V=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;if(r(this,e),!t)throw new Error("an ID must be supplied to create a new ContextDefinition");this.id=t,this.plug=new S(n.host,n.plugConfig).at("@api","deki","contexts",t)}return a(e,[{key:"getInfo",value:function(){return this.plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(F))}},{key:"updateDescription",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="<context><id>".concat(this.id,"</id><description>").concat(e,"</description></context>");return this.plug.put(t,"application/xml; charset=utf-8").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(F))}},{key:"delete",value:function(){return this.plug.delete().catch((function(e){return Promise.reject(e)}))}}]),e}(),K=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N;if(r(this,e),!n||!t)throw new Error("an ID and language must be supplied to create a new ContextMap");this.id=n,this.language=t,this.plug=new S(i.host,i.plugConfig).at("@api","deki","contextmaps",t,n).withParam("verbose","true")}return a(e,[{key:"getInfo",value:function(){return this.plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(B))}},{key:"update",value:function(e){if(!e)return Promise.reject(new Error("a page ID must be supplied in order to update a mapping"));var t="<contextmap><id>".concat(this.id,"</id><pageid>").concat(e,"</pageid><language>").concat(this.language,"</language></contextmap>");return this.plug.put(t,"application/xml; charset=utf-8").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(B))}},{key:"remove",value:function(){return this.plug.delete().catch((function(e){return Promise.reject(e)}))}}]),e}(),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this.mapsPlug=new S(t.host,t.plugConfig).at("@api","deki","contextmaps").withParam("verbose","true"),this.definitionsPlug=new S(t.host,t.plugConfig).at("@api","deki","contexts"),this._settings=t,this._errorParser=D.createParser(W)}return a(e,[{key:"getMaps",value:function(){return this.mapsPlug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(H))}},{key:"getDefinitions",value:function(){return this.definitionsPlug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then((function(e){return""===e&&(e={context:[]}),e})).then(D.createParser(L))}},{key:"addDefinition",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e)return Promise.reject(new Error("an ID must be supplied to add a definition"));var r="<contexts><context><id>".concat(e,"</id><description>").concat(n,"</description></context></contexts>");return this.definitionsPlug.post(r,"application/xml; charset=utf-8").catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(D.createParser(F))}},{key:"getDefinition",value:function(e){return new V(e,this._settings)}},{key:"getMap",value:function(e,t){return new K(e,t,this._settings)}}]),e}(),Q=Object.freeze({ContextDefinition:V,ContextMap:K,ContextIdManager:G}),Y={"<":"lt",">":"gt",'"':"quot","&":"amp","'":"#39"},J=new RegExp("".concat(Object.keys(Y).reduce((function(e,t){return"".concat(e).concat(t)}),"["),"]"),"g"),X="application/xml; charset=utf-8",Z="text/plain; charset=utf-8",ee="application/json; charset=utf-8",te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(J,(function(e){return"&"+Y[e]+";"}))},ne=function(e){var t=e.toString();return["\\","+","-","&","|","!","(",")","{","}","[","]","^",'"',"~","*","?",":"].forEach((function(e){var n=new RegExp("\\"+e,"g");t=t.replace(n,"\\"+e)})),t},re=function(e,t){if(!e&&!t)throw new Error("Unable to resolve the input ID to an API resource ID");var n=t;return"string"==typeof e&&e!==t?n="=".concat(encodeURIComponent(encodeURIComponent(e))):e&&(n=e),n},ie=function(e){var t=null;if("string"==typeof e)t=e.includes(":")?e:"=".concat(encodeURIComponent(encodeURIComponent(e)));else{if("number"!=typeof e)throw new Error("The user activity token must be a string or number");t=e}return t},ae=function(e){var t={year:e.getFullYear(),month:"0".concat(e.getMonth()+1).slice(-2),day:"0".concat(e.getDate()).slice(-2),hours:"0".concat(e.getHours()).slice(-2),minutes:"0".concat(e.getMinutes()).slice(-2),seconds:"0".concat(e.getSeconds()).slice(-2)};return"".concat(t.year).concat(t.month).concat(t.day).concat(t.hours).concat(t.minutes).concat(t.seconds)},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&""!==e[t]||delete e[t]})),e},se=[{field:"@id",name:"id",transform:"number"},{field:"@type",name:"type"},{field:"@date",name:"date",transform:"date"},{field:"host"},{field:"key"},{field:"name"},{field:"secret"}],le=[{field:"@count",name:"count",transform:"number"},{field:"developer-token",name:"developerTokens",isArray:!0,transform:se}],ce=D.createParser(W),ue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","site","developer-tokens")}return a(e,[{key:"getTokens",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(le))}},{key:"addToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.host,r=e.type,i=void 0===r?"server":r;if(!t)return Promise.reject(new Error("The name must be supplied when adding a new developer token"));var a='<developer-token type="'.concat(i,'"><name>').concat(t,"</name>");return n&&(a+="<host>".concat(n,"</host>")),a+="</developer-token>",this._plug.post(a,X).catch((function(e){return Promise.reject(ce(e))})).then((function(e){return e.json()})).then(D.createParser(se))}}]),e}(),de=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;if(r(this,e),!t)throw new Error("The id must be supplied to create a new DeveloperToken instance");this._plug=new S(n.host,n.plugConfig).at("@api","deki","site","developer-tokens",t)}return a(e,[{key:"delete",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(ce(e))}))}}]),e}(),he=Object.freeze({DeveloperTokenManager:ue,DeveloperToken:de});function me(e){var t=e.xhr,n=e.body,r=e.progressInfo;return new Promise((function(e,i){t.onreadystatechange=function(){4===t.readyState&&(t.status>=200&&t.status<=300?(r.callback({loaded:r.size,total:r.size}),e(t)):i({message:t.statusText,status:t.status,responseText:t.responseText}))},t.onerror=function(){i(new Error("An error occurred while initiating the file upload"))},t.send(n)}))}function fe(e){return null!==this._cookieManager?this._cookieManager.getCookieString(this.url).then((function(t){""!==t&&e.xhr.setRequestHeader("Cookie",t)})).then((function(){return e})):Promise.resolve(e)}function pe(e){return null!==this._cookieManager?this._cookieManager.storeCookies(this.url,e.getResponseHeader("Set-Cookie")).then((function(){return e})):Promise.resolve(e)}function ge(e){var t=e.method,n=e.headers,r=e.body,i=void 0===r?null:r,a=e.progressInfo,o=new XMLHttpRequest;o.open(t,this.url,!0),o.withCredentials=!0,o.upload.onprogress=function(e){a.callback({loaded:e.loaded,total:a.size})};for(var s=Object.entries(n),l=0;l<s.length;l++){var c=f(s[l],2),u=c[0],d=c[1];o.setRequestHeader(u,d)}var h={xhr:o,body:i,progressInfo:a};return a.callback({loaded:0,total:a.size}),fe.call(this,h).then(me).then(pe.bind(this))}var ve=function(e){function t(e,n){return r(this,t),h(this,l(t).call(this,e,n))}return s(t,e),a(t,[{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:0,callback:function(){}};t&&(this._headers["Content-Type"]=t);var i=this._beforeRequest({method:n,body:e,headers:Object.assign({},this._headers)});return i.progressInfo=r,ge.call(this,i)}},{key:"put",value:function(e,t,n){return this.post(e,t,"PUT",n)}}]),t}(S),ye=[{field:"@type",name:"type"},{field:"@title",name:"title"},{field:"@unsafe",name:"unsafe",transform:"boolean"},{field:"@draft",name:"draft",transform:"boolean"},{field:"head"},{field:"tail"},{field:"body",transform:function(e){return Array.isArray(e)?e[0]:e}},{field:"body",name:"targets",transform:function(e){var t=[];if(Array.isArray(e))for(var n=1;n<e.length;n++)t.push(o({},e[n]["@target"],e[n]["#text"]));return t}}],be=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"tag",name:"tags",isArray:!0,transform:[{field:"@id",name:"id",transform:"number"},{field:"@value",name:"value"},{field:"@href",name:"href"},{field:"title"},{field:"type"},{field:"uri"}]}],we=[{field:"@id",name:"id",transform:"number"},{field:"@revision",name:"revision",transform:"number"},{field:"@res-id",name:"resId",transform:"number"},{field:"@href",name:"href"},{field:"@res-is-head",name:"resIsHead",transform:"boolean"},{field:"@res-is-deleted",name:"resIsDeleted",transform:"boolean"},{field:"@res-rev-is-head",name:"resRevIsHead",transform:"boolean"},{field:"@res-contents-id",name:"resContentsId",transform:"number"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"date.last-modified",name:"lastModified",transform:"date"},{field:"description"},{field:"filename"},{field:"location"},{field:"contents",transform:[{field:"@type",name:"type"},{field:"@size",name:"size",transform:"number"},{field:"@href",name:"href"},{field:"@height",name:"height",transform:"number"},{field:"@width",name:"width",transform:"number"}]},{field:"revisions",transform:[{field:"@count",name:"count",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"}]},{field:"user.createdby",name:"userCreatedBy",transform:O},{field:"page.parent",name:"pageParent",transform:U}],_e=[{field:"@count",name:"count",transform:"number"},{field:"@offset",name:"offset",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"file",name:"files",isArray:!0,transform:we}],ke=[{field:"@status",name:"status"},{field:"page",transform:U},{field:"draft",transform:U},{field:"page.base",name:"pageBase",transform:U},{field:"page.overwritten",name:"pageOverwritten",transform:U}],Pe=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page",name:"pages",isArray:!0,transform:U}],Te=[{field:"#text",name:"text"},{field:"@needsmigration",name:"needsMigration",transform:"boolean"}],Se=[{field:"@type",name:"type"},{field:"#text",name:"combinedText"},{field:"combined"},{field:"before"},{field:"after"}],Ee=[{field:"tag",name:"tags",isArray:!0,transform:[{field:"@value",name:"tag"}]}],Ce=D.createParser(W);function xe(e){if(404===e.status&&e.responseText){var t=JSON.parse(e.responseText);if("true"===t["@virtual"]){var n=D.createParser(U);return Promise.resolve(n(t))}}throw e}function Re(e){var t="";return Array.isArray(e)&&e.forEach((function(e){t="".concat(t,'<tag value="').concat(te(e),'" />')})),t="<tags>".concat(t,"</tags>")}var je=function(){function e(t){if(r(this,e),"PageBase"===this.constructor.name)throw new TypeError("PageBase must not be constructed directly.  Use one of Page() or Draft()");this._id=re(t,"home")}var t;return a(e,[{key:"getFullInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=D.createParser(U);return this._plug.withParams(e).get().then((function(e){return e.json()})).then(t).catch(xe)}},{key:"getContents",value:function(e){var t=D.createParser(ye);return this._plug.at("contents").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"setContents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)return Promise.reject(new Error("Contents should be string."));var n={edittime:"now"};Object.keys(t).forEach((function(e){n[e]=t[e]}));var r=D.createParser(ke);return this._plug.at("contents").withParams(n).post(e,Z).catch((function(e){return Promise.reject(Ce(e))})).then((function(e){return e.json()})).then(r)}},{key:"getTableOfContents",value:(t=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getContents({});case 3:t=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:return n=null,t.targets&&(r=t.targets.find((function(e){return null!==e.toc})))&&"<em>No headers</em>"!==r.toc&&(n=r.toc),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return t.apply(this,arguments)})},{key:"getFiles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=D.createParser(_e);return this._plug.at("files").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"attachFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=void 0===n?e.name:n,i=t.size,a=void 0===i?e.size:i,o=t.type,s=void 0===o?e.type:o,l=t.progress,c=void 0===l?null:l;if(null!==c){var u=new ve(this._plug.url,this._settings.plugConfig),d={callback:c,size:a};return u.at("files",encodeURIComponent(encodeURIComponent(r))).put(e,s,d).catch((function(e){return Promise.reject(e)})).then((function(e){return JSON.parse(e.responseText)})).then(D.createParser(we))}return this._plug.withHeader("Content-Length",a).at("files",encodeURIComponent(r)).put(e,s).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()}))}},{key:"getOverview",value:function(){return this._plug.at("overview").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Te))}},{key:"setOverview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!("body"in e))return Promise.reject(new Error("No overview body was supplied"));var t="<overview>".concat(te(e.body),"</overview>");return this._plug.at("overview").put(t,X).catch((function(e){return Promise.reject(e)}))}},{key:"getTags",value:function(){var e=D.createParser(be);return this._plug.at("tags").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"setTags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Re(e),r=D.createParser(be);return this._plug.at("tags").withParams(t).put(n,"application/xml").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(r)}},{key:"getRecommendedTags",value:function(){return this._plug.at("tags","recommended").get().catch((function(e){return Promise.reject(Ce(e))})).then((function(e){return e.json()})).then(D.createParser(Ee))}},{key:"getDiff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.previous,n=e.revision,r=void 0===n?"head":n,i=e.includeVersions,a=void 0!==i&&i,o=e.format,s=void 0===o?"html":o;return t?"string"!=typeof t&&"number"!=typeof t?Promise.reject(new Error("The `previous` parameter must be a number or a string.")):"string"!=typeof r&&"number"!=typeof r?Promise.reject(new Error("The revision parameter must be a number or a string.")):"boolean"!=typeof a?Promise.reject(new Error("The `includeVersions` parameter must be a Boolean value.")):"html"!==s&&"xhtml"!==s?Promise.reject(new Error('The `format` parameter must be a string equal to "html" or "xhtml".')):this._plug.at("diff").withParams({previous:t,revision:r,diff:a?"all":"combined",format:s}).get().catch((function(e){return Promise.reject(Ce(e))})).then((function(e){return e.json()})).then(D.createParser(Se)):Promise.reject(new Error("The `previous` parameter must be supplied."))}},{key:"getRelated",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("related").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Pe))}},{key:"revert",value:function(e){if(!e)return Promise.reject(new Error("The revert options must be specified."));if("string"!=typeof e.fromRevision&&"number"!=typeof e.fromRevision)return Promise.reject(new Error("The fromRevision parameter must be specified, and must be a string or a number."));var t={fromrevision:e.fromRevision};if(e.abort){if("string"!=typeof e.abort||"never"!==e.abort&&"conflict"!==e.abort)return Promise.reject(new Error('The `abort` parameter must be set to "conflict" or "never".'));t.abort=e.abort}return"verbose"in e&&!0!==e.verbose&&!1!==e.verbose?Promise.reject(new Error("The `verbose` parameter must be a Boolean value.")):(t.allow=e.allow,t.abort=e.abort,this._plug.at("revert").withParams(t).post(null,Z).catch((function(e){return Promise.reject(e)})))}}]),e}(),Ae=D.createParser(W),Ie=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;return r(this,t),(e=h(this,l(t).call(this,n)))._settings=i,e._plug=new S(i.host,i.plugConfig).at("@api","deki","drafts",e._id),e}return s(t,e),a(t,[{key:"deactivate",value:function(){var e=D.createParser(U);return this._plug.at("deactivate").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"publish",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("publish").withParams(e).post().catch((function(e){return Promise.reject(e)}))}},{key:"unpublish",value:function(){return this._plug.at("unpublish").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(U))}},{key:"setTitle",value:function(e){return e?this._plug.at("title").put(e,Z).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(U)):Promise.reject(new Error("A valid title must be supplied for the draft."))}}]),t}(je),Ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._settings=t,this._plug=new S(this._settings.host,this._settings.plugConfig).at("@api","deki","drafts")}return a(e,[{key:"createDraft",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if("redirect"in t){if("number"!=typeof t.redirect)return Promise.reject(new Error("The redirect option must be a number."));n.redirect=t.redirect}if("deleteRedirects"in t){if("boolean"!=typeof t.deleteRedirects)return Promise.reject(new Error("The deleteredirects option must be a boolean."));n.deleteRedirects=t.deleteRedirects}return this._plug.at(re(e),"create").withParams(n).post().catch((function(e){return Promise.reject(Ae(e))})).then((function(e){return e.json()})).then(D.createParser(U))}},{key:"getDrafts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.parentId&&(t.parentid=re(e.parentId,"home")),e.tags){if(!Array.isArray(e.tags))return Promise.reject(new Error("The `tags` parameter must be an array."));t.tags=e.tags.join(",")}if("limit"in e){if("number"!=typeof e.limit)return Promise.reject(new Error("The `limit` parameter must be an number."));t.limit=e.limit}if(e.include){if(!Array.isArray(e.include))return Promise.reject(new Error("The `include` parameter must be an array."));t.include=e.include.join(",")}return this._plug.withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser([{field:["pages","page"],name:"pages",isArray:!0,transform:U}]))}},{key:"getDraft",value:function(e){return new Ie(e,this._settings)}}]),e}(),De=Object.freeze({Draft:Ie,DraftManager:Ne});function Le(e){var t=new Date(e),n=t.getDate();return n!=n?e:t}var Fe=[{field:"@id",name:"id",transform:"number"},{field:"@timestamp",transform:"date"},{field:"name"},{field:"title"}],qe=[{field:"@cascading",name:"cascading",transform:"boolean"},{field:"@datetime",name:"datetime",transform:"date"},{field:"@id",name:"id"},{field:"@journaled",name:"journaled",transform:"boolean"},{field:"@language",name:"language"},{field:"change-comment",name:"changeComment"},{field:"previous.restriction-id",name:"previousRestrictionId",transform:"number"},{field:"restriction-id",name:"restrictionId",transform:"number"},{field:"root.page",name:"rootPage",transform:U},{field:"@type",name:"type"},{field:"@version",name:"version",transform:"number"},{field:"to",transform:Le},{field:"from",transform:Le},{field:"afternode.page",name:"afternodePage",transform:U},{field:"displayname.current",name:"currentDisplayName"},{field:"displayname.previous",name:"previousDisplayName"},{field:"create-reason",name:"createReason"},{field:"source.page",name:"sourcePage",transform:U},{field:"page",transform:U},{field:"user",transform:O},{field:"file",transform:we},{field:"source.file",name:"sourceFile",transform:we},{field:"@move-source",name:"moveSource",transform:"boolean"},{field:"data",transform:[{field:"constraint"},{field:"path"},{field:"query"},{field:"limit",transform:"number"},{field:"qid",transform:"number"},{field:"totalrecommended",name:"totalRecommended",transform:"number"},{field:"totalresults",name:"totalResults",transform:"number"},{field:"_uri.host",name:"host"},{field:"_uri.query",name:"uriQuery"},{field:"_uri.scheme",name:"scheme"}]},{field:"diff",transform:[{field:"@toolarge",name:"tooLarge",transform:"boolean"},{field:"added",transform:"number"},{field:"attributes",transform:"number"},{field:"removed",transform:"number"},{field:"structural",transform:"number"},{field:"categorychanged",transform:"boolean"},{field:"pagesadded",transform:"number"},{field:"pagesremoved",transform:"number"},{field:"pagesreordered",transform:"boolean"},{field:"summarychanged",transform:"boolean"},{field:"titlechanged",transform:"boolean"}]},{field:"grant",transform:[{field:"group",transform:z},{field:"id",transform:"number"},{field:"role",transform:[{field:"@id",name:"id",transform:"number"}]},{field:"type"},{field:"user",transform:O}]},{field:"property",transform:[{field:"name"}]},{field:"request",transform:[{field:"@count",name:"count",transform:"number"},{field:"@id",name:"id"},{field:"@seq",name:"seq",transform:"number"},{field:"ip"},{field:"session-id",name:"sessionId"},{field:"signature"},{field:"user",transform:O}]},{field:["tags-added","tag"],name:"tagsAdded",isArray:!0,transform:[{field:"name"}]},{field:["tags-removed","tag"],name:"tagsRemoved",isArray:!0,transform:[{field:"name"}]},{field:"learningpath",name:"learningPath",transform:Fe},{field:"root.learningpath",name:"learningPathRoot",transform:Fe}],Me=[{field:"@count",name:"count",transform:"number"},{field:"@upto",name:"upTo"},{field:"@since",name:"since"},{field:"event",name:"events",isArray:!0,transform:qe}],ze=[{field:"@count",name:"count",transform:"number"},{field:"@upto",name:"upTo"},{field:"@since",name:"since"},{field:"summary",isArray:!0,transform:[{field:"@id",name:"id"},{field:"@datetime",name:"datetime",transform:"date"},{field:"@count",name:"count",transform:"number"},{field:"@detailid",name:"detailId"},{field:"@journaled",name:"journaled",transform:"boolean"},{field:"@diffable",name:"diffable",transform:"boolean"},{field:"@uri.detail",name:"detailUri"},{field:"@uri.hierarchy",name:"hierarchyUri"},{field:"event",transform:qe},{field:"page",transform:[{field:"@id",name:"id",transform:"number"},{field:"path"}]},{field:["users","user"],name:"users",isArray:!0,transform:O}]}],Oe=[{field:"@count",name:"count",transform:"number"},{field:"event",name:"events",isArray:!0,transform:qe}],Ue=[{field:"log",name:"logs",isArray:!0,transform:[{field:"@complete",name:"complete",transform:"boolean"},{field:"modified",transform:"date"},{field:"month"},{field:"name"}]}],Be=[{field:"url"}],He=[{field:"id"}],We=D.createParser(W),$e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","events")}return a(e,[{key:"getSiteDraftsHistoryLogs",value:function(){return this._plug.at("draft-hierarchy","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ue))}},{key:"getSiteDraftsHistoryLogUrl",value:function(e){return e?this._plug.at("draft-hierarchy","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Be)):Promise.reject(new Error("Attempting to get log url without required name"))}},{key:"getSiteDraftsHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.limit){if("number"!=typeof e.limit)return Promise.reject(new Error("The `limit` parameter must be a number less than or equal to 1000."));t.limit=e.limit}if(e.include){if(!Array.isArray(e.include))return Promise.reject(new Error("The `include` parameter must be an array."));t.include=e.include.join(",")}if(e.upTo){if("string"!=typeof e.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));t.upto=e.upTo}return this._plug.at("draft-hierarchy",re(e.pageId,"home")).withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getSiteDraftsHistoryDetail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return Promise.reject(new Error("The detail ID must be specified, and it must be a string."));var n={};if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` option must be an array"));n.include=t.include.join(",")}return this._plug.at("draft-hierarchy","details",e).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getDraftHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));n.limit=t.limit}if(t.upTo){if("string"!=typeof t.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));n.upto=t.upTo}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}return this._plug.at("draft",re(e,"home")).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getDraftHistoryDetail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return Promise.reject(new Error("The page ID is required to fetch a draft history detail."));if(!t)return Promise.reject(new Error("The detail ID is required to fetch a draft history detail."));var r={};if(n.include){if(!Array.isArray(n.include))return Promise.reject(new Error("The `include` parameter must be an array."));r.include=n.include.join(",")}return this._plug.at("draft",re(e,"home"),t).withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Oe))}},{key:"getLearningPathHistory",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return Promise.reject(new Error("The learning path ID must be supplied, and must be a string"));var n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));n.limit=t.limit}if(t.upTo){if("string"!=typeof t.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));n.upto=t.upTo}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}return this._plug.at("learningpath",re(e)).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getSiteHistoryLogs",value:function(){return this._plug.at("page-hierarchy","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ue))}},{key:"getSiteHistoryLogUrl",value:function(e){return e?this._plug.at("page-hierarchy","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Be)):Promise.reject(new Error("Attempting to get log url without required name"))}},{key:"getSiteHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.limit){if("number"!=typeof e.limit)return Promise.reject(new Error("The `limit` parameter must be a number less than or equal to 1000."));t.limit=e.limit}if(e.include){if(!Array.isArray(e.include))return Promise.reject(new Error("The `include` parameter must be an array."));t.include=e.include.join(",")}if(e.upTo){if("string"!=typeof e.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));t.upto=e.upTo}return this._plug.at("page-hierarchy",re(e.pageId,"home")).withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getSiteHistoryDetail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return Promise.reject(new Error("The detail ID must be specified, and it must be a string."));var n={};if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` option must be an array"));n.include=t.include.join(",")}return this._plug.at("page-hierarchy","details",e).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"logPageView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.event,i=void 0===r?null:r,a=n.keepAlive,o=void 0!==a&&a,s=this._plug.at("page-view",re(e,"home"));return i&&(s=s.at(i)),o&&(s=s.withKeepAlive()),s.post(JSON.stringify(t),ee).catch((function(e){return Promise.reject(e)}))}},{key:"getPageHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number less than or equal to 1000."));n.limit=t.limit}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}if(t.upTo){if("string"!=typeof t.upTo)return Promise.reject(new Error("The `upTo` parameter must be a string."));n.upto=t.upTo}return this._plug.at("page",re(e,"home")).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getPageHistoryDetail",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return Promise.reject(new Error("The page ID is required to fetch a page history detail."));if(!t)return Promise.reject(new Error("The detail ID is required to fetch a page history detail."));var r={};if(n.include){if(!Array.isArray(n.include))return Promise.reject(new Error("The `include` parameter must be an array."));r.include=n.include.join(",")}return this._plug.at("page",re(e,"home"),t).withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Oe))}},{key:"logSearch",value:function(e,t){return this._plug.at("search",re(e,"current")).post(JSON.stringify(t),ee).catch((function(e){return Promise.reject(e)}))}},{key:"getUserActivityLogs",value:function(){return this._plug.at("support-agent","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ue))}},{key:"getUserActivityLogUrl",value:function(e){return e?this._plug.at("support-agent","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Be)):Promise.reject(new Error("Attempting to get log url without required name"))}},{key:"getUserActivity",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject(new Error("The user activity token must be supplied"));try{t=ie(e)}catch(e){return Promise.reject(e)}var r={};if(n.limit){if("number"!=typeof n.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));r.limit=n.limit}if(n.include){if(!Array.isArray(n.include))return Promise.reject(new Error("The `include` parameter must be an array."));r.include=n.include.join(",")}if(n.upTo){if("string"!=typeof n.upTo&&!(n.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be a string or a Date."));n.upTo instanceof Date?r.upto=ae(n.upTo):r.upto=n.upTo}return this._plug.at("support-agent",t).withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Me))}},{key:"getUserHistory",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(t.limit){if("number"!=typeof t.limit)return Promise.reject(new Error("The `limit` parameter must be a number."));n.limit=t.limit}if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}if(t.upTo){if("string"!=typeof t.upTo&&!(t.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be a string or a Date."));t.upTo instanceof Date?n.upto=ae(t.upTo):n.upto=t.upTo}return this._plug.at("user-page",re(e,"current")).withParams(n).get().catch((function(e){return Promise.reject(We(e))})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"getUserHistoryDetail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject(new Error("The detail ID must be supplied"));var n={};if(t.include){if(!Array.isArray(t.include))return Promise.reject(new Error("The `include` parameter must be an array."));n.include=t.include.join(",")}return this._plug.at("user-page","current",e).withParams(n).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ze))}},{key:"logWebWidgetImpression",value:function(){return this._plug.at("web-widget-impression").post().catch((function(e){return Promise.reject(e)}))}},{key:"logFormInit",value:function(e){var t={type:e};return this._plug.at("form-init").post(JSON.stringify(t),ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(He))}},{key:"logFormSubmit",value:function(e,t){var n={type:t};return this._plug.at("form-submit",e).post(JSON.stringify(n),ee).catch((function(e){return Promise.reject(e)}))}},{key:"logInteractionAnalytics",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.datetime,i=void 0===r?new Date:r,a=n.keepAlive,o=void 0!==a&&a,s=n.pageId,l=void 0===s?null:s,c=n.url,u=void 0===c?null:c,d=this._plug.at("interaction");o&&(d=d.withKeepAlive()),l&&(d=d.at(re(l,"home")));var h={_datetime:i.toISOString(),location:e,action:t};return u&&(h._uri=u),d.post(JSON.stringify(h),ee).catch((function(e){return Promise.reject(e)}))}}]),e}(),Ve=[{field:"@id",name:"id",transform:"number"},{field:"name",name:"name"},{field:"url",name:"url"}],Ke=[{field:"external-report",name:"external-reports",isArray:!0,transform:Ve}],Ge=[{field:"@id",name:"id",transform:"number"},{field:"@uri",name:"uri"}];function Qe(){return function(e){return Array.isArray(e)?[]:["".concat(e," is not an array")]}}function Ye(e){return function(t){return t===e?[]:["".concat(t," does not equal ").concat(e)]}}function Je(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=[],r=0;r<t.length;r++){var i,a=t[r](e);if(0===a.length){n=[];break}(i=n).push.apply(i,p(a))}return n}}function Xe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=[];return t.forEach((function(t){var r=t(e);r.length>0&&n.push.apply(n,p(r))})),n}}function Ze(e,t){return function(n){return void 0===n[e]?[]:t?t(n[e]):[]}}function et(e,t){return function(n){return void 0===n[e]?["The value of ".concat(e," is not defined")]:t?t(n[e]):[]}}function tt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return p(t).concat(p(n(e)))}),[])}function nt(e,t){return t(e)}var rt={get object(){return tt},get value(){return nt}},it=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","site","external-reports")}return a(e,[{key:"getExternalReports",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ke))}},{key:"getExternalReport",value:function(e){return e&&Number.isInteger(e)?this._plug.get(e).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ve)):Promise.reject(new Error("Must submit a numeric id of an external report."))}},{key:"getExternalReportExternalUri",value:function(e){return e&&Number.isInteger(e)?this._plug.at(e,"external-uri").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ge)):Promise.reject(new Error("Must submit a numeric id of an external report."))}},{key:"createExternalReport",value:function(e){if(!e)return Promise.reject(new Error("Unable to create an external report without data."));var t=rt.object(e,et("url",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),et("name",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));return t.length>0?Promise.reject(new Error(t)):this._plug.post(e).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ve))}},{key:"updateExternalReport",value:function(e){if(!e)return Promise.reject(new Error("Unable to create an external report without data."));var t=rt.object(e,et("url",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),et("name",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));return t.length>0?Promise.reject(new Error(t)):this._plug.put(e.id,e).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ve))}},{key:"deleteExternalReport",value:function(e){return e&&Number.isInteger(e)?this._plug.at(e).delete().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ve)):Promise.reject(new Error("Must submit a numeric id of an external report."))}}]),e}(),at=[{field:"@count",name:"count",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"file",isArray:!0,transform:we}],ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;r(this,e),this._id=t,this._settings=n,this._plug=new S(n.host,n.plugConfig).at("@api","deki","files",t),this._progressPlug=new ve(n.host,n.plugConfig).at("@api","deki","files",t),this._errorParser=D.createParser(W)}return a(e,[{key:"getInfo",value:function(){var e=D.createParser(we);return this._plug.at("info").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"getRevisions",value:function(){return this._plug.at("revisions").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(at))}},{key:"setDescription",value:function(e){var t=D.createParser(we);return this._plug.at("description").put(e,Z).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"delete",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"addRevision",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=void 0===n?e.name:n,i=t.size,a=void 0===i?e.size:i,o=t.type,s=void 0===o?e.type:o,l=t.progress,c=void 0===l?null:l;if(null!==c){var u={callback:c,size:a};return this._progressPlug.at(re(r)).put(e,s,u).catch((function(e){return Promise.reject(e)})).then((function(e){return JSON.parse(e.responseText)})).then(D.createParser(we))}return this._plug.withHeader("Content-Length",a).at(re(r)).put(e,s).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(we))}},{key:"move",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.to?t.name?this._plug.at("move").withParams(t).post(null,Z).catch((function(t){return Promise.reject(e._errorParser(t))})).then((function(e){return e.json()})).then(D.createParser(we)):Promise.reject(new Error("The `name` parameter must be specified to move a file.")):Promise.reject(new Error("The `to` parameter must be specified to move a file."))}}]),e}(),st=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;return r(this,t),(n=h(this,l(t).call(this,e,i)))._plug=n._plug.withParam("draft","true"),n._progressPlug=n._progressPlug.withParam("draft","true"),n}return s(t,e),t}(ot),lt=Object.freeze({File:ot,FileDraft:st}),ct=[{field:"@count",name:"count",transform:"number"},{field:"@querycount",name:"queryCount",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"group",name:"groups",isArray:!0,transform:z}],ut=[{field:"@count",name:"count",transform:"number"},{field:"@querycount",name:"queryCount",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@href",name:"href"},{field:"user",name:"users",isArray:!0,transform:O}];function dt(){return"undefined"==typeof document?new(0,require("jsdom").JSDOM)("...").window.document.implementation.createDocument("","",null):document.implementation.createDocument("","",null)}var ht=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;if(r(this,e),!t)throw new Error("A group ID must be supplied");this._id=re(t),this._groupPlug=new S(n.host,n.plugConfig).at("@api","deki","groups",this._id),this._errorParser=D.createParser(W)}return a(e,[{key:"getInfo",value:function(){return this._groupPlug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(z))}},{key:"getUsers",value:function(e){return this._groupPlug.at("users").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ut))}},{key:"removeUser",value:function(e){var t=this;return this._groupPlug.at("users",re(e,"current")).delete().catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(D.createParser(z))}},{key:"delete",value:function(){return this._groupPlug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"setRole",value:function(e){var t=this,n=e.name,r=dt(),i=r.createElement("group"),a=r.createElement("permissions.group"),o=r.createElement("role");return o.textContent=n,a.appendChild(o),i.appendChild(a),this._groupPlug.put(i.outerHTML,X).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(D.createParser(z))}}]),e}(),mt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this.plug=new S(t.host,t.plugConfig).at("@api","deki","groups"),this.settings=t}return a(e,[{key:"getGroupList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if("nameFilter"in e){if("string"!=typeof e.nameFilter)return Promise.reject(new Error("The group name filter must be a string"));""!==e.nameFilter&&(t.groupnamefilter=e.nameFilter)}if("authProvider"in e){if("number"!=typeof e.authProvider)return Promise.reject(new Error("The auth provider ID must be a number"));t.authprovider=e.authProvider}if("limit"in e){if("number"!=typeof e.limit&&"all"!==e.limit)return Promise.reject(new Error('The limit parameter must be a number or "all"'));t.limit=e.limit}if("offset"in e){if("number"!=typeof e.offset)return Promise.reject(new Error("The offset parameter must be a number"));t.offset=e.offset}if("sortBy"in e){if("string"!=typeof e.sortBy)return Promise.reject(new Error("The sortBy option must be a string"));var n=["id","name","role","service","-id","-name","-role","-service"];if(!n.includes(e.sortBy))return Promise.reject(new Error("The sortBy option must be one of ".concat(n.join(", "))));t.sortby=e.sortBy}return this.plug.withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(ct))}},{key:"getGroup",value:function(e){return new ht(e,this.settings)}}]),e}(),ft=Object.freeze({Group:ht,GroupManager:mt}),pt=[{field:"@name",name:"name"},{field:"@editable",name:"editable",transform:"boolean"},{field:"@revision",name:"revision",transform:"number"},{field:"edittime",name:"editTime"},{field:"title"},{field:"summary"},{field:"category"},{field:"uri.learningpath",name:"uri"},{field:"pages",isArray:!0,transform:U}],gt=[{field:"learningpath",name:"learningPaths",isArray:!0,transform:pt}],vt=[{field:["categories","category"],name:"categories",isArray:!0}],yt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;r(this,e),this._name=t,this._plug=new S(n.host,n.plugConfig).at("@api","deki","learningpaths","=".concat(t))}return a(e,[{key:"getInfo",value:function(e){var t={};return e&&(t.revision=e),this._plug.withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pt))}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";if(!e)return Promise.reject("The content parameter must be supplied to update a learning path");if(!e.title||"string"!=typeof e.title||""===e.title)return Promise.reject("The title parameter must be supplied, and must be a non-empty string.");var n="<title>".concat(te(e.title),"</title>");if(e.summary){if("string"!=typeof e.summary)return Promise.reject("The summary parameter must be a string");n+="<summary>".concat(te(e.summary),"</summary>")}if(e.category){if("string"!=typeof e.category)return Promise.reject("The category parameter must be a string");n+="<category>".concat(te(e.category),"</category>")}if(e.pageIds){if(!Array.isArray(e.pageIds))return Promise.reject("The pages parameter must be an array");n+=e.pageIds.reduce((function(e,t){return e+"<pages>".concat(t,"</pages>")}),n)}var r="<learningpath>".concat(n,"</learningpath>");return this._plug.withParam("edittime",t).post(r,X).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pt))}},{key:"remove",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"clone",value:function(e){return"string"!=typeof e||""===e?Promise.reject("The new name for the clone must be a non-empty string."):this._plug.at("clone").withParam("name",e).post(null,Z).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pt))}},{key:"revertToRevision",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";return e?this._plug.at("revert").withParams({torevision:e,edittime:t}).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pt)):Promise.reject(new Error("The revision parameter is required"))}},{key:"addPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";return this._plug.at("pages",e).withParam("edittime",t).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(U))}},{key:"removePage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"now";return this._plug.at("pages",e).withParam("edittime",t).delete().catch((function(e){return Promise.reject(e)}))}},{key:"reorderPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"now";return this._plug.at("pages",e,"order").withParams({edittime:n,afterid:t}).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pt))}}]),e}(),bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this.settings=t,this._plug=new S(t.host,t.plugConfig).at("@api","deki","learningpaths")}return a(e,[{key:"getLearningPaths",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(gt))}},{key:"createLearningPath",value:function(e){return e?e.name&&"string"==typeof e.name&&""!==e.name?e.title&&"string"==typeof e.title&&""!==e.title?e.summary&&"string"!=typeof e.summary?Promise.reject(new Error("The `summary` parameter must be a string.")):e.category&&"string"!=typeof e.category?Promise.reject(new Error("The `category` parameter must be a string.")):this._plug.withParams(e).post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pt)):Promise.reject(new Error("The `title` parameter must be supplied, and must be a non-empty string.")):Promise.reject(new Error("The `name` parameter must be supplied, and must be a non-empty string.")):Promise.reject(new Error("Unable to create a learning path without data."))}},{key:"getCategories",value:function(){return this._plug.at("categories").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(vt))}},{key:"getLearningPath",value:function(e){return new yt(e,this.settings)}}]),e}(),wt=Object.freeze({LearningPath:yt,LearningPathManager:bt}),_t=[{field:"@name",name:"name"},{field:"@count",name:"count",transform:"number"}],kt=[{field:"@count",name:"count",transform:"number"},{field:"@date.start",name:"startDate",transform:"apiDate"},{field:"@date.expiration",name:"expirationDate",transform:"apiDate"},{field:"@anually-licensed-help-requests",name:"annuallyLicensedHelpRequests"},{field:"totals",isArray:!0,transform:[{field:"@date",name:"date",transform:"apiDate"},{field:["custom","origin"],name:"customRequests",isArray:!0,transform:_t},{field:["mt-requests","origin"],name:"mtRequests",isArray:!0,transform:_t}]}],Pt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","license")}return a(e,[{key:"getUsage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};if(e.since){if(!(e.since instanceof Date))return Promise.reject(new Error("The `since` parameter must be of type Date."));t.since=ae(e.since)}if(e.upTo){if(!(e.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be of type Date."));t.upto=ae(e.upTo)}return this._plug.at("usage").withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(kt))}},{key:"getUsageLogs",value:function(){return this._plug.at("usage","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ue))}},{key:"getUsageLogUrl",value:function(e){return e?this._plug.at("usage","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser([{field:"url"}])):Promise.reject(new Error("The log name must be supplied."))}}]),e}(),Tt=[{field:"@totalcount",name:"totalCount",transform:"number"},{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page.subpage",name:"subpages",isArray:!0,transform:U}],St=[{field:"@revision",name:"revision"},{field:"@name",name:"name"},{field:"@href",name:"href"},{field:"date.modified",name:"dateModified",transform:"date"},{field:"contents",transform:[{field:"#text",name:"text"},{field:"@href",name:"href"},{field:"@type",name:"type"},{field:"@size",name:"size"}]}],Et={preProcessor:function(e){if(e.page)return e.page},model:[{field:"@id",name:"id",transform:"number"},{field:"@guid",name:"guid"},{field:"@draft.state",name:"draftState"},{field:"@href",name:"href"},{field:"@deleted",name:"deleted",transform:"boolean"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"namespace",name:"namespace"},{field:["path","#text"],name:"path"},{field:"title",name:"title"},{field:"uri.ui",name:"uri"}]};Et.model.push({field:"subpages",isArray:!0,constructTransform:function(e){if(e.page)return Et}}),Et.model.push({field:"properties",isArray:!0,constructTransform:function(e){if(e)return{preProcessor:function(e){if(e.property)return e.property},model:St}}});var Ct=[{field:"@count",name:"count",transform:"number"},{field:"page",name:"pages",isArray:!0,transform:U}],xt=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page",name:"pages",isArray:!0,transform:U}],Rt=[{field:"@count",name:"count",transform:"number"},{field:"page",name:"pages",isArray:!0,transform:U}],jt=[{field:"uri.status",name:"statusUri"}],At=[{field:"uri.download",name:"downloadUri"}],It=[{field:"@count",name:"count",transform:"number"},{field:"@totalcount",name:"totalCount",transform:"number"},{field:"page",name:"pages",isArray:!0,transform:U}],Nt=[{field:"count",transform:"number"},{field:"querycount",name:"queryCount",transform:"number"},{field:"pages",isArray:!0,transform:[{field:"links",isArray:!0,transform:[{field:"@sequence",name:"sequence",transform:"number"},{field:"@isredirect",name:"isRedirect",transform:"boolean"},{field:"@isbroken",name:"isBroken",transform:"boolean"},{field:"class"},{field:"href"},{field:"rel"},{field:"text"},{field:"type"},{field:["destination","page"],name:"destinationPage",transform:U},{field:["destination","file"],name:"destinationFile",transform:we}]},{field:"page",transform:U}]}],Dt=[{field:"count",transform:"number"},{field:"querycount",name:"queryCount",transform:"number"},{field:"inspections",isArray:!0,transform:[{field:"@severity",name:"severity"},{field:"@type",name:"type"},{field:"message"},{field:"page",transform:[{field:"@uri",name:"uri"},{field:"@id",name:"id",transform:"number"},{field:"article"}]}]}],Lt=[{field:"@count",name:"count",transform:"number"},{field:"template",name:"templates",isArray:!0,transform:[{field:"description"},{field:"id",transform:"number"},{field:"path"},{field:"title"},{field:"articletype",name:"articleType"},{field:"createarticlewidgetflag",name:"createArticleWidgetFlag"}]}],Ft=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"page",name:"pages",isArray:"true",transform:U}],qt=[{field:"pagecount",name:"pageCount",transform:"number"},{field:"attachmentcount",name:"attachmentCount",transform:"number"}],Mt=[{field:"count",transform:"number"},{field:["linkdata","link"],name:"linkData",isArray:!0,transform:[{field:"caseid",name:"caseId"},{field:"pagetitle",name:"pageTitle"},{field:"pageuri",name:"pageUri"},{field:"linkcreatoruserid",name:"linkCreatorUserId",transform:"number"},{field:"linkdate",name:"linkDate",transform:"date"},{field:"pageid",name:"pageId",transform:"number"}]},{field:"total",transform:"number"}],zt=[{field:"@id",name:"id",transform:"number"},{field:"@guid",name:"guid"},{field:"@draft.state",name:"draftState"},{field:"@href",name:"href"},{field:"@deleted",name:"deleted",transform:"boolean"},{field:"date.created",name:"dateCreated",transform:"date"},{field:"language"},{field:["path","#text"]},{field:"title"},{field:"uri.ui",name:"uri"},{field:"files",name:"filesInfo",transform:_e},{field:"subpages",name:"subpagesInfo",transform:Tt}],Ot=D.createParser(W),Ut=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;return r(this,t),(e=h(this,l(t).call(this,n)))._settings=i,e._plug=new S(i.host,i.plugConfig).at("@api","deki","pages",e._id),e}return s(t,e),a(t,[{key:"getInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={exclude:"revision"};Object.keys(e).forEach((function(n){t[n]=e[n]}));var n=D.createParser(U);return this._plug.at("info").withParams(t).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(n)}},{key:"getSubpages",value:function(e){return this._plug.at("subpages").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Tt))}},{key:"getFilesAndSubpages",value:function(){return this._plug.at("files,subpages").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(zt))}},{key:"getTree",value:function(e){return this._plug.at("tree").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Et))}},{key:"getTreeIds",value:function(){return this._plug.at("tree").withParam("format","ids").get().catch((function(e){return Promise.reject(new Error(e.message))})).then((function(e){return e.text()})).then((function(e){return e.split(",").map((function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error("Unable to parse the tree IDs.");return t}))}))}},{key:"getRating",value:function(){return this._plug.at("ratings").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(q))}},{key:"rate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(1!==e&&0!==e&&null!==e)throw new Error("Invalid rating supplied");if(1!==t&&0!==t&&null!==t)throw new Error("Invalid rating supplied for the old rating");return null===e&&(e=""),null===t&&(t=""),this._plug.at("ratings").withParams({score:e,previousScore:t}).post(null,Z).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(q))}},{key:"getHtmlTemplate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.pageid=this._id;var n="="+encodeURIComponent(encodeURIComponent(e)),r=new S(this._settings.host,this._settings.plugConfig).at("@api","deki","pages",n,"contents").withParams(t),i=D.createParser(ye);return r.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(i)}},{key:"copy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.to?this._plug.at("copy").withParams(e).post(null,Z).catch((function(e){return Promise.reject(Ot(e))})).then((function(e){return e.json()})).then(D.createParser(Ct)):Promise.reject(new Error("The copy target location must be specified in the `to` parameter."))}},{key:"move",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("move").withParams(e).post(null,Z).catch((function(e){return Promise.reject(Ot(e))})).then((function(e){return e.json()})).then(D.createParser(Ct))}},{key:"delete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=D.createParser(Rt);return this._plug.withParam("recursive",e).delete().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"activateDraft",value:function(){var e=D.createParser(U);return this._plug.at("activate-draft").post().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"importArchive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,r=void 0===n?e.name:n,i=t.size,a=void 0===i?e.size:i,o=t.type,s=void 0===o?e.type:o,l=t.progress,c=void 0===l?null:l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=Object.assign({filename:r,behavior:"async"},u);if(null!==c){var h=new ve(this._settings.host,this._settings.plugConfig).at("@api","deki","pages",this._id),m={callback:c,size:a};return h.at("import").withParams(d).put(e,s,m).catch((function(e){return Promise.reject(JSON.parse(e.responseText))})).then((function(e){return JSON.parse(e.responseText)})).then(D.createParser(jt))}return this._plug.withHeader("Content-Length",a).withParams(d).at("import").put(e,s).catch((function(e){return Promise.reject(JSON.parse(e.responseText))})).then((function(e){return e.json()})).then(D.createParser(jt))}},{key:"getExportInformation",value:function(){return this._plug.at("export").post(null,Z).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(At))}},{key:"exportPdf",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fileName,n=e.format,r=void 0===n?"pdf":n,i=e.stylesheet,a=e.deep,o=void 0!==a&&a,s=e.showToc,l=void 0!==s&&s,c=e.dryRun,u=void 0!==c&&c,d={};if(t){if("string"!=typeof t)return Promise.reject(new Error("The fileName parameter must be a non-empty string"));d.filename=t}if(i){if("string"!=typeof i)return Promise.reject(new Error("The stylesheet parameter must be a non-empty string"));d.stylesheet=i}if("pdf"!==r&&"html"!==r)return Promise.reject(new Error('The `format` parameter must be either "pdf" or "html".'));if(d.format=r,"boolean"!=typeof o)return Promise.reject(new Error("The `deep` parameter must be a Boolean value."));if(d.deep=o,"boolean"!=typeof l)return Promise.reject(new Error("The `showToc` parameter must be a Boolean value."));if(d.showtoc=l,"boolean"!=typeof u)return Promise.reject(new Error("The `dryRun` parameter must be a Boolean value."));d.dryrun=u;var h=this._plug.at("pdf").withParams(d).get().catch((function(e){return Promise.reject(e)}));return u?h:h.then((function(e){return e.blob()}))}},{key:"setOrder",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"number"!=typeof e?Promise.reject(new Error("The afterId must be a numeric page ID.")):this._plug.at("order").withParam("afterId",e).put().catch((function(e){return Promise.reject(e)}))}},{key:"getLinkDetails",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.includeSubpages,n=void 0!==t&&t,r=e.linkTypes,i=void 0===r?[]:r,a=e.broken,o=e.redirect,s=e.limit,l=void 0===s?100:s,c=e.offset,u=void 0===c?0:c,d=e.q,h={};if("boolean"!=typeof n)return Promise.reject(new Error("The `includeSubpages` parameter must be a Boolean value."));if(h.subpages=n,!Array.isArray(i))return Promise.reject(new Error("The `linkTypes` parameter must be an array."));if(i.length>0&&(h.linktypes=i.join(",")),void 0!==a){if("boolean"!=typeof a)return Promise.reject(new Error("The `broken` parameter must be a Boolean value."));h.broken=a}if(void 0!==o){if("boolean"!=typeof o)return Promise.reject(new Error("The `redirect` parameter must be a Boolean value."));h.redirect=o}if("number"!=typeof l)return Promise.reject(new Error("The `limit` parameter must be a number."));if(h.limit=l,"number"!=typeof u)return Promise.reject(new Error("The `offset` parameter must be a number."));if(h.offset=u,void 0!==d){if("string"!=typeof d)return Promise.reject(new Error("The `q` parameter must be a string."));h.q=d}return this._plug.at("linkdetails").withParams(h).get().catch((function(e){return Promise.reject(Ot(e))})).then((function(e){return e.json()})).then(D.createParser(Nt))}},{key:"getHealthInspections",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.analyzers,n=e.severities,r=e.includeSubpages,i=e.limit,a=e.offset,o={};if(t){if(!Array.isArray(t))return Promise.reject(new Error("The `analyzers` parameter must be an array."));o.analyzers=t.join(",")}if(n){if(!Array.isArray(n))return Promise.reject(new Error("The `severities` parameter must be an array."));o.severity=n.join(",")}if(void 0!==r){if("boolean"!=typeof r)return Promise.reject(new Error("The `includeSubpages` parameter must be a boolean value."));o.subpages=r}if(i){if("number"!=typeof i)return Promise.reject(new Error("The `limit` parameter must be a number."));o.limit=i}if(a){if("number"!=typeof a)return Promise.reject(new Error("The `offset` parameter must be a number."));o.offset=a}return this._plug.at("health").withParams(o).get().catch((function(e){return Promise.reject(Ot(e))})).then((function(e){return e.json()})).then(D.createParser(Dt))}},{key:"getHierarchyInfo",value:function(){return this._plug.at("hierarchyinfo").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(qt))}},{key:"linkToCase",value:function(e){return e?this._plug.at("linktocase",e).post().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("The case ID must be supplied in order to link a case to the page."))}},{key:"unlinkCase",value:function(e){return e?this._plug.at("linktocase",e).delete().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("The case ID must be supplied in order to unlink a case from the page."))}},{key:"getLinkedCases",value:function(){return this._plug.at("linktocase","links").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Mt))}},{key:"find",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1,n={};if(e.tags){if(!Array.isArray(e.tags))return Promise.reject(new Error("The `tags` parameter must be an Array."));e.tags.length>0&&(n.tags=e.tags.join(","),t=!0)}if(e.missingClassifications){if(!Array.isArray(e.missingClassifications))return Promise.reject(new Error("The `missingClassifications` parameter must be an Array."));e.missingClassifications.length>0&&(n.missingclassifications=e.missingClassifications.join(","),t=!0)}if(e.since){if(!(e.since instanceof Date))return Promise.reject(new Error("The `since` parameter must be of type Date."));n.since=ae(e.since),t=!0}if(e.upTo){if(!(e.upTo instanceof Date))return Promise.reject(new Error("The `upTo` parameter must be of type Date."));n.upto=ae(e.upTo),t=!0}return!1===t?Promise.reject(new Error("At least one constraint must be supplied to find pages.")):this._plug.at("find").withParams(n).get().catch((function(e){return Promise.reject(Ot(e))})).then((function(e){return e.json()})).then(D.createParser(It))}}]),t}(je),Bt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","pages")}return a(e,[{key:"getRatings",value:function(e){return this._plug.at("ratings").withParams({pageids:e.join(",")}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(xt))}},{key:"getTemplates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=void 0===t?"page":t,r=e.includeDescription,i=void 0===r||r;return"string"!=typeof n||"page"!==n&&"content"!==n&&"kcspage"!==n?Promise.reject(new Error('The `type` parameter must be set to either "page", "content", or "kcspage".')):"boolean"!=typeof i?Promise.reject(new Error("The `includeDescription` parameter must be a Boolean value")):this._plug.at("templates").withParams({type:n,includeDescription:i}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Lt))}},{key:"getPopularPages",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?50:t,r=e.offset,i=void 0===r?0:r,a=rt.object({limit:n,offset:i},et("limit",Je((function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]}),Ye("all"))),et("offset",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})));return a.length>0?Promise.reject(a.join(", ")):this._plug.at("popular").withParams({limit:n,offset:i}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ft))}}]),e}(),Ht=Object.freeze({Page:Ut,PageManager:Bt}),Wt=[{field:"@count",name:"count",transform:"number"},{field:"@href",name:"href"},{field:"property",name:"properties",isArray:!0,transform:St}],$t=function(){function e(t){if(r(this,e),"PagePropertyBase"===this.constructor.name)throw new TypeError("PagePropertyBase must not be constructed directly.  Use one of PageProperty() or DraftProperty()");this._id=re(t,"home")}return a(e,[{key:"getProperties",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e))return Promise.reject(new Error("The property names must be an array"));var t=this._plug;return e.length>0&&(t=t.withParams({names:e.join(",")})),t.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Wt))}},{key:"getPropertyContents",value:function(e){return e?this._plug.at(encodeURIComponent(e)).get().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("Attempting to fetch a page property contents without providing a property key"))}},{key:"getProperty",value:function(e){return e?this._plug.at(encodeURIComponent(e),"info").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(St)):Promise.reject(new Error("Attempting to fetch a page property without providing a property key"))}},{key:"setProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{abort:"modified"};return e?"string"!=typeof t.text?Promise.reject(new Error("Attempting to set a property without providing a property value")):(t.type||(t.type=Z),this._plug.at(encodeURIComponent(e)).withParams(n).put(t.text,t.type).catch((function(e){return Promise.reject(e)}))):Promise.reject(new Error("Attempting to set a property without providing a property key"))}},{key:"deleteProperty",value:function(e){return e?this._plug.at(encodeURIComponent(e)).delete().catch((function(e){return Promise.reject(e)})):Promise.reject(new Error("Attempting to delete a property without providing a property key"))}}]),e}(),Vt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;return r(this,t),(e=h(this,l(t).call(this,n)))._plug=new S(i.host,i.plugConfig).at("@api","deki","pages",e._id,"properties"),e}return s(t,e),a(t,[{key:"getPropertyForChildren",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e?this._plug.withParams({depth:t,names:e}).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})):Promise.reject(new Error("Attempting to fetch properties for children without providing a property key"))}}]),t}($t),Kt=[{field:"@href",name:"href"},{field:["grants","grant"],name:"grants",isArray:!0,transform:[{field:"date.modified",name:"dateModified",transform:"date"},{field:"permissions",transform:M},{field:"user",transform:O},{field:"user.modifiedby",name:"userModifiedBy",transform:O},{field:"group",transform:z}]},{field:"permissions.effective",name:"effectivePermissions",transform:M},{field:"permissions.page",name:"pagePermissions",transform:M},{field:"permissions.revoked",name:"revokedPermissions",transform:M}];function Gt(e){if(!Array.isArray(e))return[!1,"The specified grants must be an array"];var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=void 0!==o.user,l=void 0!==o.group;if(s&&l||!s&&!l)return[!1,"The grant must only define a single user or group, but not both."];if(s&&"string"!=typeof o.user&&"number"!=typeof o.user)return[!1,"The grant user parameter must be a numeric ID or an username"];if(l&&"string"!=typeof o.group&&"number"!=typeof o.group)return[!1,"The grant group parameter must be a numeric ID or an username"];if("string"!=typeof o.role)return[!1,"The grant role must be defined and must be a string."]}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return[!0,"success"]}function Qt(e,t){var n="grants";t&&(n+=".".concat(t));var r=e.map((function(e){var t,n,r=e[t=e.user?"user":"group"];n="number"==typeof r?"<".concat(t,' id="').concat(r,'"></').concat(t,">"):"<".concat(t,"><").concat(t,"name>").concat(r,"</").concat(t,"name></").concat(t,">");var i="<permissions><role>".concat(e.role,"</role></permissions>");return"<grant>".concat(n).concat(i,"</grant>")})).join("");return"<".concat(n,">").concat(r,"</").concat(n,">")}function Yt(e){return e?"<permissions.page><restriction>".concat(e,"</restriction></permissions.page>"):""}var Jt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"home",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;r(this,e),this._plug=new S(n.host,n.plugConfig).at("@api","deki","pages",re(t,"home"),"security")}return a(e,[{key:"get",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Kt))}},{key:"reset",value:function(){return this._plug.delete().catch((function(e){return Promise.reject(e)}))}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cascade,n=void 0===t?"none":t,r=e.pageRestriction,i=e.grants;if("string"!=typeof r)return Promise.reject(new Error("The pageRestriction parameter must be provided and must be a string."));var a="";if(i){var o=Gt(i),s=f(o,2),l=s[0],c=s[1];if(!l)return Promise.reject(new Error(c));a=Qt(i)}var u=Yt(r),d="<security>".concat(u).concat(a,"</security>");return this._plug.withParams({cascade:n}).put(d,X).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Kt))}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cascade,n=void 0===t?"none":t,r=e.pageRestriction,i=e.grantsAdded,a=e.grantsRemoved,o="";if(i){var s=Gt(i),l=f(s,2),c=l[0],u=l[1];if(!c)return Promise.reject(new Error(u));o=Qt(i,"added")}var d="";if(a){var h=Gt(a),m=f(h,2),p=m[0],g=m[1];if(!p)return Promise.reject(new Error(g));d=Qt(a,"removed")}var v=Yt(r),y="<security>".concat(v).concat(o).concat(d,"</security>");return this._plug.withParams({cascade:n}).post(y,X).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Kt))}}]),e}(),Xt=[{field:"subscription.page",name:"subscriptions",isArray:!0,transform:[{field:"@id",name:"id",transform:"number"},{field:"@depth",name:"depth"},{field:"@draft",name:"draft",transform:"boolean"}]}],Zt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"home",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new N;r(this,e);var a=rt.value(t,(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}));if(a.length>0)throw new Error("The siteId parameter must be supplied, and must be a string.");this._plug=new S(i.host,i.plugConfig).at("@api","deki","pagesubservice","pages",re(n,"home")).withParam("siteid",t)}return a(e,[{key:"subscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=void 0===t?"page":t,r=e.recursive,i=void 0!==r&&r,a=rt.object({type:n,recursive:i},et("type",Xe((function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}),Je(Ye("page"),Ye("draft")))),et("recursive",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})));return a.length>0?Promise.reject(new Error(a.join(", "))):this._plug.withParams({type:n,depth:i?"infinity":"0"}).post("",Z).catch((function(e){return Promise.reject(e)}))}},{key:"unsubscribe",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=void 0===t?"page":t,r=rt.value(n,Xe((function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}),Je(Ye("page"),Ye("draft"))));return r.length>0?Promise.reject('The type parameter must be a string set to either "page" or "draft".'):this._plug.withParams({type:n}).delete().catch((function(e){return Promise.reject(e)}))}}]),e}(),en=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;r(this,e);var i=rt.value(t,(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]}));if(i.length>0)throw new Error("The siteId parameter must be supplied, and must be a string.");this._plug=new S(n.host,n.plugConfig).at("@api","deki","pagesubservice","subscriptions").withParam("siteid",t)}return a(e,[{key:"getSubscriptions",value:function(){return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Xt))}}]),e}(),tn=Object.freeze({PageSubscription:Zt,PageSubscriptionManager:en}),nn=[{field:"@id",name:"id",transform:"number"},{field:"date.started",name:"startedTime",transform:"date"},{field:"date.completed",name:"completedTime",transform:"date"},{field:"@currentState.id",name:"currentStateId",transform:"number"},{field:"currentuservalidtransition",name:"rules",transform:[{field:"@requestedByCurrentUser",name:"requestedByCurrentUser",transform:"boolean"},{field:"@requestedOfCurrentUser",name:"requestedOfCurrentUser",transform:"boolean"},{field:"@canPickup",name:"canPickup",transform:"boolean"},{field:"@canCancel",name:"canCancel",transform:"boolean"},{field:"@canNeedsEdits",name:"canNeedsEdits",transform:"boolean"},{field:"@canAccept",name:"canAccept",transform:"boolean"},{field:"@canRequestReview",name:"canRequestReview",transform:"boolean"},{field:"@canReassign",name:"canReassign",transform:"boolean"}]},{field:"page",transform:[{field:"@id",name:"id",transform:"number"},{field:"uri.ui",name:"uri"},{field:"title"}]},{field:["states","state"],isArray:!0,transform:[{field:"@id",name:"id",transform:"number"},{field:"comment"},{field:"date.created",name:"createdTime",transform:"date"},{field:"pagesection",name:"pageSection"},{field:"label"},{field:"requestedby",name:"requestedBy",transform:function(e){return{type:"user",id:parseInt(e.user["@id"],10),name:e.user.username,username:e.user.username}}},{field:"requestedof",name:"requestedOf",transform:function(e){var t=Object.keys(e).includes("user")?"user":"group";return"user"===t?{type:t,id:parseInt(e[t]["@id"],10),name:e[t].username,username:e[t].username}:{type:t,id:parseInt(e[t]["@id"],10),name:e[t].groupname}}}]}],rn=[{field:"articlereview",name:"articleReview",isArray:!0,transform:nn}],an=D.createParser(W);function on(e){return"number"==typeof e?[]:["Page.ReviewWorkflow.error.user-or-group-must-be-provided"]}function sn(e){var t=dt(),n=t.createElement("reviews");if(e.requestedOf&&e.requestedOfType){var r=t.createElement("requestedof"),i=t.createElement(e.requestedOfType.toLowerCase());i.setAttribute("id",e.requestedOf||""),r.appendChild(i),n.appendChild(r)}return delete e.requestedOf,delete e.requestedOfType,void 0!==e.comment&&0===e.comment.trim().length&&delete e.comment,Object.keys(e).forEach((function(r){var i=t.createElement(r.toLowerCase());i.appendChild(t.createTextNode(e[r]||"")),n.appendChild(i)})),n.outerHTML}var ln=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._settings=t,this._plug=new S(t.host,t.plugConfig).at("@api","deki","reviews")}return a(e,null,[{key:"states",get:function(){return{editsRequested:"Needs Edits",reviewRequested:"Review Requested",accepted:"Accepted",cancelled:"Cancelled"}}}]),a(e,[{key:"getInfo",value:function(e){return void 0===e?Promise.reject(new Error("A review ID is required")):new S(this._settings.host,this._settings.plugConfig).at("@api","deki","reviews",e).get().catch((function(e){return Promise.reject(an(e))})).then((function(e){return e.json()})).then(D.createParser(nn))}},{key:"listForPage",value:function(e){return this._list(e,!1)}},{key:"listForDraft",value:function(e){return this._list(e,!0)}},{key:"listForUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(void 0===e)return Promise.reject(new Error("A user ID is required"));var i=new S(this._settings.host,this._settings.plugConfig).at("@api","deki","users",e,"reviews");return t&&(i=i.withParam("offset",t)),n&&(i=i.withParam("limit",n)),r&&(i=i.withParam("path",r)),i.get().catch((function(e){return Promise.reject(an(e))})).then((function(e){return e.json()})).then(D.createParser(rn)).then((function(e){return e.articleReview}))}},{key:"listAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"None",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=new S(this._settings.host,this._settings.plugConfig).at("@api","deki","reviews");return t&&(i=i.withParam("offset",t)),n&&(i=i.withParam("limit",n)),r&&(i=i.withParam("path",r)),(i=i.withParam("filter",e)).get().catch((function(e){return Promise.reject(an(e))})).then((function(e){return e.json()})).then(D.createParser(rn)).then((function(e){return e.articleReview}))}},{key:"create",value:function(e){e=Object.assign({resourceType:e.draft?"drafts":"pages",requestedOfType:"user"},e);var t=rt.object(e,et("id",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),et("requestedOf",on));if(t.length>0)return Promise.reject(new Error(t.join(", ")));e.label="Review Requested";var n=new S(this._settings.host,this._settings.plugConfig).at("@api","deki",e.resourceType,e.id,"reviews");return delete e.resourceType,delete e.id,n.post(sn(e),X).catch((function(e){return Promise.reject(an(e))}))}},{key:"update",value:function(e){e=Object.assign({requestedOf:null},e);var t=rt.object(e,et("reviewId",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})));if(void 0!==e.label&&null!==e.label||t.push.apply(t,p(rt.object(e,et("requestedOf",on)))),t.length>0)return Promise.reject(new Error(t.join(", ")));var n=e.reviewId;return delete e.reviewId,this._plug.at(n,"next").post(sn(e),X).catch((function(e){return Promise.reject(an(e))}))}},{key:"updateBulk",value:function(e){var t=this,n=rt.object(e,et("reviewIds",Qe()));return n.length>0?[Promise.reject(new Error(n.join(", ")))]:e.reviewIds.map((function(t){var n={};return Object.assign(n,e),delete n.reviewIds,n.reviewId=t,n})).map((function(e){return t.update(e)}))}},{key:"_list",value:function(e,t){if(void 0===e)return Promise.reject(new Error("A page ID is required"));var n=t?"drafts":"pages";return new S(this._settings.host,this._settings.plugConfig).at("@api","deki",n,e,"reviews").get().catch((function(e){return Promise.reject(an(e))})).then((function(e){return e.json()})).then(D.createParser(rn)).then((function(e){return e.articleReview}))}}]),e}();function cn(){return[{field:"@ranking",name:"ranking"},{field:"@queryid",name:"queryId",transform:"number"},{field:"@sessionid",name:"sessionId"},{field:"@querycount",name:"queryCount",transform:"number"},{field:"@count.recommendations",name:"recommendationCount",transform:"number"},{field:"@count",name:"count",transform:"number"},{field:"result",name:"results",isArray:!0,transform:[{field:"author"},{field:"content"},{field:"date.modified",name:"dateModified",transform:"date"},{field:"id",transform:"number"},{field:"mime"},{field:"rank",transform:"number"},{field:"title"},{field:"type"},{field:"uri"},{field:"uri.track",name:"uriTrack"},{field:"page",transform:U},{field:"preview"},{field:"tag",name:"tags",transform:function(e){if(e)return e.split("\n")}}]}]}var un=p(cn()).concat([{field:"summary",transform:[{field:"@path",name:"path"},{field:"results",isArray:!0,transform:[{field:"@path",name:"path"},{field:"@count",name:"count",transform:"number"},{field:"@title",name:"title"}]}]},{field:"page",name:"pages",isArray:!0,transform:U}]),dn=p(cn()).concat([{field:"recommendations",isArray:!0,transform:[{field:"@id",name:"id",transform:"number"}]},{field:"aggs",transform:[{field:["articles","articles"],isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"value"}]},{field:["custom_classifications","custom_classifications"],name:"customClassifications",isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"value",name:"prefix"},{field:["custom_classifications","custom_classifications"],name:"tags",isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"value"}]}]},{field:["pages","pages"],isArray:!0,transform:[{field:"@count",name:"count",transform:"number"},{field:"@id",name:"id",transform:"number"},{field:"value"},{field:"title"}]}]}]),hn=[{field:"@count",name:"count",transform:"number"},{field:"tag",name:"tags",isArray:!0,transform:[{field:"@value",name:"value"},{field:"@id",name:"id",transform:"number"},{field:"@href",name:"href"},{field:"title"},{field:"type"},{field:"uri"}]}],mn=[{field:"skipped-pageids",name:"skippedPageIds",transform:function(e){return"string"==typeof e?e.split(",").map((function(e){return parseInt(e,10)})):[]}},{field:"skipped-article-change-pageids",name:"skippedArticleChangePageIds",transform:function(e){return"string"==typeof e?e.split(",").map((function(e){return parseInt(e,10)})):[]}},{field:"skipped-kcs-change-pageids",name:"skippedKcsChangePageIds",transform:function(e){return"string"==typeof e?e.split(",").map((function(e){return parseInt(e,10)})):[]}}],fn=[{field:"@type",name:"type"},{field:"entry",name:"entries",isArray:!0,transform:[{field:"@date",name:"date",transform:"date"},{field:"pages.created",name:"pagesCreated",transform:"number"},{field:"pages.deleted",name:"pagesDeleted",transform:"number"},{field:"pages.edited",name:"pagesEdited",transform:"number"},{field:"pages.total",name:"pagesTotal",transform:"number"},{field:"users.created",name:"usersCreated",transform:"number"},{field:"users.total",name:"usersTotal",transform:"number"}]}],pn=[{field:"popular",transform:[{field:"search",isArray:!0,transform:[{field:"averageClicksPerSearch",transform:"number"},{field:"averagePosition",transform:"number"},{field:"hits",transform:"number"},{field:"mostRecent",transform:"date"},{field:"query"},{field:"results",transform:"number"},{field:"topresult",transform:[{field:"page",transform:U},{field:"file",transform:we}]},{field:"total",transform:"number"}]}]},{field:"volume",transform:[{field:"clickTotal",transform:"number"},{field:"clickthroughRate"},{field:"searchTotal",transform:"number"},{field:"searchesClickedTotal",transform:"number"},{field:"point",isArray:!0,transform:[{field:"clicks",transform:"number"},{field:"date",transform:"date"},{field:"total",transform:"number"}]}]}],gn=[{field:"clicks",transform:[{field:"click",isArray:!0,transform:[{field:"averagePosition",transform:"number"},{field:"hits",transform:"number"},{field:"mostRecent",transform:"date"},{field:"type"},{field:"page",transform:U},{field:"file",transform:we}]}]},{field:"volume",transform:[{field:"clickTotal",transform:"number"},{field:"clickthroughRate"},{field:"searchTotal",transform:"number"},{field:"searchesClickedTotal",transform:"number"},{field:"point",isArray:!0,transform:[{field:"clicks",transform:"number"},{field:"searchesClicked",transform:"number"},{field:"date",transform:"date"},{field:"total",transform:"number"}]}]}],vn=[{field:"permissions",isArray:!0,transform:M}],yn=[{field:"@lang",name:"lang"},{field:"localization",name:"localizations",isArray:!0,transform:[{field:"@resource",name:"resource"},{field:"@missing",name:"missing",transform:"boolean"},{field:"#text",name:"text"}]}];function bn(e){var t=[];if("path"in e){var n=e.path;t.push("+path.ancestor:"+ne(n))}if("tags"in e){var r=e.tags;"string"==typeof r&&r&&(r=r.split(",")),r.forEach((function(e){t.push('+tag:"'+ne(e)+'"')}))}if("type"in e){var i=e.type;"string"==typeof i&&i&&(i=i.split(",")),i.forEach((function(e){t.push("+type:"+ne(e))}))}if("namespaces"in e){var a=e.namespaces;"string"==typeof a&&(a=a.split(",")),a.forEach((function(e){t.push("+namespace:".concat(ne(e)))}))}return t.length>0?"+("+t.join(" ")+")":""}function wn(e){var t='<?xml version="1.0"?><tags>';return Array.isArray(e.add)&&e.add.length>0&&e.add.forEach((function(e){var n='<tag.add value="'.concat(te(e.name),'">');e.pageids.forEach((function(e){n+='<page id="'.concat(e,'"></page>')})),t+=n+="</tag.add>"})),Array.isArray(e.remove)&&e.remove.length>0&&e.remove.forEach((function(e){var n='<tag.remove value="'.concat(te(e.name),'">');e.pageids.forEach((function(e){n+='<page id="'.concat(e,'"></page>')})),t+=n+="</tag.remove>"})),t="".concat(t,"</tags>")}var _n=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,t),this.plug=new S(e.host,e.plugConfig).at("@api","deki","site")}return a(t,[{key:"getSiteActivityLogs",value:function(){return this.plug.at("activity","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ue))}},{key:"getSearchQueryLogs",value:function(){return this.plug.at("query","logs").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Ue))}},{key:"getResourceString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!("key"in e))return Promise.reject("No resource key was supplied");var t=this.plug.at("localization",e.key);return"lang"in e&&(t=t.withParam("lang",e.lang)),t.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.text()}))}},{key:"getResourceStrings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.keys,n=e.lang;if(!t||!Array.isArray(t))return Promise.reject(new Error("The keys parameter must be supplied, and it must be an array."));var r={resources:t.join(",")};if(n){if("string"!=typeof n)return Promise.reject(new Error("The lang parameter must be a string"));r.lang=n}return this.plug.at("localizations").withParams(r).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(yn))}},{key:"getSearchQueryLogUrl",value:function(e){return void 0===e||0===e.length?Promise.reject(new Error("Attempting to get log url without required name")):this.plug.at("query","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Be))}},{key:"getSiteActivityLogUrl",value:function(e){return void 0===e||0===e.length?Promise.reject(new Error("Attempting to get log url without required name")):this.plug.at("activity","logs",e,"url").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(Be))}},{key:"getTags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=D.createParser(hn);return this.plug.at("tags").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"setTags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=wn(e),n=D.createParser(mn);return this.plug.at("tags").post(t,"application/xml").catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(n)}},{key:"search",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.limit,r=void 0===n?10:n,i=t.offset,a=void 0===i?0:i,o=t.q,s=void 0===o?"":o,l=t.path,c=void 0===l?"":l,u=t.recommendations,d=void 0===u||u,h=t.recommendedIds,m=void 0===h?[]:h,f=t.tags,p=void 0===f?"":f,g=t.classifications,v=void 0===g?"":g,y=t.type,b=void 0===y?"":y,w=t.constraint,_=void 0===w?"":w,k=t.namespace,P=void 0===k?"main":k,T=t.sessionid,S=void 0===T?null:T,E=t.includeAggregations,C=void 0!==E&&E,x=t.apiVersion,R=void 0===x?1:x;c=c.replace(/^\//,"");var j={limit:r,offset:a,q:s,recommendations:d,sortBy:"-rank"},A=rt.object(et("offset",(function(e){return e>=0?[]:["The offset value must not be negative."]})));if(A.length>0)return Promise.reject(new Error(A.join(", ")));S&&(j.sessionid=S);var I=un;if(1===R){if(!_){var N={};""!==c&&"/"!==c&&(N.path=c),""!==p&&(N.tags=p),""!==b&&(N.type=b),N.namespaces=P,_=bn(N)}e=Object.assign({},j,{summarypath:encodeURI(c),constraint:_})}else I=dn,e=Object.assign({},j,{aggpath:c,classifications:v,includeaggs:C,namespaces:P,pathancestors:c.replace(/,/g,"%2C"),recommendedids:m.join(","),tags:p,types:b});return this.plug.at("query").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(I))}},{key:"searchIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.q,n=void 0===t?"":t,r=e.limit,i=void 0===r?100:r,a=e.offset,o=void 0===a?0:a,s=e.sortBy,l=void 0===s?"-score":s,c=e.constraintString,u=void 0===c?null:c,d=e.constraints,h=void 0===d?{}:d,m=e.verbose,f=void 0===m||m,p=e.parser,g=void 0===p?"bestguess":p,v=e.format,y=void 0===v?"xml":v;if("string"==typeof i&&"all"!==i)return Promise.reject(new Error('The limit for index searching must be a number or "all"'));var b={q:n,limit:i,offset:o,sortby:l,constraint:u||bn(h),verbose:f,parser:g,format:y};return this.plug.at("search").withParams(b).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(un))}},{key:"getSearchAnalytics",value:function(e){var t=e.start,n=void 0===t?null:t,r=e.end,i=void 0===r?null:r,a=e.queryFilters,o=void 0===a?null:a,s=e.userFilter,l=void 0===s?null:s,c=e.groupIds,u=void 0===c?null:c,d=e.bucket,h=void 0===d?null:d,m=e.origin,f=void 0===m?null:m,p=e.webWidgetEmbedId,g=void 0===p?null:p,v=e.recommendedfocusfilter,y=void 0===v?null:v,b=e.sortBy,w=void 0===b?null:b,_=e.sortOrder,k=void 0===_?null:_,P=e.limit,T={start:n,end:i,queryFilters:o,userFilter:l,groupids:u,bucket:h,recommendedfocusfilter:y,originFilter:f,web_widget_embed_id:g,sortby:w,sortorder:k,limit:void 0===P?null:P};return this.plug.at("search","analytics").withParams(oe(T)).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(pn))}},{key:"getSearchAnalyticsQuery",value:function(e){var t=e.query,n=e.start,r=void 0===n?null:n,i=e.end,a=void 0===i?null:i,o=e.userFilter,s=void 0===o?null:o,l=e.groupIds,c=void 0===l?null:l,u=e.bucket,d=void 0===u?null:u,h=e.origin,m=void 0===h?null:h,f=e.webWidgetEmbedId,p=void 0===f?null:f,g=e.sortBy,v=void 0===g?null:g,y=e.sortOrder,b=void 0===y?null:y,w=e.limit,_={query:t,start:r,end:a,userFilter:s,groupids:c,bucket:d,originFilter:m,web_widget_embed_id:p,sortby:v,sortorder:b,limit:void 0===w?null:w};return this.plug.at("search","analytics","query").withParams(oe(_)).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(gn))}},{key:"getActivity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.plug.at("activity");if(null!==e){if(!(e instanceof Date))return Promise.reject(new Error("The `since` parameter must be of type Date."));var n=ae(e);t=t.withParam("since",n)}return t.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(fn))}},{key:"getRoles",value:function(){return this.plug.at("roles").get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(vn))}},{key:"sendFeedback",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.comment,r=t.title,i=t.metadata,a=void 0===i?{}:i;if("string"!=typeof n)return Promise.reject(new Error("The `comment` parameter must be supplied, and must be a string."));var o="<feedback>";if(o+="<body>".concat(n,"</body>"),r){if("string"!=typeof r)return Promise.reject(new Error("The title parameter must be a string."));o+="<title>".concat(r,"</title>")}return o+="<metadata>","object"!==e(a)?Promise.reject(new Error("The `metadata` parameter must be an object.")):(Object.keys(a).forEach((function(e){o+="<".concat(e,">").concat(a[e].toString(),"</").concat(e,">")})),o+="</metadata>",o+="</feedback>",this.plug.at("feedback").post(o,X).catch((function(e){return Promise.reject(e)})))}}]),t}(),kn=[{field:"@id",name:"id"},{field:"@type",name:"type"},{field:"@status",name:"status"},{field:"lastmodified",name:"lastModified",transform:"date"},{field:"submitted",transform:"date"},{field:"started",transform:"date"},{field:"user",transform:O},{field:"completeditems",name:"completedItems",transform:"number"},{field:"totalitems",name:"totalItems",transform:"number"}],Pn=[{field:"job",name:"jobs",isArray:!0,transform:kn}],Tn=D.createParser(W),Sn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;if(r(this,e),!t||"string"!=typeof t)throw new Error("The job ID must be supplied as a GUID string.");this._plug=new S(n.host,n.plugConfig).at("@api","deki","site","jobs",t)}return a(e,[{key:"getStatus",value:function(){return this._plug.at("status").get().catch((function(e){return Promise.reject(Tn(e))})).then((function(e){return e.json()})).then(D.createParser(kn))}},{key:"cancel",value:function(){return this._plug.at("cancel").post().catch((function(e){return Promise.reject(Tn(e))})).then((function(e){return e.json()})).then(D.createParser(kn))}}]),e}(),En=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","site","jobs")}return a(e,[{key:"scheduleExport",value:function(e){if(!e)return Promise.reject(new Error("The export options must be supplied"));var t=!1;if("email"in e&&(t=!0),"url"in e&&(t=!0),!1===t)return Promise.reject(new Error("Notification email and url are missing. Need an email or url to notify when the job completes."));if(!("pages"in e))return Promise.reject("One or more pages must be specified for export.");if(!Array.isArray(e.pages))return Promise.reject("The pages option must be an array.");var n=e.pages.reduce((function(e,t){var n="<page";return t.id&&(n+=' id="'.concat(t.id,'"')),"includeSubpages"in t&&(n+=' includesubpages="'.concat(t.includeSubpages,'"')),n+=">",t.path&&(n+="<path>".concat(t.path,"</path>")),e+(n+="</page>")}),""),r="<job><notification>";return e.email&&(r+="<email>".concat(e.email,"</email>")),e.url&&(r+="<url>".concat(e.url,"</url>")),r+="</notification>",r+="<pages>".concat(n,"</pages>"),r+="</job>",this._plug.at("export").post(r,X).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(kn))}},{key:"scheduleImport",value:function(e){if(!e)return Promise.reject(new Error("The import options must be supplied"));var t=!1;if("email"in e&&(t=!0),"url"in e&&(t=!0),!1===t)return Promise.reject(new Error("Notification email and url are missing. Need an email or url to notify when the job completes."));if("string"!=typeof e.archiveUrl||""===e.archiveUrl)return Promise.reject(new Error("An archive url is required, and must be a non-empty string to perform an import."));var n="<job><notification>";return e.email&&(n+="<email>".concat(e.email,"</email>")),e.url&&(n+="<url>".concat(e.url,"</url>")),n+="</notification>",n+="<archive><url>".concat(this._escapeXml(e.archiveUrl),"</url></archive>"),n+="<options>",e.dryRun&&(n+='<option name="dryrun">true</option>'),!1===e.updateAttachments&&(n+='<option name="updateattachments">false</option>'),n+="</options>",n+="</job>",this._plug.at("import").post(n,X).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(kn))}},{key:"getJobsStatuses",value:function(){return this._plug.at("status").get().catch((function(e){return Promise.reject(Tn(e))})).then((function(e){return e.json()})).then(D.createParser(Pn))}},{key:"_escapeXml",value:function(e){return e.replace(/[<>&'"]/g,(function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}}))}}]),e}(),Cn=Object.freeze({SiteJob:Sn,SiteJobManager:En}),xn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;r(this,e),this._id=re(t,"current"),this._plug=new S(n.host,n.plugConfig).at("@api","deki","users",this._id),this._errorParser=D.createParser(W)}return a(e,[{key:"getInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.exclude,n=void 0===t?[]:t,r=rt.value(n,Qe());return r.length>0?Promise.reject(new Error(r.join(", "))):this._plug.withParam("exclude",n.join(",")).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(O))}},{key:"checkAllowed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=rt.value(e,Qe());if(n.length>0)return Promise.reject(new Error(n.join(", ")));var r=rt.object(t,Ze("mask",(function(e){return"number"==typeof e?[]:["".concat(e," is not a number")]})),Ze("operations",Qe()),Ze("verbose",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})),Ze("invert",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})));if(r.length>0)return Promise.reject(new Error(r.join(", ")));t.operations&&(t.operations=t.operations.join(","));var i=e.map((function(e){return'<page id="'.concat(e,'" />')})).join("");return i="<pages>".concat(i,"</pages>"),this._plug.at("allowed").withParams(t).post(i,X).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser([{field:"page",name:"pages",isArray:!0,transform:U}]))}},{key:"update",value:function(e){var t=this,n=rt.object(e,Ze("active",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})),Ze("seated",(function(e){return"boolean"==typeof e?[]:["".concat(e," is not a Boolean value")]})),Ze("username",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),Ze("fullName",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),Ze("email",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),Ze("language",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),Ze("timeZone",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));if(n.length>0)return Promise.reject(new Error(n.join(", ")));var r="<user>";return Object.entries(e).forEach((function(e){var t=f(e,2),n=t[0],i=t[1];if("active"===n)r+="<status>".concat(!0===i?"active":"inactive","</status>");else if("seated"===n)r+="<license.seat>".concat(i,"</license.seat>");else{var a=n.toLowerCase();r+="<".concat(a,">").concat(i,"</").concat(a,">")}})),r+="</user>",this._plug.put(r,X).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(D.createParser(O))}},{key:"setPassword",value:function(e){var t=this,n=rt.object(e,et("newPassword",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})),Ze("currentPassword",(function(e){return"string"==typeof e?[]:["".concat(e," is not a string")]})));if(n.length>0)return Promise.reject(new Error(n.join(", ")));var r={};return e.currentPassword&&(r.currentpassword=e.currentPassword),this._plug.at("password").withParams(r).put(e.newPassword,Z).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.text()})).then((function(e){return{authToken:e}}))}},{key:"setRole",value:function(e){var t=this,n=e.name,r=e.seated,i=void 0===r||r,a=dt(),o=a.createElement("user"),s=a.createElement("license.seat");s.textContent=i.toString();var l=a.createElement("permissions.user"),c=a.createElement("role");return c.textContent=n,l.appendChild(c),o.appendChild(l),o.appendChild(s),this._plug.put(o.outerHTML,X).catch((function(e){return Promise.reject(t._errorParser(e))})).then((function(e){return e.json()})).then(D.createParser(O))}}]),e}(),Rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._settings=t,this._plug=new S(t.host,t.plugConfig).at("@api","deki","users")}return a(e,[{key:"getCurrentUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.exclude,n=void 0===t?[]:t,r=rt.value(n,Qe());return r.length>0?Promise.reject(new Error(r.join(", "))):this._plug.at("current").withParam("exclude",n.join(",")).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(O))}},{key:"getCurrentUserActivityToken",value:function(){return this._plug.at("current").withParam("exclude",["groups","properties"]).get().catch((function(e){return Promise.reject(e)})).then((function(e){return Promise.all([e.json().then(D.createParser(O)),new Promise((function(t,n){var r=e.headers.get("X-Deki-Session");null!==r?t(r):n(new Error("Could not fetch an X-Deki-Session HTTP header from the MindTouch API."))}))])})).then((function(e){var t=f(e,2),n=t[0],r=t[1];return"".concat(n.id,":").concat(r)}))}},{key:"getUsers",value:function(){var e=D.createParser(ut);return this._plug.get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(e)}},{key:"searchUsers",value:function(e){var t=D.createParser(ut);return this._plug.at("search").withParams(e).get().catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(t)}},{key:"authenticate",value:function(e){var t=e.method,n=void 0===t?"GET":t,r=e.username,i=e.password,a=n.toLowerCase();if(rt.value(a,Je(Ye("get"),Ye("post"))).length>0)return Promise.reject(new Error("GET and POST are the only valid methods for user authentication."));var o=v.base64.encode("".concat(r,":").concat(i));return this._plug.at("authenticate").withHeader("Authorization","Basic ".concat(o))[a]().then((function(e){return e.text()}))}},{key:"getUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"current";return new xn(e,this._settings)}}]),e}(),jn=Object.freeze({User:xn,UserManager:Rn}),An=[{field:"@active",name:"active",transform:"boolean"},{field:"@date",name:"date",transform:"date"},{field:"@id",name:"id",transform:"number"},{field:"@type",name:"type"},{field:"@date.deleted",name:"dateDeleted",transform:"date"},{field:"web-widget.parent",name:"parent",transform:[{field:"@id",name:"id",transform:"number"}]},{field:"host"},{field:"name"},{field:"token"},{field:"arguments"},{field:"code",transform:[{field:"#text",name:"text"},{field:"@format",name:"format"},{field:"@id",name:"id"}]}];An.push({field:"web-widgets",name:"subWidgetInfo",transform:[{field:"@count",name:"count",transform:"number"},{field:"web-widget",name:"widgets",isArray:!0,transform:An}]});var In=[{field:"@count",name:"count",transform:"number"},{field:"web-widget",name:"webWidgets",isArray:!0,transform:An}],Nn=D.createParser(W);function Dn(t){if(!t||"object"!==e(t))throw new Error("Web widget data must be an object");if(!Array.isArray(t.arguments)||t.arguments.some((function(e){return!(e&&"string"==typeof e.name&&(t=e.value,"string"==typeof t||"number"==typeof t||"boolean"==typeof t));var t})))throw new Error("Web widget arguments must be an array of objects with a `name` string and a `value` string|number|boolean");if(!Array.isArray(t.hosts)||t.hosts.some((function(e){return"string"!=typeof e})))throw new Error("Web widget hosts must be an array of strings");if("string"!=typeof t.name)throw new Error("Web widget name must be a string");if("string"!=typeof t.type)throw new Error("Web widget type must be a string");if("parentId"in t&&"number"!=typeof t.parentId)throw new Error("Web widget parentId must be a number");var n=t.arguments.map((function(e){return"<".concat(e.name,">").concat(te(e.value),"</").concat(e.name,">")}));return"\n        <web-widget>\n            <arguments>".concat(n.join("\n"),"</arguments>\n            <host>").concat(te(t.hosts.join(",")),"</host>\n            <name>").concat(te(t.name),"</name>\n            <type>").concat(te(t.type),'</type>\n            <web-widget.parent id="').concat("parentId"in t?t.parentId:"",'"></web-widget.parent>\n        </web-widget>\n    ')}var Ln=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","web-widgets")}return a(e,[{key:"getActiveWidgets",value:function(){return this._plug.get().catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(In))}},{key:"getInactiveWidgets",value:function(){return this._plug.at("inactive").get().catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(In))}},{key:"getWidget",value:function(e){var t=re(e);return this._plug.at(t).get().catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(An))}},{key:"createWidget",value:function(e){return this._plug.post(Dn(e),X).catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(An))}},{key:"deleteWidget",value:function(e){var t=re(e);return this._plug.at(t).delete().catch((function(e){return Promise.reject(Nn(e))}))}},{key:"updateWidget",value:function(e,t){var n=re(e);return this._plug.at(n).put(Dn(t),X).catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(An))}},{key:"activateWidget",value:function(e){var t=re(e);return this._plug.at(t,"activate").put().catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(An))}},{key:"deactivateWidget",value:function(e){var t=re(e);return this._plug.at(t,"deactivate").put().catch((function(e){return Promise.reject(Nn(e))})).then((function(e){return e.json()})).then(D.createParser(An))}}]),e}(),Fn=Object.freeze({WebWidgetsManager:Ln}),qn=[{field:"@href",name:"href"},{field:"uri.next",name:"uriNext"}],Mn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new N;r(this,e),this._plug=new S(t.host,t.plugConfig).at("@api","deki","workflow")}return a(e,[{key:"submitFeedback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="submit-feedback";if(!("_path"in e))return Promise.reject(new Error("The _path field must be supplied for ".concat(t)));var n=JSON.stringify({_path:e._path,userEmail:e.userEmail,pageTitle:e.pageTitle,siteUrl:e.siteUrl,content:e.content,contactAllowed:e.contactAllowed});return this._plug.at(t).post(n,ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(qn))}},{key:"requestArticle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._plug.at("submit-article-request").post(JSON.stringify(e),ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(qn))}},{key:"submitIssue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="submit-issue";return"_path"in e&&"_search"in e?this._plug.at(t).post(JSON.stringify(e),ee).catch((function(e){return Promise.reject(e)})).then((function(e){return e.json()})).then(D.createParser(qn)):Promise.reject(new Error("The _path and _search fields must be supplied for ".concat(t)))}}]),e}(),zn={martianContextId:Q,martianDeveloperToken:he,martianDraft:De,martianEvents:{Events:$e},martianExternalReport:{ExternalReport:it},martianFile:lt,martianGroup:ft,martianLearningPath:wt,martianLicense:{License:Pt},martianPage:Ht,martianPageProperty:{PageProperty:Vt},martianPageSecurity:{PageSecurity:Jt},martianPageSubscription:tn,martianReview:{Review:ln},martianSite:{Site:_n},martianSiteJob:Cn,martianUser:jn,martianWebWidgets:Fn,martianWorkflows:{WorkflowManager:Mn}},On={},Un={},Bn={read:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"global-settings";if(!(e in On)||!0!==On[e]){var t="#mt-".concat(e),n=document.querySelector(t);if(n){var r=n.textContent;r&&""!==r||(r=n.text);var i=JSON.parse(r);Object.keys(i).forEach((function(e){Un[e]=i[e]})),On[e]=!0}}},get:function(e){return Un[e]},set:function(e,t){Un[e]=t},has:function(e){return void 0!==Un[e]}};Bn.read();try{var Hn=Bn.get("sessionSettings");null!==Hn&&"object"===e(Hn)&&window.sessionStorage.setItem("sessionSettings",JSON.stringify(Hn));var Wn=window.sessionStorage.getItem("sessionSettings");Wn&&null!==(Hn=JSON.parse(Wn))&&"object"===e(Hn)&&Object.keys(Hn).forEach((function(e){Bn.set(e,Hn[e])}))}catch(e){}function $n(){var e={"X-Deki-Client":"mindtouch-web"},t=Bn.get("apiToken");t&&(e["X-Deki-Token"]=t);var n=Bn.get("pageViewId");return n&&(e["X-Deki-Page-View-Id"]=n),"f1"===Bn.get("pageContentViewParser")&&(e["X-Deki-Unseated"]=!0),e}function Vn(){var e=Bn.get("pageContentViewParser"),t={};return e&&(t["mt-view"]=e),new S(window.location.origin).at("@app").withParams(t)}function Kn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.origin,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Bn.get("pageContentViewParser"),r={origin:"f1"===n?"mt-f1":"mt-web"};return new S(e,t).withHeaders($n()).withParams(r)}var Gn=Object.freeze({getAppPlug:Vn,getPlug:Kn,getTemplatePlug:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=Bn.get("pageContentViewParser"),r="=".concat(encodeURIComponent(encodeURIComponent(t)));return Kn().at("@api","deki","pages",r,"contents").withParams(Object.assign({"dream.out.format":"json",origin:"f1"===n?"mt-f1":"mt-web",pageid:1,format:"text"},e))}}),Qn={_previousSearchQuery:"",_options:{},init:function(e,t,n){n&&(this._options=n),this._options.callBack=t,this._options.elm=e,this._options.elm.jquery&&(this._options.elm=this._options.elm[0]),this._options.elm.addEventListener("paste",(function(){sessionStorage.removeItem("searchSessionId")})),this._options.elm.addEventListener("input",this.triggerSearch())},triggerSearch:function(){var e=null,t=this._options,n=t.reference||this,r=t.elm,i=this._previousSearchQuery,a=t.timeout?t.timeout:400,o=t.minimum?t.minimum:4;return function(){var s=r.value.trim().replace(/\s+/g," "),l=arguments;if(s.length<=1)return i=s,void sessionStorage.removeItem("searchSessionId");i===s||s.length<o?i=s:(i=r.value,clearTimeout(e),e=setTimeout((function(){t.callBack.apply(n,l)}),a))}}},Yn={"<":"&lt;",">":"&gt;",'"':"&quot;","&":"&amp;","'":"&#39;"},Jn=Object.entries(Yn).reduce((function(e,t){var n=f(t,2),r=n[0];return e[n[1]]=r,e}),{}),Xn=new RegExp("[".concat(Object.keys(Yn).join(""),"]"),"g"),Zn=new RegExp("".concat(Object.keys(Jn).map((function(e){return"(".concat(e,")")})).join("|")),"g");function er(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(Xn,(function(e){return Yn[e]}))}function tr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(Zn,(function(e){return Jn[e]}))}function nr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=""===t?-1:e.indexOf(t);return-1===n?e:e.slice(n+t.length,e.length)}function rr(e,t){var n=e.lastIndexOf(t);return e.substring(n+1)}function ir(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\\s";return e.replace(new RegExp("^".concat(t,"+")),"")}function ar(e,t){return""===e?[]:e.trim().split(t||/\s+/)}function or(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:",";if(isNaN(e))return"";var i=(e=e.toFixed(~~t)).split("."),a=i[0],o=i[1]?(n||".")+i[1]:"";return a.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o}function sr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"...";return e.length>t?e.slice(0,t)+n:e}var lr=Object.freeze({escapeHTML:er,unescapeHTML:tr,strRight:nr,strRightBack:rr,ltrim:ir,words:ar,numberFormat:or,truncate:sr}),cr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.origin;r(this,e),"string"==typeof t&&(t=t.replace(/\\/g,"%5C")),"string"==typeof n&&(n=n.replace(/\\/g,"%5C")),this._url=new URL(t,n)}return a(e,null,[{key:"tryParse",value:function(t){var n;try{n=new URL(t)}catch(e){return null}return new e(n.href)}}]),a(e,[{key:"toString",value:function(){return this._url.toString()}},{key:"getQueryParam",value:function(e){return this._url.searchParams.get(e)}},{key:"removeQueryParam",value:function(e){return this._url.searchParams.delete(e),this}},{key:"addQueryParam",value:function(e,t){var n=null==t?"":t;return this._url.searchParams.append(e,n),this}},{key:"addQueryParams",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var n=f(e,2),r=n[0],i=n[1];t.addQueryParam(r,i)})),this}},{key:"setQueryParam",value:function(e,t){return this.removeQueryParam(e),this.addQueryParam(e,t),this}},{key:"setQueryParams",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var n=f(e,2),r=n[0],i=n[1];t.setQueryParam(r,i)})),this}},{key:"addSegments",value:function(){for(var e=function e(t){return t.reduce((function(t,n){return Array.isArray(n)?t+=e(n):("/"===n[0]&&(n=n.slice(1)),t+="/".concat(n)),t}),"")},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=e(n),a=this._url.pathname;return"/"===a&&(a=""),this._url.pathname="".concat(a).concat(i),this}},{key:"hash",get:function(){return this._url.hash},set:function(e){this._url.hash=e}},{key:"host",get:function(){return this._url.host},set:function(e){this._url.host=e}},{key:"hostname",get:function(){return this._url.hostname},set:function(e){this._url.hostname=e}},{key:"href",get:function(){return this._url.href},set:function(e){this._url.href=e}},{key:"password",get:function(){return this._url.password},set:function(e){this._url.password=e}},{key:"pathname",get:function(){return this._url.pathname},set:function(e){this._url.pathname=e}},{key:"port",get:function(){return this._url.port},set:function(e){this._url.port=e}},{key:"protocol",get:function(){return this._url.protocol},set:function(e){this._url.protocol=e}},{key:"search",get:function(){return this._url.search},set:function(e){this._url.search=e}},{key:"username",get:function(){return this._url.username},set:function(e){this._url.username=e}},{key:"origin",get:function(){return this._url.origin}},{key:"searchParams",get:function(){return this._url.searchParams}}]),e}(),ur={},dr={_restrictedPasswordWords:["password"],getProtocol:function(){return window.location.protocol.replace(":","")},getOrigin:function(e){var t=window.location;return e&&((t=document.createElement("a")).href=e),t.origin||t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")},xmlRequestType:"application/xml; charset=utf-8",textRequestType:"text/plain; charset=utf-8",jsonRequestType:"application/json; charset=utf-8",formRequestType:"application/x-www-form-urlencoded",strToBool:function(e){return!0===e||"string"==typeof e&&"true"===e.trim().toLowerCase()},formatNumber:function(e,t,n){t=t||".",n=n||",";for(var r=(e=String(e)).split("."),i=r[0],a=r.length>1?t+r[1]:"",o=/(\d+)(\d{3})/;o.test(i);)i=i.replace(o,"$1"+n+"$2");return i+a},formatPageContentViewUri:function(e){var t=new cr(e),n=Bn.get("pageContentViewParser");return n&&t.setQueryParam("mt-view",n),t.toString()},formatBytes:function(e){var t=0;switch(e>1228&&(t+=1,e/=1024),e>1228&&(t+=1,e/=1024),e>1228&&(t+=1,e/=1024),t){case 0:return this.formatNumber(Math.round(e))+" bytes";case 1:return this.formatNumber(Math.round(e))+" KiB";case 2:return this.formatNumber(Math.round(10*e)/10)+" MiB";case 3:return this.formatNumber(Math.round(100*e)/100)+" GiB";default:return this.formatNumber(Math.round(e))+" bytes"}},pad:function(e){return(e<10?"0":"")+e},compareDate:function(e,t,n){var r=new Date(e),i=new Date(t),a=!1;if(!window.isNaN(r)&&!window.isNaN(i))switch(n){case"day":a=r.getDate()===i.getDate()&&r.getMonth()===i.getMonth()&&r.getFullYear()===i.getFullYear();break;case"month":a=r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth();break;case"year":a=r.getFullYear()===i.getFullYear();break;default:a=r.toString()===i.toString()}return a},formatLocalization:function(e){if(e){e=dr.getLoc(e);for(var t=0;t<arguments.length;t++){var n=new RegExp("\\{"+t+"\\}","g");e=e.replace(n,arguments[t+1])}return e}},getLoc:function(e){return ur[e]||e},setLoc:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(ur[t]=e[t])},store:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"local";try{var r=JSON.stringify(t);return void 0!==r&&("session"===n?window.sessionStorage.setItem(e,r):window.localStorage.setItem(e,r),!0)}catch(e){return!1}},fetch:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local",r=null;try{(t="session"===n?window.sessionStorage.getItem(e):window.localStorage.getItem(e))&&(r=JSON.parse(t))}catch(e){return null}return r},clearStorage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";if("session"!==t)try{window.localStorage.removeItem(e)}catch(e){}else window.sessionStorage.removeItem(e)},readCookie:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){var i=ir(n[r]);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null},createCookie:function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toGMTString()}document.cookie=e+"="+t+r+"; path=/"},isValidEmail:function(e){return new RegExp("^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,4}$").test(e)},searchEscape:function(e){var t=e.toString();return["\\","+","-","&","|","!","(",")","{","}","[","]","^",'"',"~","*","?",":"].forEach((function(e){var n=new RegExp("\\"+e,"g");t=t.replace(n,"\\"+e)})),t},getPasswordStrength:function(e){var t={rating:!0,lengthOk:!0,matchVerify:!0,freeOfRestrictedWords:!0};e.password.length<e.minLength&&(t.lengthOk=!1),e.matchPassword.length>0&&e.matchPassword!==e.password&&(t.matchVerify=!1);var n=0;e.password.match(/[a-z]+/)&&n++,e.password.match(/[A-Z]+/)&&n++,e.password.match(/[0-9]+/)&&n++,e.password.match(/\W+/)&&n++,n<e.minRating&&(t.rating=!1);var r=e.password.toLowerCase(),i=!1;return this._restrictedPasswordWords.forEach((function(e){i=i||r.includes(e)})),i&&(t.freeOfRestrictedWords=!1),t.allOk=t.rating&&t.lengthOk&&t.matchVerify&&t.freeOfRestrictedWords,t},makeArray:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)?e:[e]},makeString:function(e){if("string"==typeof e)return e;if(e instanceof Object&&"#text"in e)return e["#text"];throw new Error("No string or string-containing object found")},importModule:function(e){var t,n=e.path,r=e.moduleName,i=void 0===r?null:r,a=e.exportNamespace,o=void 0===a?"Deki._mtLib":a;if("global"===Bn.get("moduleMode")){"noModule"in document.createElement("script")&&(n=n.replace(/\.js/,".modern.js"));var s=o.split(".").reduce((function(e,t){return e[t]=e[t]||{},e[t]}),window);if(void 0!==s[i])return Promise.resolve(s[i]);t=dr.getCachedJavascript(n.replace("/@lib/src/","/deki/javascript/out/")).then((function(){return s[i]}))}return t},importExternalModule:function(e){var t=e.libVar,n=void 0===t?null:t,r=e.globalPath;return null!==n?Promise.resolve():dr.getCachedJavascript(r)},getCachedJavascript:function(e){var t=this;return new Promise((function(n){var r=document.createElement("script");r.src=t.getCacheUrl(e),r.onload=function(){document.head.removeChild(r),n()},r.onerror=function(){document.head.removeChild(r)},document.head.appendChild(r)}))},translateModulePath:function(e){return"module"!==Bn.get("moduleMode")&&(e=e.replace("/@lib/src/","/deki/javascript/out/")),e},getCacheUrl:function(e){if(Bn.get("cdnHostname")){var t=Bn.get("cacheFingerprint");return t?window.location.protocol+"//"+Bn.get("cdnHostname")+e+"?_="+t:e}return e},finishDeferred:function(e){return function(t){var n=!1;"success"in t&&(n=t.success,delete t.success),n?e.resolve(t):e.reject(t)}},getStringParams:function(e){var t={};return ar(nr(e,"?"),"&").forEach((function(e){var n=e.split("=");n[0]&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))})),t},buildQueryString:function(e){var t="";return Object.keys(e).forEach((function(n){var r="".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e[n]));t="".concat(t).concat(""!==t?"&":"").concat(r)})),t},guid:function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()},htmlCleanString:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.replace(/\s/g,"-");return t=t.replace(/[^A-Za-z0-9-]/g,"")},extendObject:function(e,t){var n={};return Object.keys(e).forEach((function(t){n[t]=e[t]})),Object.keys(t).forEach((function(e){n[e]=t[e]})),n},findInArray:function(e,t){for(var n=null,r=0;r<e.length;r++){var i=e[r];if(t(i)){n=i;break}}return n},getPagesWithClassifications:function(e,t){if(!e)return[];var n=[];return e.forEach((function(e){e.tags||(e.tags=[]);var r=e;r.classifications={},t.forEach((function(t){var n=e.tags.find((function(e){return e.value.startsWith(t.prefix+":")}));if(n&&t.tags){var i=t.tags.find((function(e){return"".concat(t.prefix,":").concat(e.tag)===n.title}));i&&(r.classifications[t.prefix]=i)}})),n.push(r)})),n},ancestorEscape:function(e){var t=this.searchEscape(e);return["#","<",">"].forEach((function(e){var n=new RegExp(e,"g");t=t.replace(n,encodeURIComponent(e))})),t},canCopyToClipboard:function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},copyTextToClipboard:function(e){var t=e instanceof Element?e:document.querySelector(e),n=window.getSelection(),r=document.createRange();r.selectNodeContents(t),n.removeAllRanges(),n.addRange(r);var i=document.execCommand("copy");return n.removeAllRanges(),i},cleanParams:function(e){return Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&""!==e[t].trim()||delete e[t]})),e}},hr={_keyName:"related-pages-previous-ids",_maxHistoryLength:10,recordPageView:function(e){var t=dr.fetch(this._keyName)||[];t.length>0&&t[0]===e||(t.unshift(e),t=t.slice(0,this._maxHistoryLength),dr.store(this._keyName,t))},getRecentlyViewedPageIds:function(){return dr.fetch(this._keyName)||[]}},mr=Bn.get("apiToken"),fr=Bn.get("isXhrIEMode"),pr=Bn.get("pageContentViewParser"),gr={host:Bn.get("apiHost")||window.location.origin,origin:Bn.get("apiOrigin")||window.location.origin,queryParams:{"dream.out.format":"json"},headers:{"X-Deki-Client":"mindtouch-martian"}},vr="f1"===pr;gr.queryParams.origin=vr?"mt-f1":"mt-web",vr&&(gr.headers["X-Deki-Unseated"]=!0),fr&&(gr.headers.pragma="no-cache"),mr&&(gr.token=mr);var yr=Bn.get("pageViewId");yr&&(gr.headers["X-Deki-Page-View-Id"]=yr);var br=Bn.get("translatedLanguage"),wr=Bn.get("pageLanguageCode");br&&br.length>0&&(gr.headers["X-Deki-Translated-Language"]=br.toUpperCase(),gr.headers["X-Deki-Effective-Language"]=wr);var _r=new N(gr),kr=Object.freeze({standardMartianConfig:gr,standardMartianSettings:_r}),Pr=Bn.get("clientSideWarnings"),Tr=["aria-label","role"];function Sr(e){return Tr.includes(e)||e.startsWith("@")}function Er(e){return e&&(e.nodeType===Node.ELEMENT_NODE||e.nodeType===Node.TEXT_NODE||e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)}function Cr(t){var n=e(t);return"string"===n||"number"===n||"boolean"===n||"function"===n}function xr(e,t){t.forEach((function(t){Rr(e,t)}))}function Rr(e,t){var n,r,i,a=!0;return Array.isArray(t)?xr(e,t):Er(t)?e.appendChild(t):"string"==typeof t?(n=e,r=t,i=document.createTextNode(r),n.appendChild(i)):t instanceof Promise?function(e,t){var n=Ir("div");e.appendChild(n),t.then((function(t){if(Er(t))e.replaceChild(t,n);else if(Er(t.element))e.replaceChild(t.element,n);else if("string"==typeof t){var r=document.createTextNode(t);e.replaceChild(r,n)}else e.removeChild(n)}))}(e,t):a=!1,a}function jr(e,t){Object.keys(t).forEach((function(n){n in e.style?e.style[n]=t[n]:Pr&&console.warn("".concat(n," is not a valid style for a <").concat(e.tagName.toLowerCase(),">"))}))}function Ar(e,t){Object.keys(t).forEach((function(n){var r=t[n];Cr(r)?e.dataset[n]=r:Pr&&console.warn("Unable to set data property ".concat(r," on <").concat(e.tagName.toLowerCase(),">"))}))}function Ir(t,n){var r=document.createElement(t);if(n){var i=Rr(r,n);i||null===n||"object"!==e(n)||Object.keys(n).forEach((function(e){if(e in r||Sr(e)){var i=n[e];"style"===e?jr(r,i):"dataset"===e?Ar(r,i):Tr.includes(e)?r.setAttribute(e,i):e.startsWith("@")?r.setAttribute(e.substring(1),i):Cr(i)?r[e]=i:Pr&&console.warn("Unable to set value ".concat(i," for property ").concat(e," of a <").concat(t,">"))}else Pr&&console.warn("".concat(e," is not a valid property of a <").concat(t,">"))}));for(var a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];o&&o.length>0&&xr(r,o)}return r}function Nr(){for(var e=document.createDocumentFragment(),t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return xr(e,n),e}var Dr=new DOMParser;function Lr(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Dr.parseFromString(e,"image/svg+xml").documentElement;if(t){var r=n.querySelector("title");r.parentNode.removeChild(r)}return n}function Fr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.create){var n=e.create(t);return n.element?n.element:n}Pr&&console.warn("Attempting to create a component element that does not implement a `create` function.")}var qr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["a"].concat(t))},Mr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["button"].concat(t))},zr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["div"].concat(t))},Or=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["p"].concat(t))},Ur=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["span"].concat(t))},Br=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["ul"].concat(t))},Hr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["li"].concat(t))},Wr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["input"].concat(t))},$r=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["label"].concat(t))},Vr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["table"].concat(t))},Kr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["tr"].concat(t))},Gr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["td"].concat(t))},Qr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["th"].concat(t))},Yr=Object.freeze({fragment:Nr,svg:Lr,component:Fr,template:function(){for(var e=Ir("template"),t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.content.appendChild(t)})),e},text:function(e){return document.createTextNode(e)},makeElement:Ir,a:qr,button:Mr,div:zr,p:Or,span:Ur,ul:Br,li:Hr,input:Wr,label:$r,style:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["style"].concat(t))},slot:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ir.apply(void 0,["slot"].concat(t))},table:Vr,tr:Kr,td:Gr,th:Qr}),Jr={TreeBrowser:{LinkPicked:"Events.TreeBrowser.LinkPicked"},Tags:{TagAdded:"Events.Tags.TagAdded",TagRemoved:"Events.Tags.TagRemoved"},Rating:{NegativeFeedbackLeft:"Events.Rating.NegativeFeedbackLeft"},Files:{UploadComplete:"Events.Files.UploadComplete",UploadProgress:"Events.Files.UploadProgress",VersionUploaded:"Events.Files.VersionUploaded",RevisionUploadRequested:"Events.Files.RevisionUploadRequested",RevisionUploaded:"Events.Files.RevisionUploaded"},Nav:{Loaded:"Events.Nav.Loaded"},Flash:{Show:"Events.Flash.Show",Hide:"Events.Flash.Hide"},Template:{Loaded:"Events.Template.Loaded"},PageThumbnail:{Added:"Events.PageThumbnail.Added",Removed:"Events.PageThumbnail.Removed"}},Xr=Object.freeze({events:Jr,generateEventName:function(e,t){return"mindtouch-web:".concat(e,":").concat(t)}});function Zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.bindToContainer;e&&e.nodeType===Node.ELEMENT_NODE&&(e.classList.add("mt-loading"),n&&e.classList.add("mt-loading-force-container-bounds"))}function ei(e){e&&e.nodeType===Node.ELEMENT_NODE&&(e.classList.remove("mt-loading"),e.classList.remove("mt-loading-force-container-bounds"))}var ti=Object.freeze({showSpinner:Zr,hideSpinner:ei,showFullPageSpinner:function(e){var t=zr({className:"mt-loading mt-full-page-spinner"},Or(e));document.body.appendChild(t)},hideFullPageSpinner:function(){document.querySelector("body > .mt-full-page-spinner").remove()}});function ni(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function ri(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function ii(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;return Array.from(t.querySelectorAll(e))}function ai(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function t(){document.removeEventListener("DOMContentLoaded",t),e()})):e()}function oi(e,t,n){n?e.classList.add(t):e.classList.remove(t)}var si="ontouchstart"in document.documentElement&&"function"==typeof window.matchMedia&&window.matchMedia("(max-device-width:1024px)").matches;var li="2000px",ci=function(){function e(){r(this,e)}return a(e,null,[{key:"close",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;e.style.border="none",e.style.margin=0,e.style.maxHeight="0px",e.style.overflow="hidden",e.style.padding=0,e.style.transition="max-height ".concat(t,"ms cubic-bezier(0, 1, 0, 1)")}},{key:"open",value:function(e,t){e.style.border=null,e.style.margin=null,e.style.maxHeight=li,e.style.overflow=null,e.style.padding=null,e.style.transition="max-height ".concat(t,"ms cubic-bezier(0, 1, 0, 1)")}},{key:"toggle",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return e.isClosed(t)?e.open(t):e.close(t,n)}},{key:"isOpen",value:function(t){return!e.isClosed(t)}},{key:"isClosed",value:function(e){return e.style.maxHeight!==li}}]),e}(),ui=Object.freeze({removeChildren:ni,removeNode:function(e){e.parentNode.removeChild(e)},insertAfter:ri,elementArray:ii,onDocumentReady:ai,onWindowLoad:function(e){"complete"===document.readyState?e():window.addEventListener("load",e)},attachEventListenerToElements:function(e,t,n){for(var r=0;r<e.length;r++)e[r].addEventListener(t,n)},tryParseDomJson:function(e){try{return JSON.parse(e.textContent)}catch(e){}},forceToggleClass:oi,toggleAttribute:function(e,t,n){return null!==e.getAttribute(t)?!!n||(e.removeAttribute(t),!1):!1!==n&&(e.setAttribute(t,""),!0)},isSmallTouchDevice:si,isViewportUnder:function(e){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<e},Slider:ci}),di={_messageFadeOut:function(e){e&&void 0!==e.jquery&&e.length>1&&e[0].remove()},_handleMessageClose:function(e){var t=e.parentElement;t&&(t.style.maxHeight="500px",e.addEventListener("click",(function(){t.style.transition="max-height .5s cubic-bezier(0, 1, 0, 1)",void 0===t.ontransitionend?t.remove():(t.addEventListener("transitionend",t.remove),t.style.border="none",t.style.marginBottom=0,t.style.marginTop=0,t.style.maxHeight="0px",t.style.overflow="hidden")})))},Flash:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(""!==e){t=t||"error";var r=document.getElementById("flash-messages"),i=document.getElementById(n.target||"")||r.querySelector(".dekiFlash"),a=i.querySelector(".".concat(t,"msg")),o=new DOMParser,s=o.parseFromString(e,"text/html"),l=Hr.apply(void 0,p(s.body.childNodes));null===a?(a=zr({className:"".concat(t,"msg systemmsg"),id:"".concat(t,"Msg")},!n.hideCloseButton&&Mr({className:"ui-button-icon delete-msg mt-icon-delete-msg",title:"Close message"},"Close message"),zr({className:"inner mt-icon-flash-message"},Br(l))),i.appendChild(a)):(a.querySelector("ul").appendChild(l),n.hideCloseButton&&r.querySelector(".delete-msg").classList.add("mt-hide")),!0===n.scrollTop&&$("html, body").animate({scrollTop:0},"fast");var c=r.querySelector(".delete-msg");c&&(di._handleMessageClose(c),c.focus())}},FlashReload:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.target,i=void 0===r?"":r,a=dr.fetch("mindtouch-flash-message");(a=a||[]).push({text:e,type:t,target:i}),dr.store("mindtouch-flash-message",a)},EmptyFlash:function(e){"all"===(e=e||"error")?(this.EmptyFlash("success"),this.EmptyFlash("error"),this.EmptyFlash("info")):document.querySelectorAll(".".concat(e,"msg")).forEach((function(e){return e.remove()}))},PageRefresh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new cr(window.location.toString());t.setQueryParams(e),window.location.toString()===t.toString()?window.location.reload(!0):window.location.href=t.toString()},redirectTo:function(e){(window.parent?window.parent.window:window).location.href=e},appendPageHtml:function(e,t,n){n.empty(),Zr(n[0]),new Ut(Bn.get("pageId"),_r).getHtmlTemplate(e,t).then((function(e){var t=e.body;$(t).each((function(){var e=$(this);e.is("script")?$("head").append(e):n.append(e)})),ei(n[0]),$(document).trigger(Jr.Template.Loaded)}))},isSmallTouchDevice:"ontouchstart"in document.documentElement&&"function"==typeof window.matchMedia&&window.matchMedia("(max-device-width:1024px)").matches};ai((function(){document.querySelectorAll(".delete-msg").forEach((function(e){di._handleMessageClose(e)}));var e="mindtouch-flash-message";(dr.fetch(e)||[]).forEach((function(e){di.Flash(e.text,e.type,{target:e.target})})),dr.clearStorage(e)}));var hi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";r(this,e),"string"!=typeof t&&(t=""),t.startsWith("#")&&(t=t.substr(1)),this._hashStr=t,this._params=dr.getStringParams(t)}return a(e,[{key:"getQueryParams",value:function(){return this._params}},{key:"replaceParams",value:function(t){return new e(dr.buildQueryString(t))}},{key:"withParam",value:function(e,t){var n=this._params;return n[e]=t,this.replaceParams(n)}},{key:"withoutParam",value:function(e){var t=this._params;return delete t[e],this.replaceParams(t)}},{key:"getParam",value:function(e){return this._params[e]}},{key:"toHashString",value:function(){return"#"+this._hashStr}}]),e}(),mi={_hasPushState:window.history&&window.history.pushState,generateHistoryUri:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.pathname,n=new cr(t);return e&&n.addQueryParams(e),n.toString()},getParametersFromQuery:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",t="",n={},r=window.location.hash.substr(1);"hash"!==e?(t=window.location.search.substr(1),"all"===e&&""!==r&&(t+="&"+window.location.hash.substr(1))):""!==r&&(t+="&"+window.location.hash.substr(1));var i=t.split("&");return i.forEach((function(e){var t=f(e.split("="),2),r=t[0],i=t[1];i&&""!==i&&(n[r]=decodeURIComponent(i.replace(/\+/g," ")))})),n},pushHistory:function(e,t,n){this._hasPushState?window.history.pushState(e,t,n):window.location.hash=this.getQueryStringAsHash()},replaceHistory:function(e,t,n){this._hasPushState?window.history.replaceState(e,t,n):window.location.hash=this.getQueryStringAsHash()},getQueryStringAsHash:function(e){var t=e.split("?"),n=t.length>1?t[1]:"";return"#".concat(n)}},fi={$visibleElements:[],elementSearchArray:[],config:{},setConfig:function(e){Bn.set("webFontConfig",e)},addGoogleFontFamily:function(e){var t=Bn.get("webFontConfig");t.google=t.google||{},t.google.families=t.google.families||[],t.google.families.push(e),this.setConfig(t)},getFontElements:function(){return this.elementSearchArray},setFontElements:function(e){this.elementSearchArray=Array.isArray(e)?e:[]},addFontElements:function(e){var t=this;e.length>0&&e.forEach((function(e){t.elementSearchArray.indexOf(e)<0&&t.elementSearchArray.push(e)}))},removeFontElements:function(e){var t=this;e.length>0&&e.forEach((function(e){var n=t.elementSearchArray.indexOf(e);n>=0&&t.elementSearchArray.splice(n,1)}))},loadFonts:function(){var e=this,t=e.elementSearchArray.toString().trim(","),n=Bn.get("webFontConfig");n.timeout=3e3,n.loading=function(){e.$visibleElements=$(".wf-loading").find(t).filter(":visible"),e.$visibleElements.css("visibility","hidden")},n.active=function(){e.$visibleElements.css("visibility","visible")},n.inactive=function(){e.$visibleElements.css("visibility","visible")},Bn.set("webFontConfig",n),WebFont.load(n)}},pi=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;return r(this,t),(n=h(this,l(t).call(this,e)))._plug=new S(i.host,i.plugConfig).at("@api","deki","drafts",n._id,"properties"),n}return s(t,e),t}($t),gi=Bn.get("clientSideWarnings");function vi(){var e;gi&&(e=console).warn.apply(e,arguments)}function yi(e){return e&&0!==e.length?(vi("Fetching missing parsed keys from API",e),new _n(_r).getResourceStrings({keys:e}).then((function(e){var t=e.localizations.filter((function(e){return e.missing}));return t.length>0&&vi("Some resources could not be fetched",t),e.localizations.filter((function(e){return!e.missing})).reduce((function(e,t){return e[t.resource]=t.text,e}),{})}))):Promise.resolve({})}function bi(e){return function(t){var n=e[t],r=t;if("string"==typeof n){for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];r=wi.apply(void 0,[n].concat(a))}else vi("Unable to find a localization for key '".concat(t,"'"));return r}}function wi(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(e,t,n){var r=new RegExp("\\{"+n+"\\}","g");return e=e.replace(r,t)}),e)}function _i(e,t){return e.reduce((function(e,n){var r=n;if("string"==typeof t){if(!n.startsWith(t))return e;r=r.replace(t,"")}var i=r.split(/\.|-/).filter((function(e){return""!==e}));return e[r=i.reduce((function(e,t,n){var r=0===n?"toLowerCase":"toUpperCase";return e+t.charAt(0)[r]()+t.substr(1)}),"")]=n,e}),{})}function ki(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onmissingkeysfetched,i=void 0===r?function(){}:r,a={},o=document.getElementById(e);if(!o)return vi("Localization element with id '".concat(e,"' cannot be found on page")),function(e){return e};var s=o.textContent.replace("/*<![CDATA[*/","").replace("/*]]>*/","");try{Object.assign(a,JSON.parse(s))}catch(t){vi("Error parsing localizations for '#".concat(e,"'"))}var l=Object.keys(a).filter((function(e,t,n){return n[t].match(/\[MISSING: .+]/)}));if(l.length>0&&vi("Some of the parsed resources are missing",l),Array.isArray(t)){var c=t.filter((function(e){return!(e in a)}));yi(c).then((function(e){Object.assign(a,e),i(e)}))}return bi(a)}var Pi=Object.freeze({formatString:wi,mapKeys:_i,makeLocalizer:ki,makeFetchedLocalizer:function(e){return new _n(_r).getResourceStrings({keys:e}).then((function(e){return bi(e.localizations.reduce((function(e,t){return e[t.resource]=t.text,e}),{}))}))},formatApiException:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UI";"UI"!==t&&(e=e.toLowerCase());var n=e.split(".");return n[0]=t,n.join(".")},makeLocalizerWithTemplating:function(e){return function(t){var n=JSON.parse(e)[t];void 0===n&&(n=t);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return i&&i.length>0&&p(Array(i.length).keys()).forEach((function(e){n=n.replace("$".concat(e+1),"{".concat(e,"}"))})),wi.apply(void 0,[n].concat(i))}}}),Ti=function(){function e(t){if(r(this,e),"MindTouchComponent"===this.constructor.name)throw new TypeError("MindTouchComponent can not be constructed directly.");this._events={},this._options=t,this._initialOptions=t,this._defaultOptions={}}return a(e,[{key:"initialize",value:function(e){var t=e.defaults,n=e.events,r=void 0===n?[]:n;Object.assign(this._defaultOptions,t),this._options=Object.assign({},this._defaultOptions,this._initialOptions),this.addEvents(r)}},{key:"setOptionsDefaults",value:function(e,t){this._options=Object.assign({},t,e)}},{key:"addEvent",value:function(e,t){"function"==typeof t&&(this._events[e]||(this._events[e]=[]),this._events[e].push(t))}},{key:"addEvents",value:function(e){var t=this;e.forEach((function(e){var n=t.options[e];n&&"function"==typeof n&&t.addEvent(e,n)}))}},{key:"callEvent",value:function(e,t){this._events[e]&&this._events[e].forEach((function(e){return e({detail:t})}))}},{key:"clearEvents",value:function(e){var t=this;(e&&Array.isArray(e)?e:Object.keys(this._events)).forEach((function(e){delete t._events[e]}))}},{key:"element",get:function(){return this._element},set:function(e){this._element=e}},{key:"options",get:function(){return this._options}},{key:"events",get:function(){return this._events}}]),e}(),Si={};function Ei(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(e,t,n){var r=new RegExp("\\{"+n+"\\}","g");return e=e.replace(r,t)}),e)}function Ci(){var e;(e=console).warn.apply(e,arguments)}function xi(e){var t=Object.keys(Si),n=e.filter((function(e){return!t.includes(e)}));return p(new Set(n))}function Ri(e,t){return ji.apply(this,arguments)}function ji(){return(ji=n(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=xi(t))&&0!==r.length){e.next=3;break}return e.abrupt("return",{});case 3:if(n){e.next=5;break}throw new Error("Attempting to fetch translations from the API without supplying `martianSettings`");case 5:return i=new _n(n),e.next=8,i.getResourceStrings({keys:r});case 8:return a=e.sent,o=a.localizations,(s=o.filter((function(e){return e.missing}))).length>0&&Ci("Some resources could not be fetched",s),l=o.filter((function(e){return!e.missing})).reduce((function(e,t){return e[t.resource]=t.text,e}),{}),Object.assign(Si,l),e.abrupt("return",l);case 15:case"end":return e.stop()}}),e,this)})))).apply(this,arguments)}function Ai(e){var t=Si[e],n=e;if("string"==typeof t){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];n=Ei.apply(void 0,[t].concat(i))}else Ci("Unable to find a localization for key '".concat(e,"'"));return n}var Ii,Ni,Di=function(e){return function(e){function t(){return r(this,t),h(this,l(t).apply(this,arguments))}var i;return s(t,e),a(t,[{key:"initLocalizations",value:(i=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=xi(this.constructor.resourceKeys||[]))&&t.length>0)){e.next=4;break}return e.next=4,Ri(t,this.martianSettings);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"localize",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Ai.apply(void 0,[e].concat(n))}}]),t}(e)},Li=Object.freeze({clearTranslationCache:function(){Si={}},getResourceKeysDifference:xi,populateTranslationsFromElement:function(e){var t=document.getElementById(e);if(!t)return Ci("Localization element with id '".concat(e,"' cannot be found on page.")),{};var n=t.textContent.replace("/*<![CDATA[*/","").replace("/*]]>*/",""),r={};try{r=JSON.parse(n)}catch(t){Ci("Error parsing localization JSON for '#".concat(e,"'."))}var i=Object.entries(r).filter((function(e){return f(e,2)[1].match(/\[MISSING: .+]/)})).map((function(e){return f(e,1)[0]}));return i.length>0&&Ci("Some of the parsed resources are missing",i),Object.assign(Si,r),r},populateTranslationsFromObject:function(e){return Object.assign(Si,e),e},populateTranslationsFromApi:Ri,localize:Ai,LocalizerClient:Di}),Fi=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{autoClose:!0,destroyOnClose:!0,isIframe:!1,modalAdditionalClasses:[],modalElementId:"mt-modal-dialog",preventScrolling:!0,showPrimaryButton:!0,showSecondaryButton:!0,showXButton:!0,tabbedContent:!1,openOnCreate:!0},events:["onconfirm","oncancel","onclose","onmodalopened"]}),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.Common.button.cancel","Dialog.Common.button.close","Dialog.Common.button.ok"]}}]),a(i,[{key:"open",value:function(){this.options.preventScrolling&&document.body.classList.add("mt-modal-open"),this.element.showModal(),this.callEvent("onmodalopened")}},{key:"close",value:function(){this.options.preventScrolling&&document.body.classList.remove("mt-modal-open"),this.element.close(),this.options.destroyOnClose&&this.remove(),this.callEvent("onclose")}},{key:"remove",value:function(){this.options.preventScrolling&&document.body.classList.remove("mt-modal-open"),this.element.parentElement&&this.element.parentElement.removeChild(this.element),delete this.element}},{key:"enablePrimary",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enable,n=void 0===t||t,r=e.classToggle;this._primaryButton.disabled=!n,r&&oi(this._primaryButton,r,!n)}},{key:"_createUi",value:function(){var e=this,t=["mt-modal","ui-dialog-content","ui-widget-content"],n=this.options.isIframe?this.iframeStyling.dialogContent:{display:"block",width:"auto",minHeight:"104px",maxHeight:"none",height:"auto"};t.push.apply(t,p(this.options.modalAdditionalClasses)),this.element=Ir("dialog",{className:["ui-dialog","ui-widget","ui-widget-content","ui-corner-all","ui-front mt-dialog","mt-modal-wrapper"].join(" "),role:"dialog",tabIndex:-1,style:this.options.isIframe?this.iframeStyling.dialog:{},oncancel:function(){return e._sendEvent("oncancel")}},zr({style:this.options.isIframe?this.iframeStyling.titleBar:{},className:"ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"},Ur({className:"ui-dialog-title",style:this.options.isIframe?this.iframeStyling.title:{}},this.options.title),this.options.showXButton&&Mr({className:"ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only ui-dialog-titlebar-close",role:"button",title:this.localize("Dialog.Common.button.close"),type:"button",style:this.options.isIframe?this.iframeStyling.titleClose:{},onclick:function(){return e._sendEvent("oncancel")}},Ur({className:"ui-button-icon-primary ui-icon ui-icon-closethick"}),Ur({className:"ui-button-text"}))),zr({className:t.join(" "),dataset:this.options.gaAction?{gaAction:this.options.gaAction}:{},style:n,id:this.options.modalElementId},this._contentContainer=zr({className:"mt-scrolling-dialog-content".concat(this.options.tabbedContent?" tabbed-content":""),style:this.options.isIframe?this.iframeStyling.content:{}},this.options.content),zr({className:"mt-dialog-button-container"},(this.options.showPrimaryButton||this.options.showSecondaryButton)&&zr({className:"ui-dialog-buttonset",style:this.options.isIframe?this.iframeStyling.buttonset:{}},this.options.f1Title&&this.options.f1Url&&qr({className:"mt-f1-success mt-f1-link",title:this.options.f1Title,href:this.options.f1Url,target:"_blank",onclick:function(){setTimeout((function(){return e.close()}),10)}},Ur({className:"ui-icon mt-icon-f1-link"}),this.options.f1Title),this.options.showPrimaryButton&&(this._primaryButton=Mr({style:this.options.isIframe?this.iframeStyling.confirm:{},className:"mt-button ui-button-primary",onclick:this.options.primaryActionIsCancel?function(){return e._sendEvent("oncancel")}:function(){return e._sendEvent("onconfirm")},dataset:this.options.primaryButtonGaLabel?{gaLabel:this.options.primaryButtonGaLabel}:{}},this.options.primaryButtonText||this.localize("Dialog.Common.button.ok"))),this.options.showSecondaryButton&&Mr({style:this.options.isIframe?this.iframeStyling.cancel:{},className:"mt-button ui-button-secondary",onclick:this.options.primaryActionIsCancel?function(){return e._sendEvent("onconfirm")}:function(){return e._sendEvent("oncancel")},dataset:this.options.secondaryButtonGaLabel?{gaLabel:this.options.secondaryButtonGaLabel}:{}},this.options.secondaryButtonText||this.localize("Dialog.Common.button.cancel")))))),"undefined"!=typeof dialogPolyfill&&dialogPolyfill.registerDialog(this.element),document.body.appendChild(this.element),this.options.openOnCreate&&this.open()}},{key:"_sendEvent",value:function(e){this.callEvent(e),this.options.autoClose&&this.close()}},{key:"content",get:function(){return this._contentElement},set:function(e){this._contentElement=e,ni(this._contentContainer),this._contentContainer.appendChild(this._contentElement)}},{key:"iframeStyling",get:function(){return{buttonset:{float:"right",textAlign:"right",width:"100%",paddingRight:"1%",paddingBottom:"1%"},content:{paddingTop:"30px",paddingBottom:"10px",paddingLeft:"1%",paddingRight:"1%",fontFamily:"lato,arial,helvetica,sans-serif,'arial unicode ms'"},confirm:{background:"#747474",border:"1px solid #1b1b1b",color:"#fff",textShadow:"none",fontSize:"1rem",borderRadius:".25em",boxSizing:"border-box",display:"inline-block",fontWeight:400,lineHeight:2,outline:0,padding:"0 .8em",marginRight:"1%"},cancel:{background:"#efefef",border:"1px solid #969696",borderRadius:".25em",boxSizing:"border-box",color:"#000",fontSize:"1rem",display:"inline-block",fontWeight:400,lineHeight:2,outline:0,padding:"0 .8em"},dialog:{left:0,margin:"0 auto",position:"fixed",right:0,top:"50%",transform:"translate(0,-50%)",border:"1px solid #30b3f6",borderRadius:".5em",boxShadow:"0 0 1em rgba(48,179,246,.25)",boxSizing:"border-box",fontSize:"105%",height:"auto !important",width:"93% !important",padding:0},dialogContent:{display:"block",width:"auto",minHeight:"104px",maxHeight:"none",height:"auto",marginTop:"2%",marginBottom:"2%"},titleBar:{float:"left",background:"#e5f5fe",border:"1px solid #30b3f6",color:"#000",fontFamily:"lato,arial,helvetica,sans-serif,'arial unicode ms'",borderRadius:".5em .5em 0 0",borderWidth:"0 0 1px",width:"100%",paddingTop:"1%",paddingBottom:"1%"},title:{paddingLeft:"1%"},titleClose:{display:"none"}}}}]),i}(Di(Ti)),qi=function(e){var t,i,o;function c(e){var t;if(r(this,c),(t=h(this,l(c).call(this,e))).initialize({defaults:{collapsed:!1},events:["onclose","onopen"]}),t.options.container&&("title"in t.options.container.dataset&&(t.options.toggleTitle=t.options.container.dataset.title),"collapsed"in t.options.container.dataset&&(t.options.collapsed="true"===t.options.container.dataset.collapsed)),void 0===t.options.toggleTitle&&(t.options.toggleTitle=t.localize("Component.CollapsibleSection.label.toggle-title")),t.options.settingsCollapsedKey){var n=dr.fetch(e.settingsCollapsedKey);null!==n&&(t.options.collapsed=n)}return t._collapsibleElement=t.options.content,t}return s(c,e),a(c,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.CollapsibleSection.label.toggle-title"]}}]),a(c,[{key:"toggle",value:(o=n(regeneratorRuntime.mark((function e(){var t,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:250,this.toggleElement.classList.contains("mt-toggle-expand")?this.open(t):this.close(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"open",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;this.toggleElement.classList.add("mt-toggle-collapse"),this.toggleElement.classList.remove("mt-toggle-expand"),this.element.dataset.collapsed=!1,ci.open(this._collapsibleElement,e),this.options.settingsCollapsedKey&&dr.store(this.options.settingsCollapsedKey,!1),this.callEvent("onopen")}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250;this.toggleElement.classList.remove("mt-toggle-collapse"),this.toggleElement.classList.add("mt-toggle-expand"),this.element.dataset.collapsed=!0,ci.close(this._collapsibleElement,e),this.options.settingsCollapsedKey&&dr.store(this.options.settingsCollapsedKey,!0),this.callEvent("onclose")}},{key:"_createUi",value:(i=n(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.options.container?this.element=this.options.container:this.element=zr(),this.element.classList.add("mt-toggle-container"),this.toggleElement=Mr({className:"mt-toggle mt-summary-toggle ui-button-icon ".concat(this.options.collapsed?"mt-toggle-expand":"mt-toggle-collapse"),type:"button",onclick:function(){n.toggle()}},this.options.toggleTitle),this.element.prepend(this.toggleElement),(t=this.element.querySelector(".mt-collapsible-section"))?this._collapsibleElement=t:this.element.appendChild(this._collapsibleElement),this.options.collapsed?this.close(0):this.element.dataset.collapsed=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}]),c}(Di(Ti));var Mi=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{placeholderClasses:[],blockClass:"mt-sortable-element",intersectThreshold:.5,dragOpacity:.5,trackDirection:"both",dragStartBlacklist:[],constrainToElement:!0,dynamicDragWidth:!0},events:["onorderchanged","ondragended","ondragstarting"]}),t.element=t.options.container,t._dragPositionStyle="fixed",t._placeholderClasses=["mt-sortable-drag-target","mt-sortable-placeholder"].concat(p(t.options.placeholderClasses)),t._blockClass=t.options.blockClass,t._handleClass=t.options.handleClass,t._ignoreBlockClass=t.options.ignoreBlockClass,t.options.intersectThreshold<.5?t._intersectThreshold=.5:t.options.intersectThreshold>1?t._intersectThreshold=1:t._intersectThreshold=t.options.intersectThreshold,t.options.dragOpacity<0?t._dragOpacity=0:t.options.dragOpacity>1?t._dragOpacity=1:t._dragOpacity=t.options.dragOpacity,t._trackDirection=t.options.trackDirection,t._dragStartBlacklist=t.options.dragStartBlacklist,t._constrainToElement=t.options.constrainToElement,t._dynamicDragWidth=t.options.dynamicDragWidth,t._dragState={x:0,y:0,initialIndex:null,marginLeft:0,marginTop:0},t._dragElement=null,t._enabled=!0,Array.from(t.element.querySelectorAll(".".concat(t._handleClass||t._blockClass))).forEach((function(e){for(var n=e;!n.classList.contains(t._blockClass);)n=e.parentElement;t._setUpElement(n,e)})),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.abrupt("return",n);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(i,[{key:"addElement",value:function(e){this._setUpElement(e,this._getClickElement(e)),this._element.appendChild(e)}},{key:"activateElement",value:function(e){this._setUpElement(e,this._getClickElement(e))}},{key:"removeElement",value:function(e){this._element.removeChild(e)}},{key:"_getSwapTarget",value:function(){var e=this,t="before";return{target:Array.from(this._element.querySelectorAll(".mt-sortable-drag-target")).find((function(n){if(n.classList.contains("mt-sortable-dragging"))return!1;if(e._ignoreBlockClass&&n.classList.contains(e._ignoreBlockClass))return!1;if(n.classList.contains("mt-sortable-placeholder"))return t="after",!1;var r,i,a,o=e._dragElement.getBoundingClientRect(),s=o.width*o.height,l=n.getBoundingClientRect(),c=l.width*l.height,u=function(e,t){if(e.left>t.right||e.top>t.bottom||e.right<t.left||e.bottom<t.top)return null;var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),i=Math.max(e.top,t.top),a=Math.min(e.bottom,t.bottom),o=r-n,s=a-i;return{left:n,right:r,top:i,bottom:a,width:o,height:s,area:o*s}}(o,l);return null!==u&&(r=Math.min(s,c),i=u.area,a=e._intersectThreshold,i/r>=a)})),direction:t}}},{key:"_indexOf",value:function(e){return Array.from(document.querySelectorAll(".".concat(this._blockClass))).findIndex((function(t){return t===e}))}},{key:"_setDragLocation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._dragElement.getBoundingClientRect(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._trackDirection,i=this._dragState.offsetX+e,a=this._dragState.offsetY+t;if(this._constrainToElement){var o=parseInt(this._elementComputedStyle.height,10),s=this._containerRect.top+o;a<this._containerRect.top?a=this._containerRect.top:a+n.height>s&&(a=s-n.height);var l=parseInt(this._elementComputedStyle.width,10),c=this._containerRect.left+l;i<this._containerRect.left?i=this._containerRect.left:i+n.width>c&&(i=c-n.width)}"horizontal"!==r&&"both"!==r||(this._dragElement.style.left="".concat(i,"px")),"vertical"!==r&&"both"!==r||(this._dragElement.style.top="".concat(a,"px"))}},{key:"_dragTracker",value:function(e){var t,n=this._getSwapTarget(),r=n.target,i=n.direction,a=e.pageX,o=e.pageY;if(r){if(this._dynamicDragWidth){var s=getComputedStyle(r);t=this._dragElement.getBoundingClientRect();var l=parseInt(s.width,10),c=t.width;this._dragState.offsetX+=c-l,this._dragElement.style.width=s.width}var u=this._element.removeChild(this._placeholder);"before"===i?this._element.insertBefore(u,r):ri(u,r)}this._setDragLocation(a,o,t)}},{key:"_endDrag",value:function(){this._element.replaceChild(this._dragElement,this._placeholder);var e=this._dragState.initialIndex,t=this._indexOf(this._dragElement);e!==t&&this.callEvent("onorderchanged",{from:e,to:t,element:this._dragElement}),this._dragElement.classList.remove("mt-sortable-dragging"),this._dragElement.style.width="",this._dragElement.style.position="",this._dragElement.style.opacity="",this._dragElement.style.overflow="",this._dragElement.style.zIndex="",this._dragElement.style.left="",this._dragElement.style.top="",this.callEvent("ondragended",{element:this._dragElement}),document.removeEventListener("mousemove",Ni),document.removeEventListener("mouseup",Ii)}},{key:"_startDrag",value:function(e,t){var n=this;this._dragElement=e,this._placeholder=this._dragElement.cloneNode(!0),this._placeholder.id="mt-sortable-placeholder",this._placeholderClasses.forEach((function(e){n._placeholder.classList.add(e)}));var r=getComputedStyle(this._dragElement);this._dragElement.classList.add("mt-sortable-dragging"),this._dynamicDragWidth&&(this._dragElement.style.width=r.width),this._dragElement.style.opacity=this._dragOpacity,this._dragElement.style.overflow="none",this._dragElement.style.zIndex=2e3,this._dragState.initialIndex=this._indexOf(e),this._elementComputedStyle=getComputedStyle(this._element),this._element.style.minHeight=this._elementComputedStyle.height;var i=this._dragElement.getBoundingClientRect();this._dragElement.style.position=this._dragPositionStyle,this._element.style.minHeight="",this._element.insertBefore(this._placeholder,this._dragElement);var a=parseInt(r["margin-left"],10),o=parseInt(r["margin-top"],10);this._dragState.offsetX=i.left-a-t.x,this._dragState.offsetY=i.top-o-t.y,this._containerRect=this._element.getBoundingClientRect(),this.callEvent("ondragstarting",{element:this._dragElement}),this._setDragLocation(t.x,t.y,this._dragElement.getBoundingClientRect(),"both"),Ii=function(e){return n._endDrag(e)},document.addEventListener("mouseup",Ii,!1),Ni=function(e){return n._dragTracker(e)},document.addEventListener("mousemove",Ni,!1)}},{key:"_setUpElement",value:function(e,t){var n=this;e.classList.add("mt-sortable-drag-target"),t.addEventListener("mousedown",(function(t){if(n._enabled){var r=!0;n._dragStartBlacklist.every((function(e){return!t.target.classList.contains(e)||(r=!1,!1)})),r&&0===t.button&&(t.stopPropagation(),n._startDrag(e,{x:t.pageX,y:t.pageY}))}}),!1)}},{key:"_getClickElement",value:function(e){var t=e;return this._handleClass&&(t=e.querySelector(".".concat(this._handleClass))),t}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}}]),i}(Ti),zi={EN:"Component.Translate.label.english",ES:"Component.Translate.language.spanish",DE:"Component.Translate.language.german",JA:"Component.Translate.language.japanese",ZH:"Component.Translate.language.chinese","ZH-TW":"Component.Translate.language.chinese-traditional",FR:"Component.Translate.language.french",PT:"Component.Translate.language.portuguese",NL:"Component.Translate.language.dutch",KO:"Component.Translate.language.korean",SV:"Component.Translate.language.swedish",DA:"Component.Translate.language.danish","FA-AF":"Component.Translate.language.dari",FI:"Component.Translate.language.finnish",IT:"Component.Translate.language.italian",AF:"Component.Translate.language.afrikaans",SQ:"Component.Translate.language.albanian",AM:"Component.Translate.language.amharic",AR:"Component.Translate.language.arabic",HY:"Component.Translate.language.armenian",AZ:"Component.Translate.language.azerbaijani",BN:"Component.Translate.language.bengali",BS:"Component.Translate.language.bosnian",BG:"Component.Translate.language.bulgarian",CA:"Component.Translate.language.catalan",CS:"Component.Translate.language.czech",HR:"Component.Translate.language.croatian",ET:"Component.Translate.language.estonian",FA:"Component.Translate.language.farsi","FR-CA":"Component.Translate.language.french.canada",KA:"Component.Translate.language.georgian",EL:"Component.Translate.language.greek",GU:"Component.Translate.language.gujarati",HT:"Component.Translate.language.haitian-creole",HA:"Component.Translate.language.hausa",HE:"Component.Translate.language.hebrew",HI:"Component.Translate.language.hindi",HU:"Component.Translate.language.hungarian",IS:"Component.Translate.language.icelandic",ID:"Component.Translate.language.indonesian",KN:"Component.Translate.language.kannada",KK:"Component.Translate.language.kazakh",LV:"Component.Translate.language.latvian",LT:"Component.Translate.language.lithuanian",MK:"Component.Translate.language.macedonian",MS:"Component.Translate.language.malay",ML:"Component.Translate.language.malayalam",MT:"Component.Translate.language.maltese",MN:"Component.Translate.language.mongolian",NO:"Component.Translate.language.norwegian",PS:"Component.Translate.language.pashto",PL:"Component.Translate.language.polish",RO:"Component.Translate.language.romanian",RU:"Component.Translate.language.russian",SR:"Component.Translate.language.serbian",SI:"Component.Translate.language.sinhala",SK:"Component.Translate.language.slovak",SL:"Component.Translate.language.slovenian","ES-MX":"Component.Translate.language.spanish-mexico",SO:"Component.Translate.language.somali",SW:"Component.Translate.language.swahili",TL:"Component.Translate.language.tagalog",TA:"Component.Translate.language.tamil",TE:"Component.Translate.language.telugu",TH:"Component.Translate.language.thai",TR:"Component.Translate.language.turkish",UK:"Component.Translate.language.ukrainian",UR:"Component.Translate.language.urdu",UZ:"Component.Translate.language.uzbek",VI:"Component.Translate.language.vietnamese",CY:"Component.Translate.language.welsh"},Oi=function(){function e(){r(this,e)}return a(e,null,[{key:"generateUrl",value:function(e,t){var n=new URL(e);return n.searchParams.delete("mt-language"),t&&n.searchParams.set("mt-language",t),n.href}},{key:"modifyInternalLinks",value:function(e,t){var n=this;e.querySelectorAll("a[href*='".concat(window.location.hostname,"']")).forEach((function(e){var r=new URL(e.href).pathname.toLowerCase();r.startsWith("/special:")||r.startsWith("/template:")||r.startsWith("/user:")||(e.href=n.generateUrl(e.href,t))}))}},{key:"normalizeLanguageCode",value:function(e){if(e&&"string"==typeof e){var t=e.trim().substring(0,5).toUpperCase();return zi.hasOwnProperty(t)?t:t.substring(0,2)}return null}},{key:"resourceKey",value:function(e){return zi[this.normalizeLanguageCode(e)]||null}},{key:"resourceKeys",get:function(){return Object.values(zi)}}]),e}(),Ui=Object.freeze({TranslateUtils:Oi}),Bi=null,Hi=function(){function e(){if(r(this,e),null!==Bi)return Bi;Bi=this;var t=Bn.get("pageId");this._loaded={},this._classNames={classification:{classificationType:"mt-classification-type-select",classificationPrefixSelect:"mt-classification-prefix-select",settingsContainer:"mt-guide-tab-settings",typeSelectPrefix:"mt-classification-",currentType:"mt-classification-current-type",submitButton:"mt-classification-settings-submit"},paths:{settingsContainer:"mt-guide-tab-settings-learning-path",listContainer:"mt-lp-listings",displayContainer:"mt-lp-path-container",addPathButton:"mt-path-settings-submit",deletePathButton:"mt-delete-path"},guideTab:"mt-guide-content",hide:"mt-hide"},this._localize=ki("mt-localizations-guide-tabs-settings",["MindTouch.IDF3.label.guide.settings.classifications","MindTouch.IDF3.label.guide.settings.learningpath","MindTouch.IDF3.label.overview.max.count","MindTouch.IDF3.label.overview.max.count.over","MindTouch.LearningPath.dialog.remove.cancel","MindTouch.LearningPath.dialog.remove.confirm","MindTouch.LearningPath.dialog.remove.header","MindTouch.LearningPath.dialog.remove.message"]),this._pathSettingsTitle=this._localize("MindTouch.IDF3.label.guide.settings.learningpath"),this._classificationSettingsTitle=this._localize("MindTouch.IDF3.label.guide.settings.classifications"),this._$pageEl=$("#pageText"),this._guideTabProperty="mindtouch#idf.guideTabs",this._onLoadMap={"MindTouch/IDF3/Views/Path":this._pathOnLoad.bind(this),"MindTouch/IDF3/Views/Classification":this._classificationOnLoad.bind(this)},this._propApi=Bn.get("isDraftRequest")?new pi(t,_r):new Vt(t,_r),this._languageCode=Oi.normalizeLanguageCode(new URL(window.location.href).searchParams.get("mt-language")),this._initPaths(),this._initClassifications()}return a(e,[{key:"hasGuideTabs",value:function(){var e=this;return new Promise((function(t){e.getGuideTabs().then((function(e){t(e.length>0)}))}))}},{key:"getGuideTabs",value:function(){return this._propApi.getPropertyContents(this._guideTabProperty).then((function(e){return e.json()})).then((function(e){return e||[]})).catch((function(e){return Promise.reject(e)}))}},{key:"reloadGuideTab",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._loaded[e.guid]=!1;var r=document.getElementById(e.guid);return n&&Zr(r),this.getGuideTabContent(e).then((function(n){if(t._languageCode){var i=(new DOMParser).parseFromString(n.body,"text/html").getElementsByTagName("div").item(0);Oi.modifyInternalLinks(i,t._languageCode),n.body=i.outerHTML}document.getElementById(e.guid).innerHTML=n.body,ei(r),t.initGuideTab(e)}))}},{key:"initGuideTab",value:function(e){"function"!=typeof this._onLoadMap[e.templatePath]||this._loaded[e.guid]||(this._loaded[e.guid]=!0,this._onLoadMap[e.templatePath](e.guid))}},{key:"initSingleTab",value:function(){var e=this;this.getGuideTabs().then((function(t){e.initGuideTab(t[0])}))}},{key:"getGuideTabContent",value:function(e){var t=Bn.get("pageId"),n="Template:".concat(decodeURIComponent(e.templatePath)),r=new Ut(n,_r),i={pageid:t,draft:Bn.get("isDraftRequest"),guid:e.guid},a=Bn.get("pageContentViewParser");return a&&(i.parser=a),"settings"in e&&(i=dr.extendObject(i,e.settings)),this._languageCode&&(i.translate=this._languageCode),r.getContents(i)}},{key:"setGuideTabs",value:function(e){return this._propApi.setProperty(this._guideTabProperty,{text:JSON.stringify(e)},{abort:"never"})}},{key:"setGuideTab",value:function(e){var t=this;return new Promise((function(n,r){var i=e.guid;i?t.getGuideTabs().then((function(n){for(var r=0;r<n.length;r++)if(n[r].guid===i){n[r]=e;break}return t.setGuideTabs(n)})):r("Tab data must include a guid")}))}},{key:"updateGuideTab",value:function(e){var t=this,n=e.guid;if(n)return Zr(document.getElementById(n)),this.getGuideTabs().then((function(r){var i,a=!0,o=!1,s=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;if(u.guid===n){i=u,Object.assign(i,e);break}}}catch(e){o=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(o)throw s}}return t.setGuideTabs(r).then((function(){var e=document.getElementById(i.guid);return t.reloadGuideTab(i,!1).then((function(){e.dispatchEvent(new CustomEvent("reloaded",{detail:{tabData:i}}))}))}))}));Promise.reject("Tab data must include a guid")}},{key:"_classificationOnLoad",value:function(e){var t=document.getElementById(e).querySelector(".".concat(this._classNames.classification.settingsContainer));t&&qi.create({collapsed:"true"===t.dataset.collapsed,container:t,toggleTitle:this._classificationSettingsTitle})}},{key:"_updateClassificationSettings",value:function(e){var t=e.querySelector(".".concat(this._classNames.classification.currentType)),n={guid:e.closest(".".concat(this._classNames.guideTab)).id,settings:{classification:t.dataset.prefix,type:t.value}};this.updateGuideTab(n)}},{key:"_initClassifications",value:function(){var e=this;this._$pageEl.on("change",".".concat(this._classNames.classification.classificationPrefixSelect),(function(t){var n=t.currentTarget,r=n.closest(".".concat(e._classNames.classification.settingsContainer)),i=r.querySelector(".".concat(e._classNames.classification.typeSelectPrefix).concat(n.value));ii(".".concat(e._classNames.classification.classificationType),r).forEach((function(t){"mt-classification-select"!==t.id&&(t.classList.add(e._classNames.hide),t.classList.remove(e._classNames.classification.currentType))})),i.classList.add(e._classNames.classification.currentType),i.classList.remove(e._classNames.hide)})),this._$pageEl.on("click",".".concat(this._classNames.classification.submitButton),(function(t){var n=t.currentTarget.closest(".".concat(e._classNames.classification.settingsContainer));e._updateClassificationSettings(n)}))}},{key:"_initPaths",value:function(){var e=this,t=this;this._$pageEl.on("click",".".concat(this._classNames.paths.deletePathButton),(function(t){t.preventDefault();var n=t.currentTarget,r=n.closest(".".concat(e._classNames.guideTab)).id,i=n.parentElement.querySelector(".".concat(e._classNames.paths.displayContainer)).dataset.lpName;e._deletePath(r,i)})),this._$pageEl.on("click",".".concat(this._classNames.paths.addPathButton),(function(e){e.preventDefault(),$("<div></div>").modal({width:600,height:500,naming:{view:"insert_learning_path",namespace:"InsertLearningPath"},requirePage:!1,dialogClass:"filemodal mt-tabbed-dialog",params:{hidePagesAllowed:!1},load:function(){t._getPathDialog().then((function(n){n.init({submit:function(n){var r=e.currentTarget.closest(".".concat(t._classNames.guideTab)).id;t._updatePathSettings(r,n)}})}))}})}))}},{key:"_updatePathSettings",value:function(e,t){var n=this._getPathIds(e);n.push(t);var r={guid:e,settings:{learningPathIds:n}};this._setPathIds(e,n),this.updateGuideTab(r)}},{key:"_getPathDialog",value:function(){return dr.importModule({path:"/@lib/src/standalone/dialog.insertLearningPath.js",moduleName:"insertLearningPathDialog"})}},{key:"_deletePath",value:function(e,t){var n=this;Fi.create({content:this._localize("MindTouch.LearningPath.dialog.remove.message"),title:this._localize("MindTouch.LearningPath.dialog.remove.header"),primaryButtonText:this._localize("MindTouch.LearningPath.dialog.remove.confirm"),secondaryButtonText:this._localize("MindTouch.LearningPath.dialog.remove.cancel"),showXButton:!1,onconfirm:function(){var r=n._getPathIds(e);r.splice(r.indexOf(t),1),n._setPathIds(e,r),n.updateGuideTab({guid:e,settings:{learningPathIds:r}})}})}},{key:"_getPathIds",value:function(e){var t,n=document.getElementById(e);n&&(t=n.querySelector(".".concat(this._classNames.paths.settingsContainer)));var r="";return t&&(r=t.dataset.lpIds),r?r.split(","):[]}},{key:"_setPathIds",value:function(e,t){var n,r=document.getElementById(e);r&&(n=r.querySelector(".".concat(this._classNames.paths.settingsContainer))),n&&(n.dataset.lpIds=t.join(","))}},{key:"_pathOnLoad",value:function(e){var t=this;this._setPathIds(e,this._loadPathIdsFromDom(e));var n=document.getElementById(e),r=n.querySelector(".".concat(this._classNames.paths.settingsContainer)),i=n.querySelectorAll(".".concat(this._classNames.paths.listContainer)),a=$(i),o=ii(".mt-lp-pages-container",n);r&&(qi.create({collapsed:"true"===r.dataset.collapsed,container:r,toggleTitle:this._pathSettingsTitle}),a.find("li").hoverableArea({enable:!0})),o.forEach((function(e){qi.create({collapsed:!0,container:e,toggleTitle:t._localize("MindTouch.LearningPath.label.view-path")})})),Mi.create({container:i[0],blockClass:"mt-sortable-listing",handleClass:"ui-sortable-handle-pages",trackDirection:"vertical",onorderchanged:function(){t._pathOrderChanged(e)}})}},{key:"_pathOrderChanged",value:function(e){var t=this._loadPathIdsFromDom(e);this._setPathIds(e,t);var n={guid:e,settings:{learningPathIds:t}};this.updateGuideTab(n)}},{key:"_loadPathIdsFromDom",value:function(e){var t=[],n=document.getElementById(e);return ii(".".concat(this._classNames.paths.displayContainer),n).forEach((function(e){t.push(e.dataset.lpName)})),t}}]),e}();var Wi=function(){function e(){if(r(this,e),"AnalyticsBase"===this.constructor.name)throw new TypeError("AnalyticsBase can not be constructed directly.")}return a(e,[{key:"getSetting",value:function(){}},{key:"log",value:function(){}},{key:"_getPageId",value:function(){var e=this.getSetting("pageId");return void 0===e&&(e=0),0===e&&(e=encodeURIComponent(encodeURIComponent(document.location.pathname.replace(/^\/+/g,"")))),e}}]),e}(),$i={},Vi=new Set;function Ki(e){Object.assign($i,e),Object.keys($i).forEach((function(e){return Vi.add(e)}))}function Gi(e){var t=$i[e];return Qi(e)||console.warn('No entry found in the settings for key "'.concat(e,'".')),t}function Qi(e){return Vi.has(e)}var Yi=function(e){return function(e){function t(){return r(this,t),h(this,l(t).apply(this,arguments))}return s(t,e),a(t,[{key:"getSetting",value:function(e){return Gi(e)}}]),t}(e)},Ji=Object.freeze({populateSettingsFromObject:Ki,populateSettingsFromElement:function(e,t){var n=!0;if(t){var r=Object.keys($i);n=t.every((function(e){return!r.includes(e)}))}if(n){var i,a=document.getElementById(e);if(!a)throw new Error("Unable to find element #".concat(e," to read settings."));try{i=JSON.parse(a.textContent)}catch(t){throw new Error("Unable to parse the text content from the #".concat(e," settings element."))}Ki(i)}},getSetting:Gi,setSetting:function(e,t){$i[e]=t,Vi.add(e)},hasSetting:Qi,clearSettings:function(){$i={},Vi.clear()},SettingsClient:Yi}),Xi=null;function Zi(){return Xi}var ea=function(e){return function(e){function t(){return r(this,t),h(this,l(t).apply(this,arguments))}return s(t,e),a(t,[{key:"martianSettings",get:function(){return Zi()}}]),t}(e)},ta=Object.freeze({setMartianSettings:function(e){Xi=e},getMartianSettings:Zi,clearMartianSettings:function(){Xi=null},MartianClient:ea}),na=null,ra=0,ia=function(){function e(){r(this,e),this._queue=[]}return a(e,null,[{key:"instance",get:function(){return null===na&&(na=new e,window.addEventListener("unload",(function(){ra&&clearInterval(ra),na.dispatch({unload:!0})}),!1),ra=setInterval((function(){na.dispatch()}),5e3)),na}}]),a(e,[{key:"dispatch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.unload,n=void 0!==t&&t;if(!(this._queue.length<1)){var r=!0,i=!1,a=void 0;try{for(var o,s=this._queue[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var l=o.value;try{l(n)}catch(e){}}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}this._queue=[]}}},{key:"enqueue",value:function(e){this._queue.push(e),this._queue.length>=10&&this.dispatch()}}]),e}(),aa=null,oa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.dispatcher,a=void 0===i?ia.instance:i;return r(this,t),(e=h(this,l(t).call(this)))._dispatcher=a,e._isInteractionAnalyticsEnabled=e.getSetting("isInteractionAnalyticsEnabled"),e._isInteractionAnalyticsDebugEnabled=e.getSetting("isInteractionAnalyticsDebugEnabled"),e._isGoogleAnalyticsEnabled=e.getSetting("isGoogleAnalyticsEnabled"),e._events=new $e(e.martianSettings),e._location=null,e._pageId=e._getPageId(),e}return s(t,e),a(t,null,[{key:"instance",get:function(){return null===aa&&(aa=new t),aa}},{key:"selector",get:function(){return"[data-ga-label],[data-mindtouch-action]"}},{key:"settingsKeys",get:function(){return["isInteractionAnalyticsEnabled","isInteractionAnalyticsDebugEnabled","isGoogleAnalyticsEnabled","pageId"]}}]),a(t,[{key:"addGridSortingHandlers",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.location,i=!0,a=!1,o=void 0;try{for(var s,l=function(){var e=s.value,n=e.previousSibling;if(!n)return"continue";var i=n.innerText;if(!i)return"continue";e.addEventListener("click",(function(){return t.log({location:r,interaction:"Sort by ".concat(i.toLowerCase())})}))},c=e.querySelectorAll(".dataTables_scrollHead .DataTables_sort_icon")[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)l()}catch(e){a=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}},{key:"log",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.location,r=void 0===n?this._location:n,i=t.action;if(this._isInteractionAnalyticsEnabled&&r){this._isInteractionAnalyticsDebugEnabled&&console.log({location:r,action:i});var a=new Date;this._dispatcher.enqueue((function(t){e._events.logInteractionAnalytics(r,i,{datetime:a,keepAlive:t,pageId:e._pageId,url:document.location.href}).catch({})}))}return Promise.resolve()}},{key:"handleClick",value:function(e){var t=e.currentTarget,n=t.dataset.mindtouchAction;if(n){var r=t.closest("[data-mindtouch-location]");r&&this.log({location:r.dataset.mindtouchLocation,action:n})}else{var i=t.dataset.gaLabel;if(i){var a,o=t.closest("[data-ga-action]");if(o&&(a=o.dataset.gaAction),a){var s,l=t.closest("[data-ga-category]");if(l)s=l.dataset.gaCategory;else{var c=document.querySelector("main");s=c&&c.dataset.gaCategory}s&&(this.log({location:a,action:i}),this._isGoogleAnalyticsEnabled&&"function"==typeof window.ga&&window.ga("mtTracker.send","event",s,a,i))}}}}},{key:"withDefaultLocation",value:function(e){var n=new t({dispatcher:this._dispatcher});return n._isInteractionAnalyticsEnabled=this._isInteractionAnalyticsEnabled,n._isGoogleAnalyticsEnabled=this._isGoogleAnalyticsEnabled,n._events=this._events,n._location=e,n._pageId=this._pageId,n}}]),t}(ea(Yi(Wi))),sa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.event,a=void 0===i?"":i;if(r(this,t),"PageViewAnalyticsBase"===(e=h(this,l(t).call(this))).constructor.name)throw new TypeError("PageViewAnalyticsBase can not be constructed directly.");return e._data={},e._event=a,e._events=new $e(e.martianSettings),e._pageId=e._getPageId(),e}return s(t,e),a(t,null,[{key:"settingsKeys",get:function(){return["pageId"]}}]),a(t,[{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._events.logPageView(this._pageId,e,{event:this._event}).catch({})}}]),t}(ea(Yi(Wi))),la=null,ca=function(e){function t(){return r(this,t),h(this,l(t).apply(this,arguments))}return s(t,e),a(t,[{key:"log",value:function(){var e={_uri:document.location.href,_referrer:document.referrer},n=new cr(document.location.href).getQueryParam("mt-learningpath");n&&(e._learningPathName=n);var r=Bn.get("webWidgetEmbedded");if(r){var i;try{i=JSON.parse(window.atob(r))}catch(e){i={}}e=Object.assign(e,i);var a=Bn.get("isInitialWebWidgetReferral");a&&(e._isInitialWebWidgetReferral=a)}return m(l(t.prototype),"log",this).call(this,e)}}],[{key:"instance",get:function(){return null===la&&(la=new t),la}},{key:"settingsKeys",get:function(){return m(l(t),"settingsKeys",this).concat(["webWidgetEmbedded","isInitialWebWidgetReferral"])}}]),t}(sa);var ua=null,da=function(e){function t(){var e;return r(this,t),(e=h(this,l(t).call(this,{event:"consumption"})))._documentHeight=0,e._trackLength=0,e._windowHeight=0,e._refreshDomMeasurements(),e._data.minPercentViewed=Math.round(100*(1-e._trackLength/e._documentHeight)),e._data.maxPercentViewed=Math.round(100*(1-e._trackLength/e._documentHeight)),e._data.currentPercentViewed=Math.round(100*(1-e._trackLength/e._documentHeight)),e}return s(t,e),a(t,null,[{key:"instance",get:function(){var e;null===ua&&(ua=new t,window.addEventListener("resize",(function(){ua._refreshDomMeasurements()}),!1),window.addEventListener("scroll",(function(){clearTimeout(e),e=setTimeout((function(){ua._refreshAmountScrolled()}),50)}),!1));return ua}}]),a(t,[{key:"log",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.secondsOnPage,r=void 0===n?0:n;return m(l(t.prototype),"log",this).call(this,Object.assign(this._data,{secondsOnPage:r}))}},{key:"_refreshAmountScrolled",value:function(){this._refreshDomMeasurements();var e=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop,t=Math.round((this._windowHeight+e)/this._documentHeight*100);this._data.currentPercentViewed=t,this._data.currentPercentViewed>this._data.maxPercentViewed&&(this._data.maxPercentViewed=this._data.currentPercentViewed)}},{key:"_refreshDomMeasurements",value:function(){this._windowHeight=window.innerHeight||(document.documentElement||document.body).clientHeight,this._documentHeight=function(){if(!document.body)throw new Error("DOM has not been loaded, page view consumption analytics cannot be collected.");return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)}(),this._trackLength=this._documentHeight-this._windowHeight}}]),t}(sa);var ha=null,ma=function(e){function t(){return r(this,t),h(this,l(t).call(this,{event:"performance"}))}return s(t,e),a(t,null,[{key:"instance",get:function(){return null===ha&&(ha=new t),ha}},{key:"settingsKeys",get:function(){return m(l(t),"settingsKeys",this).concat(["skinStyle"])}}]),a(t,[{key:"log",value:function(){var e=function(){var e=null,t=null,n=0;if("function"==typeof performance.getEntriesByType){var r=performance.getEntriesByType("navigation");Array.isArray(r)&&r.length>0&&(t=r[0]),t&&(n=t.domInteractive,"function"==typeof performance.now&&(e=performance.now()))}if(t||(t=performance.timing)&&(n=t.domInteractive-t.navigationStart,"function"==typeof performance.now&&(e=performance.now()+t.navigationStart)),!t)return null;var i=t.type;if(!i)switch((performance.navigation||{}).type){case 0:i="navigate";break;case 1:i="reload";break;case 2:i="back_forward";break;default:i=""}return{"duration-appcache":t.domainLookupStart-t.fetchStart,"duration-connect":t.connectEnd-t.connectStart,"duration-dns":t.domainLookupEnd-t.domainLookupStart,"duration-dom-ctor":t.domComplete-t.domInteractive,"duration-dom-init":t.domInteractive-t.responseEnd,"duration-load":e?e-t.loadEventStart:0,"duration-redirect":t.redirectEnd-t.redirectStart,"duration-request":t.responseEnd-t.requestStart,"duration-total":e?e-t.fetchStart:0,"duration-unload":t.unloadEventEnd-t.unloadEventStart,"timeline-dom-interactive":n,type:i}}();if(e){var n=function(){var e=null;if("function"==typeof performance.getEntriesByType){var t=performance.getEntriesByType("paint");Array.isArray(t)&&t.length>0&&(e={},t.forEach((function(t){e["timeline-".concat(t.name)]=t.startTime})))}return e}();n&&(e=Object.assign(e,n))}return e?m(l(t.prototype),"log",this).call(this,Object.assign(e,{_uri:document.location.href,"layout-style":this.getSetting("skinStyle")})):Promise.resolve()}}]),t}(sa),fa=$.widget("mt.editableText",{options:{save:null,cancel:null,cancelOnBlur:!1,clickElement:null,multiline:!1,placeholder:""},_create:function(){var e=this,t=e.options,n=e.element,r=t.clickElement?t.clickElement:n;r=r instanceof Element?$(r):r,n.off("click").off("blur").off("paste").off("keydown"),e.options.prevText=n.text(),r.on("click",(function(){n.data("editing")||(n.data("editing",!0),n.text()===t.placeholder&&n.empty(),n.prop("contenteditable",!0).addClass("editable-on").focus())})),e.options.cancelOnBlur&&n.blur((function(){n.data("saving")?n.data("saving",!1):e.cancel()})),n.on("paste",(function(e){if((e.originalEvent||e).clipboardData||window.clipboardData){e.preventDefault();var t=((e.originalEvent||e).clipboardData||window.clipboardData).getData("Text");t=t.replace(/(\r\n|\n|\r)/gm," "),(e.originalEvent||e).clipboardData?document.execCommand("insertText",!1,t):window.clipboardData&&document.selection.createRange().pasteHTML(t)}})).on("keydown",(function(n){if(n.ctrlKey||n.metaKey)switch(n.keyCode){case 66:case 73:case 85:return!1;case 83:n.preventDefault(),e.save()}else 13===n.keyCode?t.multiline||(n.preventDefault(),e.save()):27===n.keyCode&&(n.preventDefault(),e.cancel());return!0}))},cancel:function(){var e=this.options,t=e.prevText,n=this.element;e.cancel?e.cancel().then((function(){n.empty().html(t||e.placeholder).prop("contenteditable",!1).removeClass("editable-on")})):n.empty().html(t||e.placeholder).prop("contenteditable",!1).removeClass("editable-on"),n.data("editing",!1)},save:function(){var e=this.options,t=this.element;t.data("editing",!1),e.save().then((function(){t.data("saving",!0),t.blur().prop("contenteditable",!1).removeClass("editable-on"),e.prevText=e.editElement.text()}),(function(){t.empty().html(e.prevText)}))}}),pa=$.widget("mt.expandablelist",{options:{dataSource:null,moreText:function(e){return e+" more"},beforeCreate:null,afterCreate:null,beforeDestroy:null,afterDestroy:null},_create:function(){var e=this;if(e._generatedElements=[],e._list=e.element,e._trigger("beforeCreate"),e.element.is("div")){var t=$("<ul></ul>");e.element.append(t),e._generatedElements.push(t),e._list=t}else if(!e.element.is("ul")&&!e.element.is("ol")&&!e.element.is("dl"))throw new Error("ERROR: The element should be a div, ul, ol or dl");e.options=dr.extendObject(e.options,e.element.data()),e.element.addClass("deki-expandablelist"),e._trigger("afterCreate")},_init:function(){this.options.dataSource&&this._askForData()},_askForData:function(){var e=this;e.options.dataSource.getData().then((function(t){var n=dr.makeArray(t.list);if(n.length>0&&(n.forEach((function(t){var n="string"==typeof t?$(Hr(t)):$(Hr(qr({title:t.title,href:t.uri},t.title)));e._generatedElements.push(n),e._list.append(n)})),null!==t.itemsLeft&&t.itemsLeft>0)){var r=qr({href:"#"},e.options.moreText(t.itemsLeft)),i=$(Hr({className:"mt-expandablelist-morelink"},r));e._generatedElements.push(i),e._list.append(i),i.on("click",(function(){i.remove(),e._askForData()})),r.addEventListener("click",(function(e){e.preventDefault()}))}}))},_destroy:function(){var e=this;e._trigger("beforeDestroy"),$.each(e._generatedElements,(function(e){e.remove()})),e.element.removeClass("deki-expandablelist"),e._trigger("afterDestroy")},_setOptions:function(e){var t=this;$.each(e,(function(e,n){t._setOption(e,n)}))},_setOption:function(){var e=this;$.Widget.prototype._setOption.apply(e,arguments)}}),ga=ki("mt-localizations-grid-widget",["Article.Common.page-is-restricted-login","MindTouch.Help.Page.search-unavailable","Page.StructuredTags.error-update"]),va=$.widget("mt.grid",{options:{responsive:!1,sortingOrder:[0,"asc"],emptyGridText:"No Data Available.",spinnerText:"Processing...",spinnerSize:"large",enableSpinner:!1,spinnerElement:null,paginate:!0,infiniteScroll:!1,scrollTriggerPixels:600,showInfo:!0,enableFilter:!0,data:[],domFormat:null,colDefs:[],separate:!1,separator:{sticky:!1,describe:"row-separator"},dataSource:null,serverSideSorting:!1,serverSideSortingTemplates:{default:"css_right ui-icon ui-icon-carat-2-n-s",asc:"ui-icon-triangle-1-n",desc:"ui-icon-triangle-1-s"},onRowAdd:null,onGridDraw:null,onInfiniteScroll:null,onAjaxLoaded:null,onAjaxFail:function(e,t){"status"in t&&403===t.status?di.Flash(ga("Article.Common.page-is-restricted-login")):"message"in t?di.Flash(t.message):"status"in t&&503===t.status?di.Flash(ga("MindTouch.Help.Page.search-unavailable")):di.Flash(ga("Page.StructuredTags.error-update"))},beforeCreate:null,afterCreate:null,beforeDestroy:null,afterDestroy:null},_create:function(){var e=this;this._trigger("beforeCreate"),dr.importExternalModule({libVar:$.fn.dataTable,globalPath:"/@lib/redist/jquery.dataTables.min.js"}).then((function(){return!0===e.options.responsive?dr.importExternalModule({globalPath:"/@lib/redist/dataTables.responsive.min.js"}):Promise.resolve()})).then((function(){e._initialize(),e._trigger("afterCreate")}))},_initialize:function(){var e=this;e.element.is("table")?(e.element.addClass("mt-grid-table ui-table").wrap('<div class="mt-grid"></div>'),e.$grid=e.element,e.element=e.element.parent()):(e.element.empty(),e.element.addClass("mt-grid"),e.$grid=$("<table>",{class:"mt-grid-table ui-table"}).appendTo(e.element)),e.options.colDefs.length&&!e.options.aoColumnDefs&&(e.options.aoColumnDefs=e._getColumnDefinitions()),e.options.aoColumnDefs=e.options.aoColumnDefs.map((function(e,t){var n={aTargets:[t],bSearchable:!0,bSortable:!0,bVisible:!0,bAutoWidth:!1};return Object.keys(n).forEach((function(t){t in e||(e[t]=n[t])})),e})),!0===e.options.enableSpinner&&(this.options.spinnerElement=e.options.spinnerElement||e.element),e.gridSettings=$.extend(!0,{aaSorting:e.options.serverSideSorting?[]:[e.options.sortingOrder],bJQueryUI:!0,bPaginate:!e.options.infiniteScroll&&e.options.paginate,bScrollInfinite:e.options.infiniteScroll,bInfo:e.options.showInfo,bFilter:e.options.enableFilter,aaData:e.options.data,oLanguage:{},oScroll:{},bRetrieve:!0},e.options,{fnCreatedRow:function(t,n){e._onNewRow(t,n),"function"==typeof e.options.fnCreatedRow&&e.options.fnCreatedRow(t,n)},fnRowCallback:function(t,n){"function"==typeof e.options.fnRowCallback&&e.options.fnRowCallback(t,n)},fnInitComplete:function(t,n){if("function"==typeof e.options.fnInitComplete&&e.options.fnInitComplete(t,n),e.options.serverSideSorting)for(var r=function(){var t=$(this).find("span:visible").last();t.hasClass(e.options.serverSideSortingTemplates.asc)||t.hasClass(e.options.serverSideSortingTemplates.desc)?(t.toggleClass(e.options.serverSideSortingTemplates.asc),t.toggleClass(e.options.serverSideSortingTemplates.desc)):(e.$header.find("."+e.options.serverSideSortingTemplates.asc).removeClass(e.options.serverSideSortingTemplates.asc),e.$header.find("."+e.options.serverSideSortingTemplates.desc).removeClass(e.options.serverSideSortingTemplates.desc),t.toggleClass(e.options.serverSideSortingTemplates.asc));var n=$(this).data("colDef");e.resetGrid(t.hasClass(e.options.serverSideSortingTemplates.desc)?"-"+n.sortOn:n.sortOn)},i=0;i<e.gridSettings.aoColumnDefs.length;i++){var a=e.gridSettings.aoColumnDefs[i];if(a.sortOn){var o=e.$header.find("."+a.sClass.replace(/ /g,".")).data("colDef",a).off("click").on("click",r),s=o.find(".DataTables_sort_wrapper");s.find(".DataTables_sort_icon.css_right.ui-icon").hide(),s.append($(document.createElement("span")).addClass(e.options.serverSideSortingTemplates.default)),e.options.sortingOrder&&i===e.options.sortingOrder[0]&&(e.options.dataSource.sort("asc"===e.options.sortingOrder[1]?a.sortOn:"-"+a.sortOn),o.find("span:visible").addClass("asc"===e.options.sortingOrder[1]?e.options.serverSideSortingTemplates.asc:e.options.serverSideSortingTemplates.desc))}}e.options.dataSource&&e.getData()},fnDrawCallback:function(t){e.dt||(e.dt=this),e._trigger("onGridDraw",null,{settings:t}),"function"==typeof e.options.fnDrawCallback&&e.options.fnDrawCallback(t),e._injectSeparators(),"$body"in e||(e.$body=e.element.find(".dataTables_scrollBody").removeAttr("style")),"$header"in e||(e.$header=e.element.find(".dataTables_scrollHead").removeAttr("style")),e.$bodyTable=e.$body.find("table"),e.$bodyHeight=e.$body.height(),e.doScroll=!0,e.$body.removeAttr("style"),e.$header.removeAttr("style")}}),"sZeroRecords"in e.gridSettings.oLanguage||(e.gridSettings.oLanguage.sZeroRecords=e.options.emptyGridText),"sSearch"in e.gridSettings.oLanguage||(e.gridSettings.oLanguage.sSearch=e.options.searchText),"bInfinite"in e.gridSettings.oScroll||(e.gridSettings.oScroll.bInfinite=e.options.infiniteScroll),e.gridSettings.bProcessing=!1,!e.gridSettings.sDom&&e.gridSettings.domFormat&&(e.gridSettings.sDom=e.gridSettings.domFormat),""!==e.gridSettings.sScrollY&&(e.gridSettings.sScrollY="400px"),"function"==typeof e.options.filterData&&$.fn.dataTableExt.afnFiltering.push(e.options.filterData),e.$grid.dataTable(e.gridSettings),e.processing=e.element.find(".dataTables_processing"),e.previousPlaceholders=[],e._makeScrollable(),e._makeSticky(),e.separators=[]},_makeScrollable:function(){var e=this;e.options.infiniteScroll&&(e.doScroll=!0,e.$body.on("scroll",(function(){e.isEmpty()||e._infiniteScroll(!0)})))},_makeSticky:function(){var e=this;e.options.separator.sticky&&(e.element.addClass("mt-sticky-headers"),e.$body.on("scroll",(function(t){t.originalEvent&&e.drawSeparators()})))},_destroy:function(){var e=this;e._trigger("beforeDestroy"),e.clearGrid(),e.$grid.fnDestroy(),e.$grid.remove(),e.element.removeClass("mt-grid"),e._trigger("afterDestroy")},_setOption:function(e,t){var n=this;switch(e){case"dataSource":n.clearGrid();break;case"emptyGridText":var r=n.$grid.fnSettings();r.oLanguage.sEmptyTable=t,n.$grid.fnDraw()}n._superApply(arguments)},_getColumnDefinitions:function(){for(var e=[],t=0;t<this.options.colDefs.length;t++){var n=this.options.colDefs[t];e.push({sTitle:n.title,sClass:n.class,bSortable:n.sortable,mDataProp:n.formatter,sortOn:n.sortOn,sWidth:n.width,sDefaultContent:n.defaultContent,bVisible:n.visible,bSearchable:n.searchable})}return e},_insertPlaceholder:function(){var e=this;if(!e.element.find(".separator-placeholder").length){var t=$(e.options.separator.template({data:e.firstRowData}));e.$header.find("table").append($(document.createElement("tbody")).append(t.addClass(e.options.separator.describe+" separator-placeholder first-separator")))}},_injectSeparators:function(){var e=this;e.options.separate&&!e.isEmpty()&&(e.separators=[],e.$grid.find("."+e.options.separator.describe).remove(),e.$grid.find("tr["+e.options.separator.describe+"]").each((function(){var t=$(this),n=t.data(e.options.separator.describe),r=$(e.options.separator.template({data:n})).insertBefore(t).addClass(e.options.separator.describe+" row-separator");e.separators.push(r)})),e._insertPlaceholder())},_onNewRow:function(e,t){var n=this,r=$(e);n.options.separate&&(n.previousRow?n.options.separator.checkWith(n.previousRow,t)&&(r.attr(n.options.separator.describe,!0),r.data(n.options.separator.describe,t)):(r.attr(n.options.separator.describe,!0),r.data(n.options.separator.describe,t),r.addClass("first-row"),n.firstRowData=t),n.previousRow=t),n._trigger("onRowAdd",null,{tr:e,data:t})},_infiniteScroll:function(){var e=this,t=e.$bodyTable.height()-e.options.scrollTriggerPixels-e.$bodyHeight;e.doScroll&&e.$body.scrollTop()>t&&(e.doScroll=!1,e.getData())},_hideSpinner:function(){this.options.spinnerElement&&this.options.spinnerElement.length>0&&ei(this.options.spinnerElement[0])},drawSeparators:function(){for(var e=this,t=e.element.find(".separator-placeholder"),n=e.$body.offset().top,r=[],i=0;i<e.separators.length;i++)n>=e.separators[i].offset().top&&r.push(e.separators[i]);r.length&&t.replaceWith(r[r.length-1].clone().addClass("separator-placeholder").get())},getData:function(e){var t=this;!0===t.options.enableSpinner&&Zr(this.options.spinnerElement[0],{bindToContainer:!0}),t.options.dataSource.getData(e).then((function(e){t._hideSpinner();var n=t.$body.scrollTop();t.addData(e,!0),t.$body.scrollTop(n-1),t._trigger("onAjaxLoaded",null,e)}),(function(e){t._hideSpinner(),t._trigger("onAjaxFail",null,e)}))},addData:function(e,t){if(e){var n=this;"function"==typeof n.options.transformData&&(e=n.options.transformData.call(this,e)),e&&e.length&&n.dt.fnAddData(e,t)}},getDataSource:function(){return this.options.dataSource},clearGrid:function(){var e=this;e.isEmpty()||(e.element.find(".separator-placeholder").remove(),e.$body.find("tr").remove(),e.previousRow=null,e.separators=[],e.dt.fnClearTable(!0))},resetGrid:function(e){var t=this;t.clearGrid(),t.options.dataSource&&$.isFunction(t.options.dataSource.reset)&&t.options.dataSource.reset(),$.isFunction(t.options.dataSource.sort)&&t.options.dataSource.sort(e),t.getData()},redrawGrid:function(e){this.$grid.fnDraw(e)},isEmpty:function(){return!this.$grid.fnGetData().length},processingIndicator:function(e){var t=e.show,n=this.element instanceof $?this.element[0]:this.element;t?Zr(n,{bindToContainer:!0}):ei(n)},getRowData:function(e){return e instanceof $&&(e=e[0]),this.$grid.fnGetData(e)},getGridData:function(){return this.$grid.fnGetData()},setRowData:function(e,t){return e instanceof $&&(e=e[0]),this.$grid.fnUpdate(t,e)},deleteRow:function(e){return e instanceof $&&(e=e[0]),this.$grid.fnDeleteRow(e)},isColumnVisible:function(e){return this.$grid.DataTable().column(e).visible()},_getStates:function(e){var t=this._located(e,!0,[25,0,0,0]),n=e.data("this_state");return t===n||(e.data("last_state",n),e.data("this_state",t)),[n,t]}}),ya="mt-modal-open",ba=function(e){var t=e.scrollHeight;t!==e.data("lastHeight")&&(e.data("lastHeight",t),t>e.clientHeight&&(e.addClass("mt-scrollable"),e.on("scroll",(function(){e.scrollTop()>0&&(e.removeClass("mt-scrollable"),e.off("scroll"))}))))},wa=$.widget("mt.modal",$.ui.dialog,{options:{dialogClass:"mt-dialog",modal:!0,width:400,resizable:!1,draggable:!1,appendTo:"#mt-modal-container",tabs:!1,naming:null,title:null,content:null,params:{},close:function(){$(this).remove()},load:null,beforeCreate:null,afterCreate:null,beforeDestroy:null,afterDestroy:null,requiresPage:!0},_create:function(){var e=this;$("body").addClass(ya),e._trigger("beforeCreate"),e.options=dr.extendObject(e.options,e.element.data()),null===e.options.naming&&null===e.options.content&&$.error("naming or content construction option is necessary"),e.element.addClass("mt-modal"),e.options.tabs&&e.element.addClass("with-tabs"),"string"==typeof e.options.naming?e.templateSpace={template:"MindTouch/Controls/Dialogs/"+e.options.naming.charAt(0).toUpperCase()+e.options.naming.slice(1),javascript:"dialog."+(e.options.naming.charAt(0).toLowerCase()+e.options.naming.slice(1)),namespace:e.options.naming.charAt(0).toUpperCase()+e.options.naming.slice(1)}:e.templateSpace=e.options.naming,e._super(arguments),e._trigger("afterCreate")},open:function(){var e=this;e.widget().trigger("focusin"),e.widget().on("dialoginit",(function(){e._afterDialogInit()})),e._super(),e.load()},close:function(){this._super(),this._destroy()},load:function(){var e=this;if(e.options.content){var t=$(document.createElement("div"));t.addClass("mt-dialog-root").attr("title",e.options.title||"").html(e.options.content),e._insertUi(t)}else e._loadUi(e.templateSpace,e.options.params)},_loadViewUi:function(e,t){var n=this;t||(t={}),this.options.requiresPage&&(t.pageid=Bn.get("pageId"),0===t.pageid&&(t.pageid="="+document.location.pathname.replace(/^\/+/g,""))),Vn().at("layout","views","".concat(e,".html")).withParams(t).get().then((function(e){return e.text()})).then((function(e){n._insertUi($(e))}))},_loadUi:function(e,t){"view"in e&&this._loadViewUi(e.view,t)},_insertUi:function(e){var t=this;e.each((function(){var e=$(this);e.hasClass("mt-dialog-root")?(t.options.tabs?e.parent().find(".ui-dialog-titlebar-close").prependTo("#link-picker-tabs").closest(".ui-dialog").children(".ui-dialog-titlebar").remove():t._setOption("title",e.attr("title")),t.$wrapper=e.appendTo(t.element).parents(".ui-dialog").addClass("mt-modal-wrapper")):e.is("script")&&$("body").append(e)})),t._trigger("load")},_afterDialogInit:function(){var e=this,t=e.$wrapper.find(".mt-scrolling-dialog-content");if(ba(t),"function"==typeof MutationObserver&&t.length&&(e.observer=new MutationObserver((function(){ba(t)})),e.observer.observe(t.get(0),{childList:!0,subtree:!0})),e.options.tabs&&e.$wrapper&&"auto"===e.options.height){var n=e.$wrapper.outerHeight(),r=e.$wrapper.addClass("mt-modal-wrapper-tabs").find(".ui-dialog-titlebar").outerHeight();e.element.css("top",-1*r),e.$wrapper.height(n-r)}e.option("position",{my:"center",at:"center",of:window})},_destroy:function(){var t=this;t._trigger("beforeDestroy"),"object"===e(t.observer)&&t.observer.disconnect(),$("body").removeClass(ya),t.element.removeClass("mt-modal"),$(document).off(".mt-modal"),t._super(),t.$wrapper&&t.$wrapper.length&&t.$wrapper.remove(),t._trigger("afterDestroy")}}),_a=$.widget("mt.tabbedContent",$.ui.tabs,{_create:function(){var e=this;e.element.addClass("mt-tabbed-content"),e.options=Object.assign({},e.options,e.element.data()),e._super()}}),ka=$.widget("mt.scrollableTabbedContent",_a,{options:$.extend({},$.mt.tabbedContent.options,{scrollable:!0}),_create:function(){var e=this;e._super(),e.element.addClass("ui-tabs-scrollable");var t=$('<div class="ui-tabs-scroll-container"></div>');$(".mt-guide-add-button-container").length?t.insertAfter(".mt-guide-add-button-container"):t.prependTo(e.element),e.header=$('<div class="ui-tabs-nav-scrollable ui-widget-header ui-corner-all"></div>').appendTo(t);var n=e.element.find(".ui-tabs-nav:first").removeClass("ui-widget-header ui-corner-all").appendTo(this.header),r=$('<ol class="ui-tabs-nav-arrows"></ol>').insertBefore(t),i=e.options.scrollLeftText,a=e.options.scrollRightText,o=$('<li class="ui-tabs-arrow-previous" title="'+i+'"><button class="ui-button-icon mt-icon-tab-scroll-left" data-ga-label="Scroll tabs left"></button></li>').prependTo(r),s=$('<li class="ui-tabs-arrow-next" title="'+a+'"><button class="ui-button-icon mt-icon-tab-scroll-right" data-ga-label="Scroll tabs right"></button></li>').prependTo(r);return o.add(s).bind({click:function(t){var n=this===s[0];t.preventDefault(),e._scrollTo(n?150:-150,200)}}),r.find("li").bind({"mouseenter focus":function(){$(this).addClass("ui-state-hover")},"mouseleave blur":function(){$(this).removeClass("ui-state-hover")}}),this.anchors.bind("click.tabs",(function(){var r=$(this).parent(),i=o.outerWidth(),a=r.outerWidth(!0),s=t.width(),l=r.position().left,c=-parseInt(n.stop(!0,!0).css("marginLeft"),10),u=-1;0===r.index()?u=0:l+a>=s+c?(u=l-s+a,r.index()+1<n.find("li").length&&(u+=i)):l<c&&(u=l+i),u>-1&&n.animate({marginLeft:-u},200,(function(){e._resize()}))})),e._resize(),$(window).resize((function(){e._resize()})),e},_update:function(){this._super()._update.apply(this)},_resize:function(){var e=this,t=e.element.find(".ui-tabs-nav:first"),n=e.element.find(".ui-tabs-scroll-container"),r=e.element.find(".ui-tabs-arrow-previous"),i=e.element.find(".ui-tabs-arrow-next"),a=0;t.find("li").each((function(){a+=$(this).outerWidth(!0)}));var o=r.width()+i.width(),s=-parseInt(t.css("marginLeft"),10),l=n.width(),c=l+s-a;if(a>l+s-3.5)e.header.addClass("ui-tabs-arrow-r"),r.show("fade"),i.show("fade"),i.removeClass("mt-disabled"),n.removeClass("mt-tabs-arrows-disabled").prev().removeClass("mt-tabs-arrows-disabled"),s>0?(e.header.addClass("ui-tabs-arrow-l"),r.removeClass("mt-disabled")):(e.header.removeClass("ui-tabs-arrow-l"),r.addClass("mt-disabled"));else{if(c>3.5&&s>0){var u=Math.min(s,c-3.5);e._scrollTo(-u,200)}l+o-3.5>a?(r.hide("fade"),i.hide("fade"),e.header.removeClass("ui-tabs-arrow-r"),e.header.removeClass("ui-tabs-arrow-l"),n.addClass("mt-tabs-arrows-disabled").prev().addClass("mt-tabs-arrows-disabled")):(i.addClass("mt-disabled"),e.header.removeClass("ui-tabs-arrow-r"),e.header.addClass("ui-tabs-arrow-l"),r.show("fade"),i.show("fade"),r.removeClass("mt-disabled"),n.removeClass("mt-tabs-arrows-disabled").prev().removeClass("mt-tabs-arrows-disabled"))}},_scrollTo:function(e,t){var n=this,r=n.element.find(".ui-tabs-nav:first"),i=n.element.find(".ui-tabs-scroll-container"),a=0,o=-parseInt(r.css("marginLeft"),10),s=i.width(),l=0;r.find("li").each((function(){a+=$(this).outerWidth(!0)})),e instanceof $.Event||(l=o+e,a<s||a<0||o<=0&&e<0||l<0?l=0:l>a-s&&a>s&&(l=a-s+5),r.stop(!0).animate({marginLeft:-l},t,(function(){n._resize()})))}}),Pa=$.widget("mt.draggableTabbedContent",ka,{_create:function(){var e=this;this._super(),this._sortableElement=this.element.addClass("mt-draggable-tabbed-content").find("ul").addClass("mt-draggable-tabs"),this._sorterPromise=Mi.create({container:this._sortableElement[0],blockClass:"mt-guide-tab",handleClass:"mt-icon-tab-move",trackDirection:"horizontal",intersectThreshold:.7,dynamicDragWidth:!1,onorderchanged:function(){e.tabsSorted()}})},enableDragging:function(){this._sorterPromise.then((function(e){e.enabled=!0}))},disableDragging:function(){this._sorterPromise.then((function(e){e.enabled=!1}))},activateTab:function(e){this._sorterPromise.then((function(t){t.activateElement(e)}))},tabsSorted:function(){}}),Ta=Object.freeze({tabbedContent:_a,scrollableTabbedContent:ka,draggableTabbedContent:Pa}),Sa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.martianSettings,i=t.environmentSettings;if(r(this,e),"ComponentBase"===this.constructor.name)throw new TypeError("ComponentBase can not be constructed directly.");this._listeners=[],this._events={},this._options={},this._martianSettings=n,this._envSettings=i}return a(e,[{key:"addListener",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this._element).addEventListener.apply(e,n),this._listeners.push(n),this}},{key:"emitEvent",value:function(e,t){this._element.dispatchEvent(new CustomEvent(e,{detail:t}))}},{key:"removeAllListeners",value:function(){for(var e=0;e<this._listeners.length;e++){var t;(t=this._element).removeEventListener.apply(t,p(this._listeners[e]))}this._listeners=[]}},{key:"addEvent",value:function(e,t){"function"==typeof t&&(this._events[e]=t)}},{key:"callEvent",value:function(e,t){this._events[e]&&this._events[e]({detail:t})}},{key:"setOptionsDefaults",value:function(e,t){this._options=Object.assign({},t,e)}},{key:"element",get:function(){return this._element},set:function(e){this._element=e}},{key:"martianSettings",get:function(){return this._martianSettings},set:function(e){this._martianSettings=e}},{key:"environmentSettings",get:function(){return this._envSettings},set:function(e){this._envSettings=e}},{key:"options",get:function(){return this._options}}]),e}();var Ea=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{clearOnSelect:!1,dataProvider:function(e){return Promise.resolve([{value:e}])},delay:250,displayMode:"value",inputElement:document.createElement("input"),parentElement:document.body,clearResultsOnBlur:!0,selectOnTab:!0},events:["onitemselected","onitemsadded","oninvaliddata","oncurrentselectionchanged"]}),t._hotkeys={escape:27,enter:13,arrowDown:40,arrowUp:38,tab:9},t._inputElement=t.options.inputElement,t.options.clearResultsOnBlur&&t._inputElement.addEventListener("blur",(function(){t.removeItemsElement()})),t._inputElement.addEventListener("input",t.getData()),t._inputElement.addEventListener("keydown",(function(e){Object.values(t._hotkeys).includes(e.keyCode)&&t.handleHotkey(e)})),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new i(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(i,[{key:"getData",value:function(){var e,t=this;return function(){clearTimeout(e);var n=t._inputElement.value.trim();t._typedInput=n,e=setTimeout((function(){t.removeItemsElement(),""!==n&&t.options.dataProvider(n).then((function(e){!function(e){if(!Array.isArray(e))return!1;for(var t=0;t<e.length;t++)if(!("value"in e[t]))return!1;return!0}(e)?t.callEvent("oninvaliddata",{suppliedData:e,message:"The data supplied to the autocomplete is not valid: It must be an array, and each item must have a `value` property."}):(e.length>0&&!t._suppressDisplay&&(t._inputElement.dataset.value="",t.removeItemsElement(),t._itemsElement=t.itemsTemplate(e),t.options.parentElement.appendChild(t._itemsElement),t.callEvent("onitemsadded",{data:e})),t._suppressDisplay=!1)}))}),t.options.delay)}}},{key:"itemsTemplate",value:function(e){var t=this,n=this._inputElement.getBoundingClientRect(),r=window.pageYOffset+n.bottom,i=window.pageXOffset+n.left;return Br({className:"ui-autocomplete ui-front ui-menu ui-widget ui-widget-content",style:{top:"".concat(r,"px"),left:"".concat(i,"px"),width:"".concat(n.width,"px")}},e.map((function(e){return Hr({className:"ui-menu-item",onmousedown:function(e){return t.itemSelected(e)},dataset:e},e.label||e.value)})))}},{key:"itemSelected",value:function(e){e.stopPropagation();var t=Object.assign({},e.target.dataset,{label:e.target.textContent});this.selectedEvent(t)}},{key:"removeItemsElement",value:function(){this._itemsElement&&(this.options.parentElement.removeChild(this._itemsElement),delete this._itemsElement)}},{key:"selectedEvent",value:function(e){this.options.clearOnSelect?this.selection={value:"",label:""}:this.selection=e,this._currentSelection=null,this.removeItemsElement(),this.callEvent("onitemselected",e)}},{key:"currentSelectionEvent",value:function(e){this.callEvent("oncurrentselectionchanged",e)}},{key:"handleHotkey",value:function(e){var t=e.keyCode,n=this._itemsElement?this._itemsElement.querySelector(".ui-state-focus"):null;if(t===this._hotkeys.escape)this.removeItemsElement();else if(t===this._hotkeys.arrowDown||t===this._hotkeys.arrowUp)t===this._hotkeys.arrowDown?!n&&this._itemsElement?this._currentSelection=this._itemsElement.firstChild:this._currentSelection&&(this._currentSelection.classList.remove("ui-state-focus"),this._currentSelection=this._currentSelection.nextSibling):t===this._hotkeys.arrowUp&&(!n&&this._itemsElement?this._currentSelection=this._itemsElement.lastChild:this._currentSelection&&(this._currentSelection.classList.remove("ui-state-focus"),this._currentSelection=this._currentSelection.previousSibling)),this._currentSelection?(this._currentSelection.classList.add("ui-state-focus"),this.selection={label:this._currentSelection.textContent,value:this._currentSelection.dataset.value},this.currentSelectionEvent(this._getCurrentEventData()),this._currentSelection.scrollIntoView()):this.selection={value:this._typedInput};else if((t===this._hotkeys.enter||this.options.selectOnTab&&t===this._hotkeys.tab)&&(this._suppressDisplay=!0,this._currentSelection||""!==this._inputElement.value)){e.preventDefault();var r={};this._currentSelection?r=this._getCurrentEventData():(r.value=this._inputElement.value,r.label=this._inputElement.value),this.selectedEvent(r)}}},{key:"_getCurrentEventData",value:function(){return Object.assign({},this._currentSelection.dataset,{label:this._currentSelection.textContent})}},{key:"selection",get:function(){return{value:this._inputElement.dataset.value,label:this._inputElement.value}},set:function(e){var t=e.value,n=e.label,r=void 0===n?t:n;if(void 0===t)return!1;"label"===this.options.displayMode?this._inputElement.value=r:this._inputElement.value=t,this._inputElement.dataset.value=t}}]),i}(Ti),Ca=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{progressClassName:"mt-progress-bar",prependText:"",appendText:"%",elementId:"mt-progress-bar-element",maxValue:100,initialValue:0}}),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(i,[{key:"_createUi",value:function(){this.element=zr({className:"mt-progress-bar-container",id:this.options.elementId},this._progressElement=Ir("progress",{className:this.options.progressClassName,max:this.options.maxValue,value:this.options.initialValue}),this._progressText=Ur({className:"mt-progress-bar-value"},this._getProgressText()))}},{key:"_getProgressText",value:function(){return"".concat(this.options.prependText).concat(this._progressElement.value).concat(this.options.appendText)}},{key:"value",get:function(){return this._progressElement.value},set:function(e){this._progressElement.value=e,this._progressText.textContent=this._getProgressText()}}]),i}(Ti),xa=function(e){var t,i,o;function c(e){var t;return r(this,c),(t=h(this,l(c).call(this,e))).initialize({defaults:{allowDragDrop:!0,allowedExtensions:[],allowMultiple:!0,autoUpload:!0,showAllowedExtensions:!1,selectedFiles:[],showHelperMessage:!0,mode:"attach"},events:["onsuccess","onerror","onfiledropped"]}),t._progressBars={},t._selectedFiles=p(t.options.selectedFiles),t}return s(c,e),a(c,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new c(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.Attach.allowed-types","Dialog.Attach.button.upload","Dialog.Attach.choose-files-dad","Dialog.Attach.max-size"]}},{key:"settingsKeys",get:function(){return["maxFileSize","pageId","isDraftRequest","attachFileMax"]}}]),a(c,[{key:"uploadFromCache",value:function(){this._cache&&this._cache.selectorDom?this._upload(this._cache.selectorDom,!0):this.callEvent("onerror",{error:"error.noCacheSet"})}},{key:"setSelectedFiles",value:function(e){this._externalFilesSource=!0,this._selectedFiles=e}},{key:"resetUi",value:function(){this._selectorArea&&(this._selectorArea.classList.remove("mt-hide"),ni(this._progressArea))}},{key:"_createUi",value:(o=n(regeneratorRuntime.mark((function e(){var t,n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=dr.formatBytes(this.getSetting("maxFileSize")),this.options.showAllowedExtensions&&Array.isArray(this.options.allowedExtensions)&&this.options.allowedExtensions.length>0&&(n="".concat(this.localize("Dialog.Attach.allowed-types")," ").concat(this.options.allowedExtensions.join(", "))),this.options.autoUpload||(this._uploadButton=Mr({type:"button",className:"ui-button mt-file-uploader-button mt-disabled",disabled:!0,onclick:function(){return i._uploadButtonClicked()}},this.localize("Dialog.Attach.button.upload"))),this._fileInput=Wr({type:"file",name:"file",className:"mt-file-uploader-file",multiple:this.options.allowMultiple,onchange:function(e){return i._fileInputChanged(e)}}),this.options.selectedFiles&&0!==this.options.selectedFiles.length||(this._selectorArea=zr({className:"mt-file-uploader-select-area"},this.options.showHelperMessage&&Or({className:"mt-file-uploader-help-text"},this.localize("Dialog.Attach.choose-files-dad")),zr(this._fileInput,this._uploadButton),zr({className:"mt-file-uploader-restriction-messages"},Or({className:"mt-file-uploader-max-filesize"},this.localize("Dialog.Attach.max-size",t)),n&&Or({className:"mt-file-uploader-allowed-types"},n)))),this.element=zr({className:"mt-file-uploader-main"},this._selectorArea,this._progressArea=zr({className:"mt-file-uploader-progress-area"})),r=this.options.dropElement||this.element,this.options.allowDragDrop&&(r.addEventListener("dragover",(function(e){return i._cancelDragDropEvent(e)})),r.addEventListener("dragenter",(function(e){return i._cancelDragDropEvent(e)}))),r.addEventListener("drop",(function(e){return i._fileDropped(e)})),this._selectedFiles&&this._selectedFiles.length>0&&this._upload();case 10:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_cancelDragDropEvent",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"_fileDropped",value:function(e){this.callEvent("onfiledropped",{uploadCancelled:!this.options.allowDragDrop}),this.options.allowDragDrop&&(this._cancelDragDropEvent(e),this._externalFilesSource||e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length&&(this._selectedFiles=Array.from(e.dataTransfer.files)),this._selectedFiles&&this._selectedFiles.length>0&&this._upload())}},{key:"_fileInputChanged",value:function(){this._externalFilesSource&&this._selectedFiles||(this._selectedFiles=Array.from(this._fileInput.files)),this.options.autoUpload?this._upload():this._uploadButton.disabled=!1}},{key:"_uploadButtonClicked",value:function(){this._externalFilesSource&&this._selectedFiles||(this._selectedFiles=Array.from(this._fileInput.files)),this._upload()}},{key:"_fileProgress",value:function(e,t,r){var i=this;return function(){var a=n(regeneratorRuntime.mark((function n(a){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=i._progressBars[e]){n.next=8;break}return r&&r.classList.add("mt-hide"),n.next=5,Ca.create({prependText:"".concat(t.name,": "),elementId:e});case 5:o=n.sent,i._progressArea.appendChild(zr({className:"mt-file-uploader-progress-bar"},o.element)),i._progressBars[e]=o;case 8:o.value=parseInt(a.loaded/a.total*100,10);case 9:case"end":return n.stop()}}),n,this)})));return function(e){return a.apply(this,arguments)}}()}},{key:"_validateFileSize",value:function(e){var t=this.getSetting("maxFileSize");return!(e.size>t)||(this.callEvent("onerror",{error:"file.upload.toobig",errorArgs:[(t/1024/1024).toFixed(2)+" MiB"],fileSize:e.size,maxSize:t}),!1)}},{key:"_validateFileExtension",value:function(e){var t=rr(e.name,".").toLowerCase();return!(Array.isArray(this.options.allowedExtensions)&&this.options.allowedExtensions.length>0)||(!!this.options.allowedExtensions.map((function(e){return e.toLowerCase()})).includes(t)||(this.callEvent("onerror",{error:"file.upload.fileExtension",extension:t,filename:e.name}),!1))}},{key:"_getUploadApiInfo",value:function(){var e,t,n=this.getSetting("pageId"),r=this.getSetting("isDraftRequest");return"attach"===this.options.mode?t=(e=r?new Ie(n,this.martianSettings):new Ut(n,this.martianSettings)).attachFile.bind(e):"revision"===this.options.mode?t=(e=r?new st(this.options.revisionFileId,this.martianSettings):new ot(this.options.revisionFileId,this.martianSettings)).addRevision.bind(e):"import"===this.options.mode&&(t=(e=new Ut(n,this.martianSettings)).importArchive.bind(e)),[e,t]}},{key:"_upload",value:(i=n(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,l,c,u,d,h=this,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=m.length>0&&void 0!==m[0]?m[0]:this._selectorArea,n=m.length>1&&void 0!==m[1]&&m[1],r={},n?r.allow="deleteredirects":this._cache={selectorDom:t},this.options.allowMultiple||(this._selectedFiles=this._selectedFiles.slice(0,1)),i=this._getUploadApiInfo(),a=f(i,2),o=a[0],s=a[1],!((l=this._selectedFiles.filter((function(e){return h._validateFileSize(e)&&h._validateFileExtension(e)})).map((function(e){var n="file_".concat(dr.guid()),i=h._fileProgress(n,e,t),a={name:h.options.fileNameOverride||e.name,progress:i};return function(){return s(e,a,r)}}))).length>0)){e.next=30;break}if("attach"!==this.options.mode){e.next=16;break}return e.next=11,o.getFiles();case 11:if(c=e.sent,u=this.getSetting("attachFileMax"),!(c.count+l.length>u)){e.next=16;break}return this.callEvent("onerror",{error:"error.multiple.truncation",errorArgs:[l.length,u]}),e.abrupt("return");case 16:return e.prev=16,e.next=19,Promise.all(l.map((function(e){return e()})));case 19:d=e.sent,e.next=27;break;case 22:return e.prev=22,e.t0=e.catch(16),403===e.t0.status?e.t0.error="file.upload.notAllowed":400===e.t0.status&&e.t0.responseText&&(e.t0.error=JSON.parse(e.t0.responseText).message),this.callEvent("onerror",e.t0),e.abrupt("return");case 27:this._selectedFiles=null,this._externalFilesSource=!1,this.callEvent("onsuccess",{files:d});case 30:case"end":return e.stop()}}),e,this,[[16,22]])}))),function(){return i.apply(this,arguments)})}]),c}(Yi(ea(Di(Ti)))),Ra=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{defaultType:"error",showCloseButton:!0},events:["onclearmessages"]}),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),n.options.initialMessages&&n[n.options.defaultType](n.options.initialMessages),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(i,[{key:"error",value:function(e){this._createNewMessage(e)}},{key:"info",value:function(e){this._createNewMessage(e,{type:"infomsg",name:"info"})}},{key:"success",value:function(e){this._createNewMessage(e,{type:"successmsg",name:"success"})}},{key:"warning",value:function(e){this._createNewMessage(e,{type:"warningmsg",name:"warning"})}},{key:"clearMessages",value:function(){ni(this.element),this.callEvent("onclearmessages")}},{key:"_createUi",value:function(){this.element=zr({className:"mt-flash-message-component"})}},{key:"_createNewMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.type,i=void 0===r?"".concat(this.options.defaultType,"msg"):r,a=n.name,o=void 0===a?this.options.defaultType:a;this.clearMessages(),this.element.append(zr({className:"".concat(i," systemmsg"),id:i},this.options.showCloseButton&&Mr({className:"ui-button-icon delete-msg mt-icon-delete-msg",title:"Close message",onclick:function(){return e.clearMessages()}}),zr({className:"inner mt-icon-flash-message"},Br({className:"".concat(o," first flashMsg")},t.map((function(e){return Hr(e)}))))))}}]),i}(Ti),ja=function(e){var t,i;function o(e){var t;return r(this,o),(t=h(this,l(o).call(this,e))).initialize({defaults:{tabInfo:[]}}),t._guideTabsManager=new Hi,t}return s(o,e),a(o,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi(t.tabInfo);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(o,[{key:"_createUi",value:(i=n(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.options.tabInfo.length){e.next=3;break}return this.element=Nr(),e.abrupt("return");case 3:this.element=zr({className:"mt-guide-tabs-container mt-tabbed-content mt-tabs"},Br({id:"mt-guide-tabs-selectors",className:"mt-guide-tabs-selectors",role:"tablist"},this.options.tabInfo.map((function(e){return t._tabDom(e)}))),this.options.tabInfo.map((function(e){return zr({className:"mt-guide-content",hidden:!0,id:e.guid,role:"tabpanel"})}))),this._activateTab(this.options.tabInfo[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_tabDom",value:function(e){var t=this;return Hr({className:"mt-guide-tab",dataset:{guid:e.guid,templatePath:e.templatePath,templateTitle:e.label},role:"tab"},qr({className:"mt-guide-tab-link",href:"#".concat(e.guid),role:"presentation",onclick:function(n){n.preventDefault(),t._activateTab(e)}},e.templateTitle))}},{key:"_activateTab",value:function(e){var t=this;this.element.querySelectorAll(".mt-guide-tab").forEach((function(t){t.dataset.guid===e.guid?t.classList.add("ui-tabs-active","ui-state-active"):t.classList.remove("ui-tabs-active","ui-state-active")})),this.element.querySelectorAll(".mt-guide-content").forEach((function(n){n.id===e.guid?(n.hidden=!1,n.style.display="block",0===n.childElementCount&&t._guideTabsManager.reloadGuideTab(e)):(n.hidden=!0,n.style.display="none")}))}}]),o}(Ti);function Aa(e){return"_mt-tree-node_".concat(e)}var Ia,Na,Da=function(e){var t,i,o,c,u,d,m,f;function g(e){var t;return r(this,g),(t=h(this,l(g).call(this,e))).initialize({defaults:{initialId:"home",initToParent:!1,includeFiles:!1,enabledFileExtensions:[],articleTypes:[],selectParent:!0,localizedHomeLabel:"Home",permissionsToEnable:[]},events:["onpopulated"]}),t}return s(g,e),a(g,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new g(t),!t.initFileId){e.next=6;break}return e.next=4,n.resetToFileId(t.initFileId);case 4:e.next=8;break;case 6:return e.next=8,n.populate();case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(g,[{key:"resetToPageId",value:(f=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=n.initToParent,i=void 0!==r&&r,a=n.selectParent,o=void 0===a||a,e.next=3,this.populate({initialId:t,initToParent:i,selectParent:o});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"resetToFileId",value:(m=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,l,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r=n.parentPageId,i=parseInt(t,10),a=new ot(i,this.martianSettings),e.prev=3,e.next=6,a.getInfo();case 6:o=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),new Error("Unable to fetch file information for file ID ".concat(t));case 12:if(o.pageParent||r){e.next=14;break}throw new Error("Unable to initialize to the specified file's parent page");case 14:return s=o.pageParent?o.pageParent.id:r,e.next=17,this.populate({initialId:s,initToParent:!1,notify:!1});case 17:l=this.selectNode("file_".concat(t),{scrollIntoView:!0}),this.callEvent("onpopulated",{instance:this,selectedNode:l});case 19:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return m.apply(this,arguments)})},{key:"populate",value:(d=n(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,l,c,u,d,h,m,f,p,g,v,y,b,w,_=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_.length>0&&void 0!==_[0]?_[0]:{},n=t.initialId,r=void 0===n?this.options.initialId:n,i=t.initToParent,a=void 0===i?this.options.initToParent:i,o=t.selectParent,s=void 0===o?this.options.selectParent:o,l=t.notify,c=void 0===l||l,this.clearTree(),!(a||this.options.articleTypes.length>0)){e.next=9;break}return d=new Ut(r,this.martianSettings),e.next=6,d.getFullInfo();case 6:if(h=e.sent,this.options.articleTypes.length>0)for(;!this.options.articleTypes.includes(h.article)&&h.pageParent;)u=this._getPageIdOrHome(h),h=h.pageParent,r=h.id;a&&h.pageParent&&(u=s?this._getPageIdOrHome(h.pageParent):h.id,r=h.pageParent.id);case 9:return f=!0,e.prev=10,e.next=13,this._getRoot(r);case 13:m=e.sent,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),f=!1;case 19:if(f&&!m[0].virtual){e.next=30;break}return r="home",e.prev=21,e.next=24,this._getRoot(r);case 24:m=e.sent,e.next=30;break;case 27:throw e.prev=27,e.t1=e.catch(21),new Error('Unable to initialize to the fallback "home" page ID');case 30:return p=m[0],r=this._getPageIdOrHome(p),u||(u=r),e.next=35,this._getChildren(r);case 35:if(g=e.sent,p.hasSubpages=g.length>0,v=this._translateApiData(m),y=v[0],p.hasSubpages?(y.expanded=!0,y.nodes=this._translateApiData(g)):a&&(u=this._getPageIdOrHome(p)),!p.pageParent){e.next=49;break}b=p.pageParent;case 42:if(!b){e.next=49;break}return e.next=45,this._addNodesToParent(v,b);case 45:v=e.sent,b=b.pageParent,e.next=42;break;case 49:this.addNodes(v),c&&(w=this.selectNode("page_".concat(u),{suppressEvent:!0}),this.callEvent("onpopulated",{instance:this,selectedNode:w}));case 51:case"end":return e.stop()}}),e,this,[[10,16],[21,27]])}))),function(){return d.apply(this,arguments)})},{key:"_getPageIdOrHome",value:function(e){return""===e.path?"home":e.id}},{key:"_addNodesToParent",value:(u=n(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.title,""===n.path&&this.options.localizedHomeLabel&&(r=this.options.localizedHomeLabel),!(this.options.permissionsToEnable.length>0)||n.effectivePermissions){e.next=8;break}return i=new Jt(n.id,this.martianSettings),e.next=6,i.get();case 6:a=e.sent,n.effectivePermissions=a.effectivePermissions;case 8:return o={label:r,nodeId:"page_".concat(this._getPageIdOrHome(n)),expandable:!0,expanded:!0,partialExpanded:!0,disabled:this._isDisabledBasedOnPermissions(n),data:{id:n.id,uri:n.uri,path:n.path,title:n.title,isFile:!1},nodes:t},e.abrupt("return",[o]);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"_isDisabledBasedOnPermissions",value:function(e){var t=this.options.permissionsToEnable;if(0===t.length)return!1;if(e.effectivePermissions&&e.effectivePermissions.operations){var n=e.effectivePermissions.operations;return t.filter((function(e){return n.includes(e)})).length!==t.length}return!1}},{key:"_translateApiEntry",value:function(e){if(e.filename){var t=e.filename.split("."),n=t[t.length-1].toLowerCase(),r=new cr(e.contents.href),i=!1;return this.options.enabledFileExtensions.length>0&&(i=!this.options.enabledFileExtensions.includes(n)),{nodeId:"file_".concat(e.id),label:e.filename,expandable:!1,iconClass:"mt-file-".concat(n),disabled:i,data:{id:e.id,uri:e.contents.href,path:r.pathname,title:e.filename,isFile:!0}}}var a=e.title;return""===e.path&&this.options.localizedHomeLabel&&(a=this.options.localizedHomeLabel),{nodeId:"page_".concat(this._getPageIdOrHome(e)),label:a,expandable:e.hasSubpages||this.options.includeFiles&&e.files>0,iconClass:"mt-article-".concat(e.article),disabled:this._isDisabledBasedOnPermissions(e),data:{id:e.id,uri:e.uri,path:e.path,title:e.title,isFile:!1}}}},{key:"_translateApiData",value:function(e){var t=this;return e.map((function(e){return t._translateApiEntry(e)}))}},{key:"_processSubpages",value:function(e){var t=this,n=e;return this.options.articleTypes.length>0&&(n=e.filter((function(e){return e.article&&t.options.articleTypes.includes(e.article)}))),n}},{key:"_sortFiles",value:function(e){return e.sort((function(e,t){var n=e.filename.toLowerCase(),r=t.filename.toLowerCase();return n<r?-1:n>r?1:0}))}},{key:"_getRoot",value:(c=n(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Ut(t,this.martianSettings),e.prev=1,e.next=4,n.getFullInfo();case 4:r=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),new Error("Unable to get the full info for page root '".concat(t,"'"));case 10:return e.abrupt("return",[r]);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return c.apply(this,arguments)})},{key:"_getChildren",value:(o=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Ut(t,this.martianSettings),r={limit:1e3},this.options.articleTypes.length>0&&(r.article=this.options.articleTypes.join(",")),!this.options.includeFiles){e.next=12;break}return e.next=6,n.getFilesAndSubpages();case 6:a=e.sent,o=this._processSubpages(a.subpagesInfo.subpages),s=this._sortFiles(a.filesInfo.files),i=p(o).concat(p(s)),e.next=16;break;case 12:return e.next=14,n.getSubpages(r);case 14:l=e.sent,i=this._processSubpages(l.subpages);case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_fetchSubnodes",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nodeId,r=this.getNode(n),i=parseInt(r.dataset.id,10),e.next=5,this._getChildren(i);case 5:a=e.sent,this.addNodes(this._translateApiData(a),{parentNodeId:n});case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}]),g}(ea(function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,t),(e=h(this,l(t).call(this,n))).initialize({events:["onnodeselected","ondisablednodeselected","onnodesadded","onsubnodesrequired","onnodecreated"]}),e._nodeMapping={},e._rootNode=Br({className:"mt-tree-node-wrapper ui-fancytree fancytree-container fancytree-plain fancytree-treefocus fancytree-nodes-visible"}),e.element=zr(e._rootNode),e}var i;return s(t,e),a(t,[{key:"clearTree",value:function(){this._nodeMapping={},ni(this._rootNode)}},{key:"getNode",value:function(e){return this._nodeMapping[Aa(e)]}},{key:"addNodes",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.parentNodeId,a=void 0===i?"_root":i;t="_root"===a?this.element:this.getNode(a),Array.isArray(e)||(e=[e]);var o=t.querySelector(".mt-tree-node-wrapper");if(o)e.forEach((function(e){var t=n._createNodeDom(e,{parentNodeId:a});if(o.appendChild(t),e.expanded){var r=t.querySelector(".mt-tree-node-wrapper"),i=t.querySelector(".fancytree-node");n._toggleNode(i,r,{expand:!0,partial:e.partialExpanded})}}));else{var s=this._createTree(e,{parentNodeId:a}),l=t.querySelector(".fancytree-node");0===e.length&&(l.classList.remove("fancytree-has-children"),l.classList.add("fancytree-exp-n")),t.appendChild(s),this._toggleNode(l,s,{expand:!0})}this.callEvent("onnodesadded",{nodes:e})}},{key:"selectNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.collapseChildren,r=void 0!==n&&n,i=t.scrollIntoView,a=void 0!==i&&i,o=t.forceFullChildren,s=void 0!==o&&o,l=t.suppressEvent,c=void 0!==l&&l,u=this.getNode(e);if(u){var d=u.querySelector(".fancytree-node");if(d.classList.contains("mt-disabled-node"))this.callEvent("ondisablednodeselected",{nodeElement:u});else if(ii(".fancytree-node",this._element).forEach((function(e){e.classList.remove("fancytree-active"),e.classList.remove("fancytree-focused")})),d.classList.add("fancytree-active"),d.classList.add("fancytree-focused"),c||this.callEvent("onnodeselected",{nodeElement:u}),r&&this._collapseChildren(u),a&&u.scrollIntoView(),s){var h=u.querySelector(".mt-tree-node-wrapper");if(h){u.removeChild(h);var m={nodeId:u.dataset.nodeId};this.callEvent("onsubnodesrequired",m),this._fetchSubnodes(m),u.dataset.showingPartial=!1}}}return u}},{key:"getSelectedNode",value:function(){return this._element.querySelector(".fancytree-active").parentElement}},{key:"getPathToNode",value:function(e){for(var t=this.getNode(e),n=[];t;)n.unshift(t),t=this.getNode(t.dataset.parentNodeId);return n}},{key:"_createNodeDom",value:function(e,t){var n=this,r=t.parentNodeId,i=e.nodes&&e.nodes.length>0,a=["fancytree-node","fancytree-lastsib","fancytree-ico-e"];i||e.expandable?a.push("fancytree-has-children"):a.push("fancytree-exp-n"),!0!==e.expanded||e.partialExpanded||a.push("fancytree-expanded"),e.disabled&&a.push("mt-disabled-node"),e.iconClass&&a.push(e.iconClass);var o=Hr({className:["mt-tree-node"].join(" "),title:e.label,dataset:Object.assign({},{nodeId:e.nodeId,showingPartial:!0===e.partialExpanded,parentNodeId:r},e.data),onclick:function(e){return n._nodeClicked(e)},ondblclick:function(e){return n._expanderClicked(e)}},Ur({className:a.join(" ")},Ur({className:"fancytree-expander",onclick:function(e){return n._expanderClicked(e)}}),Ur({className:"fancytree-icon"}),Ur({className:"fancytree-title"},e.label)),i&&this._createTree(e.nodes,{expanded:!0===e.expanded,parentNodeId:e.nodeId}));return this._nodeMapping[Aa(e.nodeId)]=o,this.callEvent("onnodecreated",{node:o}),o}},{key:"_createTree",value:function(e,t){var n=this,r=t.expanded,i=t.parentNodeId,a=["mt-tree-node-wrapper"];return r&&a.push("fancytree-nodes-visible"),Br({className:a.join(" ")},e.map((function(e){return n._createNodeDom(e,{parentNodeId:i})})))}},{key:"_toggleNode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.expand,i=n.partial,a=void 0!==i&&i;void 0===r&&(r=!e.classList.contains("fancytree-expanded")),e.classList.contains("fancytree-has-children")&&e.classList.remove("fancytree-exp-n"),r?(a||e.classList.add("fancytree-expanded"),t&&t.classList.add("fancytree-nodes-visible")):(e.classList.remove("fancytree-expanded"),t&&t.classList.remove("fancytree-nodes-visible"))}},{key:"_expanderClicked",value:function(e){e.stopPropagation();var t=e.target.parentElement.parentElement,n=t.querySelector(".fancytree-node"),r=t.querySelector(".mt-tree-node-wrapper");if("true"===t.dataset.showingPartial){t.removeChild(r);var i={nodeId:t.dataset.nodeId};this.callEvent("onsubnodesrequired",i),this._fetchSubnodes(i),t.dataset.showingPartial=!1}else if(r)this._toggleNode(n,r);else if(!n.classList.contains("fancytree-expanded")&&!n.classList.contains("fancytree-exp-n")){var a={nodeId:t.dataset.nodeId};this.callEvent("onsubnodesrequired",a),this._fetchSubnodes(a)}}},{key:"_nodeClicked",value:function(e){e.stopPropagation(),this.selectNode(e.currentTarget.dataset.nodeId)}},{key:"_collapseChildren",value:function(e){var t=this,n=e.querySelector(".mt-tree-node-wrapper");n&&ii(".mt-tree-node",n).forEach((function(e){t._toggleNode(e.querySelector(".fancytree-node"),e.querySelector(".mt-tree-node-wrapper"),{expand:!1})}))}},{key:"_fetchSubnodes",value:(i=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}]),t}(Ti))),La=function(e){var t,i,o,c;function u(e){var t;return r(this,u),(t=h(this,l(u).call(this,e))).initialize({events:["onshowhierarchytree","onhidehierarchytree"]}),t._pageId=t.getSetting("pageId"),t._hierarchyContainer=t.options.hierarchyContainer,t}return s(u,e),a(u,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u(t),e.next=3,n._attachListeners();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Skin.Common.home"]}},{key:"settingsKeys",get:function(){return["pageId"]}}]),a(u,[{key:"breadcrumbResize",value:function(){this._breadcrumbs.offsetWidth<this._breadcrumbs.scrollWidth?this._closeBreadcrumbsMobileView():(this.element.classList.remove("mt-breadcrumbs-mobile-view-opened"),this.element.classList.remove("mt-breadcrumbs-mobile-view-closed"))}},{key:"_attachListeners",value:(c=n(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.element=this.options.globalNavHeader,this.element){e.next=3;break}return e.abrupt("return");case 3:this._hierarchyToggle=this.element.querySelector(".mt-hierarchy-trigger"),this._hierarchyToggle.addEventListener("click",n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._toggleHierarchyTree();case 2:case"end":return e.stop()}}),e,this)})))),this._breadcrumbs=this.element.querySelector(".mt-breadcrumbs"),this.element.querySelector(".mt-icon-hierarchy-mobile-view-trigger").addEventListener("click",(function(){t._hideHierarchyTree(),t.element.classList.contains("mt-breadcrumbs-mobile-view-opened")?t._closeBreadcrumbsMobileView():(t.element.classList.add("mt-breadcrumbs-mobile-view-opened"),t.element.classList.remove("mt-breadcrumbs-mobile-view-closed"))})),this.breadcrumbResize();case 9:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"_closeBreadcrumbsMobileView",value:function(){this.element.classList.remove("mt-breadcrumbs-mobile-view-opened"),this.element.classList.add("mt-breadcrumbs-mobile-view-closed")}},{key:"_getHierarchyTree",value:(o=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._hierarchyTree){e.next=6;break}return e.next=3,Ri(["Skin.Common.home"],this.martianSettings);case 3:return e.next=5,Da.create({martianSettings:this.martianSettings,initialId:this._pageId,initToParent:!0,articleTypes:["topic-portfolio","topic-category","topic-guide"],suppressInitialSelect:!0,selectParent:!1,localizedHomeLabel:this.localize("Skin.Common.home"),onnodeselected:function(e){window.location.href=e.detail.nodeElement.dataset.uri}});case 5:this._hierarchyTree=e.sent;case 6:return e.abrupt("return",this._hierarchyTree);case 7:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_toggleHierarchyTree",value:(i=n(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getHierarchyTree();case 2:t=e.sent,n=!1,0===this._hierarchyContainer.childElementCount&&(this._hierarchyContainer.appendChild(t.element),n=!0),!0===n||ci.isClosed(this._hierarchyContainer)?(this._hierarchyToggle.classList.add("mt-icon-hierarchy-trigger-open"),this._hierarchyToggle.classList.remove("mt-icon-hierarchy-trigger-closed"),this._hierarchyContainer.style.display="block",ci.open(this._hierarchyContainer,150),this.callEvent("onshowhierarchytree")):this._hideHierarchyTree();case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_hideHierarchyTree",value:function(){this._hierarchyToggle.classList.add("mt-icon-hierarchy-trigger-closed"),this._hierarchyToggle.classList.remove("mt-icon-hierarchy-trigger-open"),ci.close(this._hierarchyContainer,150),this.callEvent("onhidehierarchytree")}}]),u}(Di(ea(Yi(Ti)))),Fa=[{field:"@label",name:"label"},{field:"value"},{field:"value-label",name:"valueLabel"}],qa=[{field:"confidence",transform:Fa},{field:"flag",transform:[{field:"@label",name:"label"},{field:"value",transform:"boolean"},{field:"value-label",name:"valueLabel"}]},{field:"governance",transform:Fa},{field:"visibility",transform:Fa}],Ma=[{field:"transitions",transform:[{field:"state",name:"states",isArray:!0,transform:qa}]},{field:"flag",transform:[{field:"@label",name:"label"},{field:"value",transform:"boolean"},{field:"value-label",name:"valueLabel"}]},{field:"governance",transform:[{field:"@label",name:"label"},{field:"value"},{field:"value-label",name:"valueLabel"}]}],za=D.createParser(W),Oa=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new N;r(this,e),this._plug=new S(n.host,n.plugConfig).at("@api","deki","pages",t,"kcs")}return a(e,[{key:"getState",value:function(){return this._plug.at("state").get().catch((function(e){return Promise.reject(za(e))})).then((function(e){return e.json()})).then(D.createParser(qa))}},{key:"getValidTransitions",value:function(){return this._plug.at("validtransitions").get().catch((function(e){return Promise.reject(za(e))})).then((function(e){return e.json()})).then(D.createParser(Ma))}},{key:"setState",value:function(e){return e&&0===Object.keys(e).length?Promise.reject("A state must be specified for request."):this._plug.at("state").withParams().post(JSON.stringify(e),ee).catch((function(e){return Promise.reject(za(e))}))}},{key:"setFlag",value:function(e){return void 0===e.state?Promise.reject("A flagged state must be specified for request."):!0===e.state&&void 0===e.details?Promise.reject("Details must be specified for request when the flagged state is set to true."):this._plug.at("flag").withParams().post(JSON.stringify({flag:e.state,flag_details:e.details}),ee).catch((function(e){return Promise.reject(za(e))}))}},{key:"initialize",value:function(){return this._plug.at("initialize").post(ee).catch((function(e){return Promise.reject(za(e))}))}}]),e}(),Ua="confidence",Ba="visibility",Ha="flag",Wa="governance",$a="mindtouch-kcs-collapsed",Va="mindtouch-kcs-container-collapsed",Ka=["WIP","NOTVALIDATED","VALIDATED","ARCHIVED"],Ga=["INTERNAL","PARTNERS","CUSTOMERS","PUBLIC"],Qa=function(e){var t,i,c,u;function d(e){var t;r(this,d),(t=h(this,l(d).call(this,e))).initialize({defaults:{isIframe:!1},events:["onerror","oninfo","onuiupdated"]}),t._kcs=new Oa(t.getSetting("pageId"),t.martianSettings);var n=JSON.parse(window.localStorage.getItem($a));t._optionsCollapsed=null===n||n;var i=JSON.parse(window.localStorage.getItem(Va));return t._containerCollapsed=null!==i&&i,t._kcsState={},t._transitions=[],t._flagTransition=[],t._governanceTransition=[],t.isIframe=e.isIframe,t}return s(d,e),a(d,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d(t),e.next=3,n.initLocalizations();case 3:return r=!0,e.prev=4,e.next=7,n._fetchState();case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),r=!1;case 12:return e.prev=12,e.next=15,n._createUi(r);case 15:return e.finish(12);case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this,[[4,9,12,16]])}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.KcsWorkflow.dialog.additional-change-required","Page.KcsWorkflow.dialog.cancel","Page.KcsWorkflow.dialog.confirm","Page.KcsWorkflow.dialog.title","Page.KcsWorkflow.dialog.work-in-progress","Page.KcsWorkflow.feedback.cancel","Page.KcsWorkflow.feedback.details-required","Page.KcsWorkflow.feedback.submit","Page.KcsWorkflow.title"]}},{key:"settingsKeys",get:function(){return["pageId"]}}]),a(d,[{key:"_createUi",value:(u=n(regeneratorRuntime.mark((function e(){var t,n=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!(n.length>0&&void 0!==n[0])||n[0],this.element?this.element.innerHTML="":this.element=zr({className:"mt-kcs-workflow mt-hide"}),ei(this.element),t&&(this.element.classList.remove("mt-hide"),this.element.appendChild(Nr(zr({className:"mt-kcs-title-container "},zr({className:"mt-kcs-title-wrapper"},this._publicationSettingsToggleElm())),zr({className:"mt-kcs-selection-container ".concat(this._containerCollapsed?"mt-kcs-selection-container-collapsed":"")},zr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(Ua)},Ir("strong",{className:"mt-kcs-classification-name"},this._kcsState.confidence.label),this._classificationValueElm(Ua),this._canSet(Ua)&&this._classificationToggleElm(),this._canSet(Ua)&&this._radioElms(Ua,Ba,this._transitions)),zr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(Ba)},Ir("strong",{className:"mt-kcs-classification-name"},this._kcsState.visibility.label),this._classificationValueElm(Ba),this._canSet(Ba)&&this._classificationToggleElm(),this._canSet(Ba)&&this._radioElms(Ba,Ua,this._transitions)),zr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(Ha)},Ir("strong",{className:"mt-kcs-classification-name"},this._kcsState.flag.label),Ur({id:"mt-kcs-classification-value-".concat(this._kcsState.flag.label)},this._kcsState.flag.valueLabel),this._canSet(Ha)&&this._flaggingElm()),zr({className:"mt-kcs-classification",id:"mt-kcs-classification-".concat(Wa)},Ir("strong",{className:"mt-kcs-classification-name"},this._kcsState.governance.label),this._classificationValueElm(Wa),this._canSet(Wa)&&this._classificationToggleElm(),this._canSet(Wa)&&this._radioElms(Wa,null,this._governanceTransitionOptions()))))),this.callEvent("onuiupdated"));case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"_fetchState",value:(c=n(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([this._kcs.getState(),this._kcs.getValidTransitions()]);case 3:t=e.sent,n=f(t,2),r=n[0],i=n[1],Object.assign(this._kcsState,r),this._transitions=i.transitions.states,this._flagTransition=i.flag,this._governanceTransition=i.governance,e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(0),e.t0.info&&e.t0.info.message&&("MindTouch.Deki.Exceptions.KCSNotEnabledForPageException"===e.t0.info.exception?this.callEvent("oninfo",{message:e.t0.info.message}):this.callEvent("onerror",{message:e.t0.info.message})),e.t0;case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return c.apply(this,arguments)})},{key:"_canSet",value:function(e){var t=this;return e===Ha?0!==Object.keys(this._flagTransition).length:e===Wa?0!==Object.keys(this._governanceTransition).length:this._transitions.find((function(n){return n[e]&&n[e].value!==t._kcsState[e].value}))}},{key:"_setState",value:function(e){var t=this;Zr(this.element,{bindToContainer:!0}),"false"!==e.showWIPConfirmation&&"wip"===this._kcsState.confidence.value&&"wip"!==e.confidence.value&&(e.confirmationDialogText=this.localize("Page.KcsWorkflow.dialog.work-in-progress",this._kcsState.confidence.label,this._kcsState.confidence.valueLabel)),e.confirmationDialogText?Fi.create({content:e.confirmationDialogText,title:this.localize("Page.KcsWorkflow.dialog.title"),primaryButtonText:this.localize("Page.KcsWorkflow.dialog.confirm"),secondaryButtonText:this.localize("Page.KcsWorkflow.dialog.cancel"),isIframe:this.options.isIframe,onconfirm:function(){e.showWIPConfirmation=!1,delete e.confirmationDialogText,t._setState(e)},oncancel:function(){t._createUi()}}):this._kcs.setState(e).then(n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._fetchState();case 2:return e.next=4,t._createUi();case 4:case"end":return e.stop()}}),e,this)})))).catch((function(e){e.info&&e.info.message&&(t.callEvent("onerror",{message:e.info.message}),t._createUi())}))}},{key:"_submitFeedback",value:(i=n(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._flagTransition.value||"string"!=typeof t||""!==t.trim()){e.next=4;break}this.callEvent("onerror",{message:this.localize("Page.KcsWorkflow.feedback.details-required")}),e.next=10;break;case 4:return e.next=6,this._kcs.setFlag({state:this._flagTransition.value,details:t});case 6:return e.next=8,this._fetchState();case 8:return e.next=10,this._createUi();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_classificationToggleElm",value:function(){var e=this;return qr({className:"mt-kcs-classification-toggle",href:"#",onclick:function(t){t.preventDefault(),e._optionsCollapsed=!e._optionsCollapsed,window.localStorage.setItem($a,e._optionsCollapsed),e.element.querySelectorAll(".mt-kcs-classification-options").forEach((function(e){e.classList.toggle("mt-hide")})),e.element.querySelectorAll(".mt-kcs-classification-value").forEach((function(e){e.classList.toggle("mt-hide")}))}},"...")}},{key:"_publicationSettingsToggleElm",value:function(){var e=this;return Mr({className:"mt-kcs-title mt-toggle ui-button-icon mt-kcs-selection-container-toggle ".concat(this._containerCollapsed?"mt-toggle-expand":"mt-toggle-collapse"),onclick:function(t){t.preventDefault(),e._containerCollapsed=!e._containerCollapsed,window.localStorage.setItem(Va,e._containerCollapsed);var n=e.element.querySelector(".mt-kcs-selection-container"),r=t.target;e._containerCollapsed?(r.classList.remove("mt-toggle-collapse"),r.classList.add("mt-toggle-expand"),n.classList.toggle("mt-kcs-selection-container-collapsed")):(r.classList.add("mt-toggle-collapse"),r.classList.remove("mt-toggle-expand"),n.classList.toggle("mt-kcs-selection-container-collapsed"))}},this.localize("Page.KcsWorkflow.title"))}},{key:"_flaggingElm",value:function(){var e=this,t=Ir("form",{className:"mt-kcs-flag-comment-form mt-hide",onreset:function(){return e._createUi()},onsubmit:function(n){n.preventDefault(),e._submitFeedback(t.querySelector("textarea").value)}},$r({className:"mt-kcs-flag-comment-label"},!this._kcsState.flag.value&&Ir("textarea",{className:"mt-kcs-flag-comment-textarea",placeholder:this.localize("Page.KcsWorkflow.feedback.details-required")})),Wr({className:"mt-button ui-button-primary mt-kcs-flag-comment-submit",type:"submit",value:this.localize("Page.KcsWorkflow.feedback.submit")}),Wr({className:"mt-button mt-kcs-flag-comment-reset",type:"reset",value:this.localize("Page.KcsWorkflow.feedback.cancel")}));return[$r({className:"mt-toggle-switch mt-kcs-flag-switch"},Wr({checked:this._kcsState.flag.value,onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(){e._flagTransition.value?(e.element.querySelector("#mt-kcs-classification-value-".concat(e._kcsState.flag.label)).innerText=e._flagTransition.valueLabel,t.classList.contains("mt-hide")?t.classList.remove("mt-hide"):t.reset()):e._submitFeedback()},type:"checkbox"}),Ur({className:"mt-toggle-switch-slider"})),t]}},{key:"_radioElms",value:function(e,t,n){var r=this,i=[],a="mt-kcs-classification-options";this._optionsCollapsed&&(a+=" mt-hide");var s=zr({className:a}),l=function(t){return t[e].value.toUpperCase()},c=function(e,t){var n=l(e),r=l(t);return n<r?-1:n>r?1:0};if(e===Ua||e===Ba){var u=e===Ua?Ka:Ga;c=function(e,t){var n=l(e),r=l(t);return u.indexOf(n)<u.indexOf(r)?-1:u.indexOf(n)<u.indexOf(r)?1:0}}return n.sort(c),n.forEach((function(a){if(!i.includes(a[e].value)){var l="",c="mt-kcs-classification-label",u=o({},e,a[e].value);if(r._kcsState[e].value===a[e].value)l="checked",c+=" mt-is-checked";else if(t){void 0===n.find((function(n){return a[e].value===n[e].value&&r._kcsState[t].value===n[t].value}))&&(u[t]=a[t].value,u.confirmationDialogText=r.localize("Page.KcsWorkflow.dialog.additional-change-required",a[e].label,a[e].valueLabel,a[t].label,a[t].valueLabel))}i.push(a[e].value),s.appendChild($r({className:c,onchange:function(e){r._setState(e.target.dataset)}},Wr({type:"radio",dataset:u,name:e,checked:l}),a[e].valueLabel))}})),s}},{key:"_governanceTransitionOptions",value:function(){return[o({},Wa,this._kcsState.governance),o({},Wa,this._governanceTransition)]}},{key:"_classificationValueElm",value:function(e){if(this._canSet(e)){var t="mt-kcs-classification-value";return this._optionsCollapsed||(t+=" mt-hide"),Ir("span",{className:t},this._kcsState[e].valueLabel)}return this._kcsState[e].valueLabel}}]),d}(Yi(ea(Di(Ti)))),Ya={"MindTouch.Deki.TitleSegmentTooLongException":"Dialog.PageTitleEditor.error.title-segment-too-long","MindTouch.Deki.TitleDisplayNameTooLongException":"Dialog.PageTitleEditor.error.title-display-name-too-long","MindTouch.Deki.Exceptions.TitleRenameNameInvalidArgumentException":"Dialog.PageTitleEditor.error.title-invalid"},Ja=function(e){var t,i,o;function c(e){var t;return r(this,c),(t=h(this,l(c).call(this,e))).initialize({defaults:{version:"modern",learningPathId:null},events:["onbeforesubmit","onsuccess","onclose","onpagenotinlearningpath","oneditoropened","onpathlinked","onpathunlinked","onredirectdetected","onsubmiterror"]}),t._pageId=t.getSetting("pageId"),t}return s(c,e),a(c,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.ConfirmRename.error.redirect","Dialog.ConfirmRename.label.cancel","Dialog.ConfirmRename.label.continue","Dialog.ConfirmRename.label.f1-link","Dialog.ConfirmRename.title","Dialog.PageTitleEditor.button.cancel","Dialog.PageTitleEditor.button.edit","Dialog.PageTitleEditor.button.update","Dialog.PageTitleEditor.error.conflict","Dialog.PageTitleEditor.error.generic","Dialog.PageTitleEditor.error.title-invalid","Dialog.PageTitleEditor.error.title-segment-too-long","Dialog.PageTitleEditor.label.special-character","Dialog.PageTitleEditor.success","Dialog.PageTitleEditor.success.moved","Dialog.PageTitleEditor.tooltip","Dialog.PageTitleEditor.tooltip.special-character"]}},{key:"settingsKeys",get:function(){return["isDraftRequest","pageId"]}},{key:"hoverDelay",get:function(){return 200}}]),a(c,[{key:"submitWithRedirectsIgnored",value:function(){this._submitTitleEdit(!0)}},{key:"_createUi",value:(o=n(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSetting("isDraftRequest")?new Ie(this._pageId,this.martianSettings):new Ut(this._pageId,this.martianSettings),e.next=3,t.getFullInfo();case 3:if(this._pageInfo=e.sent,this._currentUri=this._pageInfo.uri,this._isPathLinked="custom"!==this._pageInfo.pathType,null===this.options.learningPathId){e.next=13;break}return r=new yt(this.options.learningPathId,this.martianSettings),e.next=10,r.getInfo();case 10:i=e.sent,(n=i.pages.find((function(e){return e.id===l._pageId})))||this.callEvent("onpagenotinlearningpath");case 13:o={className:"state-view"},s={className:"state-hover",ondblclick:function(){return l._openEditor()}},"legacy"===this.options.version&&(o.onmouseover=function(){a=window.setTimeout((function(){return l._hoverOver()}),200)},o.onmouseleave=function(){window.clearTimeout(a)},s.onmouseleave=function(){window.clearTimeout(a),l.element.classList.remove("ui-state-hover")}),this.element=zr({id:"deki-page-title"},!this._pageInfo.pathSeo&&qr({className:"mt-f1-success mt-icon-special-character-warning",title:this.localize("Dialog.PageTitleEditor.tooltip.special-character"),rel:"external nofollow",href:"https://success.mindtouch.com/@go/cid/titleseo",target:"_blank"},this.localize("Dialog.PageTitleEditor.label.special-character")),this._viewArea=zr(o,this._viewStateTitle=Ur({className:"title mt-title-edit"},this._pageInfo.title)),this._hoverArea=zr(s,this._hoverStateTitle=Ur({className:"title mt-title-edit"},n&&Ur({className:"mt-icon-article-lp"}),this._pageInfo.title),qr({className:"edit",onclick:function(){return l._openEditor()}},this.localize("Dialog.PageTitleEditor.button.edit"))),this._editControls=zr({className:"mt-title-editor-component state-edit mt-hide"},this._editControlFields=zr({className:"fields"}),zr({className:"submit"},Mr({type:"submit",name:"deki_buttons[page_title_action][update]",value:"update",className:"edit-update",onclick:function(){return l._submitTitleEdit()}},Ur(this.localize("Dialog.PageTitleEditor.button.update"))),qr({className:"cancel",href:"#",onclick:function(e){e.preventDefault(),l._closeEditor()}},this.localize("Dialog.PageTitleEditor.button.cancel")),this._errorMessage=Ur({className:"title-editor-fail mt-hide"}))));case 17:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_loadEditControlsFields",value:function(){var e,t=this;this._isHomePage||(e=qr({className:"toggle-link",title:this.localize("Dialog.PageTitleEditor.tooltip"),onclick:function(){return t._togglePathEditor()}},Ur())),ni(this._editControlFields),this._editControlFields.appendChild(Nr(zr({className:"title mt-page-title-editor-editable-title"},this._pageTitleText=Wr({type:"text",value:this._pageInfo.title,name:"page_title",className:"edit-title",size:"24",spellcheck:!1,autocomplete:"off",id:"text-page_title",onkeyup:function(e){return t._keyUpHandler(e.key)}}),"legacy"===this.options.version&&e),!this._isHomePage&&!this.getSetting("isDraftRequest")&&zr({className:"path"},"legacy"!==this.options.version&&e,Ur({title:this._pageInfo.path,className:"mt-page-title-editor-parent-path-display"},this._getDisplayParentUri(this._pageInfo.pageParent)),this._pathSegmentInput=Wr({type:"text",value:this._getPageSegmentFromPath(this._pageInfo.path),name:"page_segment",className:"edit-path",size:"24",spellcheck:!1,autocomplete:"off",id:"text-page_segment",disabled:"custom"!==this._pageInfo.pathType,onkeyup:function(e){return t._keyUpHandler(e.key)}}))))}},{key:"_openEditor",value:function(){this._loadEditControlsFields(),this._showOverlay(),this.element.classList.add("ui-state-edit"),this._hoverArea.classList.add("mt-hide"),this._editControls.classList.remove("mt-hide"),this._pageTitleText.focus(),this._pageTitleText.setSelectionRange(0,this._pageTitleText.value.length),this._isPathLinked||this._editControls.classList.add("ui-state-unlinked"),this.callEvent("oneditoropened")}},{key:"_closeEditor",value:function(){this._editControls.classList.add("mt-hide"),this._hoverArea.classList.remove("mt-hide"),this.element.classList.remove("ui-state-edit"),this._hideOverlay(),this.callEvent("onclose")}},{key:"_togglePathEditor",value:function(){this._isPathLinked?(this._isPathLinked=!1,this._pathSegmentInput.disabled=!1,this._editControls.classList.add("ui-state-unlinked"),this.callEvent("onpathunlinked")):(this._isPathLinked=!0,this._pathSegmentInput.disabled=!0,this._editControls.classList.remove("ui-state-unlinked"),this.callEvent("onpathlinked"))}},{key:"_keyUpHandler",value:function(e){"Escape"===e?this._closeEditor():"Enter"===e&&this._submitTitleEdit()}},{key:"_getPageSegmentFromPath",value:function(e){var t=e.replace(/\/\//g,"%2F%2F").split("/");return t[t.length-1].replace(/%2F%2F/g,"//")}},{key:"_getDisplayParentUri",value:function(e){for(var t=[];e;)t.unshift(e),e=e.pageParent;if(t.length>2)return"".concat(t[1].uri,"/.../");var n=t[t.length-1].uri;return n.endsWith("/")||(n="".concat(n,"/")),n}},{key:"_submitTitleEdit",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.callEvent("onbeforesubmit"),n=this.localize("Dialog.PageTitleEditor.success"),r=this._pageTitleText.value,!this.getSetting("isDraftRequest")){e.next=11;break}return i=new Ie(this._pageId,this.martianSettings),e.next=7,i.setTitle(r);case 7:return this._updateTitleFields(r),this.callEvent("onsuccess",{newTitle:r,successMessage:n}),this._closeEditor(),e.abrupt("return");case 11:return a={title:r},!this._isPathLinked&&this._pathSegmentInput&&(o=this._pathSegmentInput.value,a.name=o.replace(/\/\//g,"/")),t&&(a.allow="deleteredirects"),s=new Ut(this._pageId,this.martianSettings),e.prev=15,e.next=18,s.move(a);case 18:l=e.sent,e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(15),this._handleMoveError(e.t0),e.abrupt("return");case 25:if(!(l.count>0)){e.next=35;break}if(this._pageInfo=l.pages[0],(c=this._pageInfo.uri)!==this._currentUri&&(n=this.localize("Dialog.PageTitleEditor.success.moved",c)),this._pathSegmentInput.value=this._getPageSegmentFromPath(this._pageInfo.path),null!==document.getElementById("editform")){e.next=34;break}return this._updateTitleFields(r),this.callEvent("onsuccess",{newUri:c,newTitle:r,successMessage:n}),e.abrupt("return");case 34:window.history.replaceState({},r,c);case 35:this._updateTitleFields(r),this._closeEditor(),this.callEvent("onsuccess",{newTitle:r,newUri:c,successMessage:n});case 38:case"end":return e.stop()}}),e,this,[[15,21]])}))),function(e){return i.apply(this,arguments)})},{key:"_updateTitleFields",value:function(e){this._pageInfo.title=e,this._pageTitleText.value=e,this._viewStateTitle.textContent=e,this._hoverStateTitle.textContent=e}},{key:"_handleMoveError",value:function(e){var t=e.status,n=e.info;this._errorMessage.classList.remove("mt-hide");var r=Ya[n.exception];if(409===t){if("MindTouch.Deki.Exceptions.RedirectExistsAtLocationException"===n.exception)return void this.callEvent("onredirectdetected");this._errorMessage.textContent=this.localize("Dialog.PageTitleEditor.error.conflict")}else this._errorMessage.textContent=r?this.localize(r,n.data?n.data.maxlength:null):this.localize("Dialog.PageTitleEditor.error.generic");this.callEvent("onsubmiterror",{info:n})}},{key:"_hoverOver",value:function(){if("true"!==this._hoverStateTitle.dataset["deki.positioned"]){this._hoverStateTitle.dataset["deki.positioned"]=!0,this._hoverArea.style.visibility="hidden",this._hoverArea.style.display="block";var e=this._viewArea.getBoundingClientRect(),t=this._hoverStateTitle.getBoundingClientRect(),n=parseInt(e.left-t.left,10),r=parseInt(e.top-t.top,10);this._hoverArea.style.left=n,this._hoverArea.style.top=r,this._hoverArea.style.visibility="visible",this._hoverArea.style.display=""}this.element.classList.add("ui-state-hover")}},{key:"_showOverlay",value:function(){"legacy"===this.options.version&&(this._overlay||(this._overlay=zr({className:"mt-title-editor-overlay mt-hide"}),document.body.appendChild(this._overlay)),this._overlay.classList.remove("mt-hide"))}},{key:"_hideOverlay",value:function(){"legacy"===this.options.version&&this._overlay&&this._overlay.classList.add("mt-hide")}},{key:"_isHomePage",get:function(){return""===this._pageInfo.path}}]),c}(ea(Yi(Di(Ti)))),Xa=function(e){var t,i;function o(e){var t;return r(this,o),(t=h(this,l(o).call(this,e))).initialize({defaults:{languageCode:null}}),t.element=t.options.relatedListingsContainer,t._detailed=t.getSetting("relatedArticlesDetailed"),t._languageCode=t.options.languageCode,t._relatedPages=[],t}return s(o,e),a(o,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._fetchDependencies();case 3:return n._createUi(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"settingsKeys",get:function(){return["relatedArticlesDetailed"]}},{key:"resourceKeys",get:function(){return["Skin.Columbia.label.no-recommended-articles"]}}]),a(o,[{key:"_fetchDependencies",value:(i=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},"true"===this.element.dataset.trackPreviousPages&&(hr.recordPageView(this.options.pageId),t.previouspages=hr.getRecentlyViewedPageIds().join(",")),this._detailed&&(t.include="overview"),this._languageCode&&(t.translate=this._languageCode),n=new Ut(this.options.pageid,this.martianSettings),e.prev=6,e.next=9,n.getRelated(t);case 9:r=e.sent,this._relatedPages=r.pages,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),this._relatedPages=[];case 16:case"end":return e.stop()}}),e,this,[[6,13]])}))),function(){return i.apply(this,arguments)})},{key:"_createUi",value:function(){var e=this;if(this._relatedPages.length>0){var t=this._relatedPages.map((function(t,n){var r={uri:t.uri,article:t.article,title:t.title,id:n+1,overview:!1};return e._detailed&&t.overview&&(r.overview=t.overview.length>150?t.overview.substr(0,150)+"...":t.overview),e._relatedPageItem(r)}));this.element.appendChild(Nr(t))}else this.element.appendChild(Hr({className:"mt-related-empty-listing"},Ur(this.localize("Skin.Columbia.label.no-recommended-articles"))))}},{key:"_relatedPageItem",value:function(e){return Hr({className:"mt-related-listing mt-related-listing-detailed"},qr({className:"mt-related-listing-link",href:e.uri,title:e.title,dataset:{gaLabel:"related-link-detailed-".concat(e.id)}},Ur({className:"mt-related-listing-link-icon mt-icon-article-".concat(e.article)}),Ur({className:"mt-related-listing-link-text"},e.title)),e.overview&&Ur({className:"mt-related-listing-link-overview"},e.overview))}}]),o}(ea(Yi(Di(Ti)))),Za=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{allowLinks:!0,allowRatings:!0,resultsListId:"search-results",selectedClass:"mt-selected",selectOnClick:!1,showPageContextForFiles:!0,showSummaries:!0},events:["onshowmore","onresultclicked","onresultlinkclicked","onratingclicked"]}),t._resultTally=0,t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.Help.Page.in","MindTouch.Help.Page.label.page-rating-no","MindTouch.Help.Page.label.page-rating-yes","MindTouch.Help.Page.more","MindTouch.Help.Page.no-search-results","MindTouch.Help.Page.no-search-try","MindTouch.Help.Page.recommended","MindTouch.Help.Page.show-more-search"]}},{key:"settingsKeys",get:function(){return["isF1Request","userIsSeated"]}}]),a(i,[{key:"setResults",value:function(e){var t=e.results,n=e.count,r=e.queryCount;this._resultTally+=n,this.toggleShowMore(this._resultTally<r),this._resultsList.appendChild(this._resultsDom(t))}},{key:"resetResults",value:function(){this._resultTally=0,this.toggleShowMore(!1),ni(this._resultsList)}},{key:"clearSelections",value:function(){var e=this;this.selectedResults.forEach((function(t){return t.classList.remove(e.options.selectedClass)}))}},{key:"displayEmptyState",value:function(){this.displayMessage({title:this.localize("MindTouch.Help.Page.no-search-results"),message:this.localize("MindTouch.Help.Page.no-search-try")})}},{key:"displayMessage",value:function(e){var t=e.title,n=e.message;this.resetResults(),this._resultsList.appendChild(this._informationDom({title:t,message:n}))}},{key:"toggleShowMore",value:function(e){oi(this._showMore,"mt-hide",!e)}},{key:"_createUi",value:function(){var e=this;this._resultsList=Br({id:this.options.resultsListId,className:"mt-tree-search-results",dataset:{gaAction:"Search results"}}),this._showMore=zr({className:"mt-help-actions-container center mt-hide"},Mr({value:"search",className:"help-show-more ui-button",type:"button",onclick:function(){return e._showMoreClicked()}},this.localize("MindTouch.Help.Page.show-more-search"))),this.element=zr({className:"mt-tree-search-results-container"},this._resultsList,this._showMore)}},{key:"_searchResultClicked",value:function(e){this.options.selectOnClick&&(this.clearSelections(),e.currentTarget.classList.add(this.options.selectedClass)),this.callEvent("onresultclicked",{target:e.currentTarget})}},{key:"_showMoreClicked",value:function(){this.callEvent("onshowmore")}},{key:"_resultLinkClicked",value:function(e){this.callEvent("onresultlinkclicked",{clickEvent:e})}},{key:"_ratingButtonClicked",value:function(e,t){this.callEvent("onratingclicked",{rating:e,element:t})}},{key:"_getPageTitleLink",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.uriTrack,i={className:"go result-spacer mt-tracked-result",title:e.title,dataset:{gaLabel:"Result ".concat(new URLSearchParams(r).get("position")),trackUri:r,tracking:!1}};return this.options.allowLinks?(i.href=e.page?e.page.uri:e.uri,i.onclick=function(e){return n._resultLinkClicked(e)}):i.onclick=function(e){e.preventDefault()},qr(i,e.title)}},{key:"_getFileTitleLink",value:function(e,t){var n=this,r={className:"go result-spacer mt-tracked-result",title:e.title,dataset:{trackUri:e.uriTrack,tracking:"false"}},i=e.mime.split("/")[1].replace("+","-");return this.options.allowLinks?(r.href=e.uri,r.onclick=function(e){return n._resultLinkClicked(e)}):r.onclick=function(e){e.preventDefault()},Nr(qr(r,Ur({className:"mt-search-file mt-icon-".concat(i)},""),e.title),this.options.showPageContextForFiles&&Nr(Ur(" ".concat(this.localize("MindTouch.Help.Page.in")," ")),this._getPageTitleLink(e.page,t,e.uriTrack)))}},{key:"_canRateResult",value:function(e){if(this.getSetting("userIsSeated")&&!this.getSetting("isF1Request"))return void 0!==("tags"in e?e.tags:[]).find((function(e){return e.startsWith("article:")&&!["article:topic-guide","article:topic-portfolio","article:topic-category"].includes(e)}))}},{key:"_resultsDom",value:function(e){var t=this,n="mt-search-information";return this.getSetting("userIsSeated")&&(n="".concat(n," mt-seated")),Nr(e.map((function(e,r){return Hr({className:"result type-".concat(e.type),dataset:{key:e.id,type:e.type,path:e.page.path},onclick:function(e){return t._searchResultClicked(e)}},zr({className:n},zr({className:"title"},"file"===e.type&&t._getFileTitleLink(e,r),("page"===e.type||"recommended"===e.type)&&t._getPageTitleLink(e,r),"recommended"===e.type&&Ur({className:"recommended-tag"}," ".concat(t.localize("MindTouch.Help.Page.recommended")))),zr({className:"meta"},zr({className:"url",title:"file"===e.type?e.page.uri:e.uri},"file"===e.type?e.page.uri:e.uri),t.options.showSummaries&&e.content&&zr({className:"preview"},Ur({className:"mt-search-partial-content"},sr(e.content,200)),e.content.length>200&&Ur({className:"mt-search-full-content mt-hide"},e.content),e.content.length>200&&zr(Mr({className:"mt-help-more-content",dataset:{gaLabel:"Help more content"},onclick:function(e){return t._showFullPreview(e)}},t.localize("MindTouch.Help.Page.more")))))),t.options.allowRatings&&t._canRateResult(e)&&zr({className:"mt-help-button-container",dataset:{pageId:e.id}},Mr({className:"mt-help-upvote ui-button-icon mt-icon-rating-yes",onclick:function(e){return t._ratingButtonClicked("up",e.target)}},t.localize("MindTouch.Help.Page.label.page-rating-yes")),Mr({className:"mt-help-downvote ui-button-icon mt-icon-rating-no",type:"button",onclick:function(e){return t._ratingButtonClicked("down",e.target)}},t.localize("MindTouch.Help.Page.label.page-rating-no"))))})))}},{key:"_informationDom",value:function(e){var t=e.title,n=e.message;return Hr({className:"type-empty"},Ir("h4",t),Or(n))}},{key:"_showFullPreview",value:function(e){var t=e.target,n=t.closest(".preview");n.querySelector(".mt-search-partial-content").classList.add("mt-hide"),n.querySelector(".mt-search-full-content").classList.remove("mt-hide"),t.parentNode.classList.add("mt-hide")}},{key:"resultCount",get:function(){return this._resultTally}},{key:"selectedResults",get:function(){return ii(".".concat(this.options.selectedClass),this._resultsList)}}]),i}(Di(Yi(Ti))),eo=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{path:""},events:["onpathselected"]}),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t)).element=n._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.Help.Page.category-selector","MindTouch.Help.Page.label-filter","MindTouch.Help.Page.label-search-all","MindTouch.Help.Page.label-result-count"]}}]),a(i,[{key:"update",value:function(e,t){this._setCrumbsFromPath(e,t)}},{key:"_createUi",value:function(){var e=zr({className:"mt-help-breadcrumb-container"},Ur({className:"mt-help-breadcrumb-label"},"".concat(this.localize("MindTouch.Help.Page.label-filter")," ")),this._breadCrumbList=Br({className:"mt-help-breadcrumb"}),this._searchResultCount=zr({className:"mt-search-results-count-text"}));return this._setCrumbsFromPath("",0),e}},{key:"_setCrumbsFromPath",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.path,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(ni(this._breadCrumbList),this._addCrumb({text:this.localize("MindTouch.Help.Page.label-search-all"),path:"",index:1,createLink:!0}),"/"!==t&&""!==t){var r=new Ut(t,_r);r.getFullInfo().then((function(t){"pageParent"in t&&e._getParentChain(t,[])}))}n>0?(this._searchResultCount.innerText=this.localize("MindTouch.Help.Page.label-result-count",n),this._searchResultCount.classList.remove("mt-hide")):this._searchResultCount.classList.add("mt-hide")}},{key:"_addCrumb",value:function(e){var t=this,n=e.path,r=e.text,i=e.index,a=r;e.createLink&&(a=qr({className:"mt-filter-breadcrumb",href:"#",onclick:function(e){e.preventDefault(),t.callEvent("onpathselected",{name:"path",value:n,index:i})}},r)),this._breadCrumbList.appendChild(Hr(a))}},{key:"_getParentChain",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.path,i=["topic-portfolio","topic-category","topic-guide","topic","reference","howto"];if(""===r||i.includes(e.article))if("pageParent"in e&&""!==r)n.push({title:e.title,path:r}),this._getParentChain(e.pageParent,n);else{var a=n.length-1;n.reverse().forEach((function(e,n){t._addCrumb({text:e.title,path:e.path,index:n+2,createLink:a!==n})}))}else"pageParent"in e&&""!==r&&this._getParentChain(e.pageParent,n)}}]),i}(Di(Ti)),to=function(e){var t,i,c;function u(e){var t;return r(this,u),(t=h(this,l(u).call(this,e))).initialize({defaults:{formId:"mt-search-component-form",elementId:"mt-search-component",elementClassName:"mt-search-component",limit:10,searchCurrentNsOnly:!1,searchMainOnly:!1,searchPagesOnly:!1,searchImagesOnly:!1,includeRecommendations:!1,allowLinks:!1,allowRatings:!1,selectOnClick:!0,showPageContextForFiles:!1,showSummaries:!1,apiVersion:1,includeMetadata:!1},events:["onbreadcrumbselected","onresultlinkclicked","onresultselected","onsearchcompleted","onsearcherror","onsearchinitiated","onsearchinputupdated","onsearchsubmitted"]}),t._page=1,t._recommendedIds=[],t}return s(u,e),a(u,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.CopyMove.placeholder.search","MindTouch.Help.Page.search-error","MindTouch.Help.Page.search-error-try","MindTouch.Help.Page.search-unavailable"].concat(p(Za.resourceKeys),p(eo.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageNamespace","userIsSeated"].concat(p(Za.settingsKeys))}}]),a(u,[{key:"updateFilters",value:function(e){var t=this;this._filters.forEach((function(n){void 0!==e[n]&&(t.options[n]=e[n])})),this.searchQuery=e.query||this.searchQuery}},{key:"_createUi",value:(c=n(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.options.includeMetadata){e.next=5;break}return e.next=3,eo.create({path:this.options.path,onpathselected:function(e){var n;t.callEvent("onbreadcrumbselected",(o(n={},e.detail.name,e.detail.value),o(n,"index",e.detail.index),n)),t.updateFilters(o({},e.detail.name,e.detail.value))}});case 3:this._breadcrumbs=e.sent,this.addEvent("onsearchcompleted",(function(e){t._breadcrumbs.update(e.detail.path,e.detail.searchResponse.queryCount)}));case 5:this.element=zr({className:this.options.elementClassName,id:this.options.elementId},Ir("form",{id:this.options.formId,onsubmit:function(e){return t._searchFormSubmitted(e)},className:this.getSetting("userIsSeated")?"mt-search-form-seated":"mt-search-form-unseated"},this._searchQueryInput=Wr({className:"mt-text mt-help-search-input",name:"mtsearch",placeholder:this.localize("Dialog.CopyMove.placeholder.search")}),Mr({className:"mt-icon-search ui-icon-button",type:"submit"})),this._breadcrumbs&&this._breadcrumbs.element,this._searchResults=Fr(Za,{showSummaries:this.options.showSummaries,allowLinks:this.options.allowLinks,showPageContextForFiles:this.options.showPageContextForFiles,selectOnClick:this.options.selectOnClick,allowRatings:this.options.allowRatings,onshowmore:function(){return t._searchShowMoreClicked()},onresultclicked:function(e){return t._searchResultClicked(e.detail.target)},onresultlinkclicked:function(e){t._searchResultLinkClicked(e.detail.clickEvent)}})),Qn.init(this._searchQueryInput,(function(){t._page=1,t._recommendedIds=[],t.callEvent("onsearchinputupdated"),t._doSearch(t._searchQueryInput.value)}),{timeout:600,minimum:this._minimumSearchCharacters});case 7:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"_searchShowMoreClicked",value:function(){this._page++,this._doSearch(this._searchQueryInput.value)}},{key:"_searchResultClicked",value:function(e){this.callEvent("onresultselected",{result:e})}},{key:"_searchResultLinkClicked",value:function(e){this.callEvent("onresultlinkclicked",{clickEvent:e})}},{key:"_searchFormSubmitted",value:function(e){e.preventDefault();var t=this.searchQuery.trim();t.length>0&&t.length<this._minimumSearchCharacters&&(this._page=1,this.callEvent("onsearchsubmitted",{query:t}),this._doSearch(t))}},{key:"_doSearch",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,l,c,u,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t.trim()||this._hasFilters){e.next=3;break}return this.callEvent("onsearcherror",{message:"The search was aborted because the query was empty"}),e.abrupt("return");case 3:return n=this.options.includeRecommendations&&1===this._page,r={aggpath:this.options.aggpath,apiVersion:this.options.apiVersion,classifications:this.options.classifications,includeAggregations:this.options.includeAggregations,limit:this.options.limit,offset:(this._page-1)*this.options.limit-this._recommendedIds.length,path:this.options.path,q:t,recommendations:n,recommendedIds:this._recommendedIds,tags:this.options.tags,type:this.options.type},this.options.searchPagesOnly?r.type="wiki":this.options.searchImagesOnly&&(r.type="image"),(i=dr.fetch("searchSessionId","session"))&&(r.sessionid=i),a=(a=this.getSetting("pageNamespace")||"Main").charAt(0).toUpperCase()+a.slice(1),this.options.searchCurrentNsOnly?r.namespace=a:this.options.searchMainOnly&&(r.namespace="Main"),Zr(this.element),e.next=14,this._searchResults;case 14:return o=e.sent,s=new _n(this.martianSettings),e.prev=16,this.callEvent("onsearchinitiated",r),e.next=20,s.search(r);case 20:l=e.sent,1===this._page&&o.resetResults(),l.results&&l.results.length>0?(l.recommendations&&(this._recommendedIds=l.recommendations.map((function(e){return e.id}))),this.options.resultFilter?(c=l.results.filter(this.options.resultFilter),0===(u=c.length)?o.displayEmptyState():(d=l.results.length-u,o.setResults({results:c,count:u,queryCount:l.queryCount-d}))):o.setResults({results:l.results,count:l.count,queryCount:l.queryCount})):o.displayEmptyState(),ei(this.element),this.callEvent("onsearchcompleted",{limit:r.limit,offset:r.offset,page:this._page,path:this.options.path,query:t,searchResponse:l}),e.next=35;break;case 27:e.prev=27,e.t0=e.catch(16),ei(this.element),o.resetResults(),h="MindTouch.Help.Page.search-error",503===e.t0.status&&(h="MindTouch.Help.Page.search-unavailable"),o.displayMessage({title:this.localize(h),message:this.localize("MindTouch.Help.Page.search-error-try")}),this.callEvent("onsearcherror",e.t0);case 35:case"end":return e.stop()}}),e,this,[[16,27]])}))),function(e){return i.apply(this,arguments)})},{key:"searchQuery",get:function(){return this._searchQueryInput.value},set:function(e){this._page=1,this._searchQueryInput.value=e,this._recommendedIds=[],this._doSearch(e)}},{key:"_minimumSearchCharacters",get:function(){return 3}},{key:"_filters",get:function(){return["classifications","path","tags","type"]}},{key:"_hasFilters",get:function(){var e=this;return this._filters.some((function(t){return e.options[t]&&e.options[t].length>0}))}}]),u}(Di(ea(Yi(Ti)))),no="mt-search-filters-option",ro="mt-search-filters-sub-options-show",io="mt-search-filters-sub-options",ao="mt-search-filters-toggle-all-hide",oo=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{classifications:[]},events:["onfilteradded","onresetfilters"]}),t.resetFilters(!1),t.addEvent("onfilteradded",(function(){t._updateFiltersHeader()})),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t)).element=n._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.SearchFilters.button.toggle.hide","MindTouch.SearchFilters.button.toggle.show","MindTouch.SearchFilters.label.attachments-description","MindTouch.SearchFilters.label.attachments.type.binary","MindTouch.SearchFilters.label.attachments.type.document","MindTouch.SearchFilters.label.attachments.type.image","MindTouch.SearchFilters.label.attachments","MindTouch.SearchFilters.label.classification","MindTouch.SearchFilters.label.clear-all","MindTouch.SearchFilters.label.description","MindTouch.SearchFilters.label.filters","MindTouch.SearchFilters.label.location","MindTouch.SearchFilters.label.location-empty"]}}]),a(i,[{key:"resetFilters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._currentFilters={paths:[]},this.element&&(ni(this.element),this.element.appendChild(this._createUi())),this._filtersHeader&&(ni(this._filtersHeader),this._filtersHeader.innerText=this.localize("MindTouch.SearchFilters.label.description")),e&&this.callEvent("onresetfilters",this._currentFilters)}},{key:"updateSelection",value:function(e){var t=this,n=e.path,r=void 0===n?"":n,i=e.classifications,a=void 0===i?[]:i,o=e.type,s=void 0===o?[]:o,l=this.element.querySelector(".mt-search-filters-attachments-toggle");if(s.length>1&&(this._showChildList(l),l.checked="checked",s.forEach((function(e){var n=t.element.querySelector('.mt-search-filters-document-type[value="'.concat(e,'"]'));n&&(n.checked=!0)}))),1===s.length&&"wiki"===s[0]&&(this._hideChildList(l),l.checked=!1),r.length>0){var c=this.element.querySelector(".mt-search-filters-option-location .mt-search-filters-option-toggle");this._showChildList(c)}if(Array.from(this._classificationList.querySelectorAll("input")).forEach((function(e){e.checked=!1})),a.length>0){var u=this.element.querySelector(".mt-search-filters-option-classifications .mt-search-filters-option-toggle");this._showChildList(u),a.forEach((function(e){var n=t.element.querySelector("input[value='".concat(e,"']"));n.checked=!0;var r=n.closest(".mt-search-filters-classification-item").querySelector(".mt-search-filters-classification-toggle");t._showChildList(r)}))}(a.length>0||s.length>1||r.length>0)&&this._updateFiltersHeader()}},{key:"_createUi",value:function(){var e=this;return Br({className:"mt-search-filters-options"},Hr({className:"mt-search-filters-header"},this._filtersHeader=Ur(this.localize("MindTouch.SearchFilters.label.description")),Mr({className:"mt-search-filters-toggle-all","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.filters")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.filters")},onclick:function(t){e._toggleAllFilters(t)}})),Hr({className:"".concat(no," mt-search-filters-option-location ").concat(ao)},this.localize("MindTouch.SearchFilters.label.location"),Mr({className:"mt-search-filters-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.location")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.location")},onclick:function(t){e._toggleChildList(t)}}),this._locationList=Br({className:"".concat(io," mt-search-filters-sub-options-locations")},Hr({className:"mt-search-filters-location-item"},this.localize("MindTouch.SearchFilters.label.location-empty")))),Hr({className:"".concat(no," mt-search-filters-option-classifications ").concat(ao)},this.localize("MindTouch.SearchFilters.label.classification"),Mr({className:"mt-search-filters-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.classification")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.classification")},onclick:function(t){e._toggleChildList(t)}}),this._classificationList=Br({className:io},this.options.classifications.map((function(t){return Hr({className:"mt-search-filters-classification-item mt-search-filters-classification-".concat(t.prefix)},qr({className:"mt-search-filters-classification",onclick:function(t){e._toggleChildList(t)}},t.label,Mr({className:"mt-search-filters-classification-toggle","aria-expanded":!1,"aria-label":"".concat(e.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.label),dataset:{toggleLabel:t.label},onclick:function(t){e._toggleChildList(t)}})),Br({className:"".concat(io," mt-search-filters-sub-options-classification")},t.tags.map((function(n){return Hr({className:"mt-search-filters-classification-".concat(t.prefix,"-").concat(n.tag)},$r({className:"mt-search-filters-classification-label"},Wr({name:t.prefix,type:"checkbox",value:"".concat(t.prefix,":").concat(n.tag),onchange:function(){var t=Array.from(e._classificationList.querySelectorAll("input:checked"));e.callEvent("onfilteradded",{name:"classifications",value:t.map((function(e){return e.value})),analyticsName:"Classification"})}}),n.label))}))))})))),Hr({className:"".concat(no," mt-search-filters-option-attachments ").concat(ao)},this.localize("MindTouch.SearchFilters.label.attachments"),$r({className:"mt-toggle-switch mt-search-filters-toggle-switch"},Wr({"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.attachments")),className:"mt-search-filters-attachments-toggle",dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.attachments")},onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(t){e._toggleAttachments(t)},type:"checkbox"}),Ur({className:"mt-toggle-switch-slider"})),Br({className:io},Hr($r({className:"mt-search-filters-sub-options-attachments-description"},this.localize("MindTouch.SearchFilters.label.attachments-description")),Br({className:"".concat(io," mt-search-filters-sub-options-attachments")},this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.document"),"document"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.image"),"image"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.binary"),"binary"))))))}},{key:"_toggleAttachments",value:function(e){this._toggleChildList(e);var t=Boolean(e.currentTarget.checked);Array.from(this.element.querySelectorAll(".mt-search-filters-document-type")).forEach((function(e){e.checked=t})),this._updateTypes({analyticsName:"Include attachments"})}},{key:"_updateTypes",value:function(e){var t=e.analyticsName,n=["wiki"];Array.from(this.element.querySelectorAll(".mt-search-filters-document-type")).forEach((function(e){e.checked&&n.push(e.value)})),this.callEvent("onfilteradded",{name:"type",value:n,analyticsName:t})}},{key:"_documentTypeElm",value:function(e,t){var n=this;return Hr($r({className:"mt-search-filters-classification-label"},Wr({className:"mt-search-filters-document-type",name:"type",type:"checkbox",value:t,onchange:function(){n._updateTypes({analyticsName:"Content Type"})}}),e))}},{key:"_toggleAllFilters",value:function(e){e.stopPropagation();var t=e.target,n=Array.from(this.element.querySelectorAll(".".concat(no)));"true"===e.target.getAttribute("aria-expanded")?(n.forEach((function(e){return e.classList.add(ao)})),t.classList.remove("expanded"),t.setAttribute("aria-expanded",!1),t.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.dataset.toggleLabel||""))):(n.forEach((function(e){return e.classList.remove(ao)})),t.classList.add("expanded"),t.setAttribute("aria-expanded",!0),t.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.hide")," ").concat(t.dataset.toggleLabel||"")))}},{key:"_toggleChildList",value:function(e){e.stopPropagation(),"true"===e.target.getAttribute("aria-expanded")?this._hideChildList(e.target):this._showChildList(e.target)}},{key:"_showChildList",value:function(e){e.closest("li").querySelector(".".concat(io)).classList.add(ro),e.classList.add("expanded"),e.setAttribute("aria-expanded",!0),e.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.hide")," ").concat(e.dataset.toggleLabel||""))}},{key:"_hideChildList",value:function(e){e.closest("li").querySelector(".".concat(io)).classList.remove(ro),e.classList.remove("expanded"),e.setAttribute("aria-expanded",!1),e.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(e.dataset.toggleLabel||""))}},{key:"_updateFiltersHeader",value:function(){var e=this;this._filtersHeader&&(ni(this._filtersHeader),this._filtersHeader.appendChild(qr({className:"mt-search-filters-clear-all",onclick:function(){e.resetFilters()}},this.localize("MindTouch.SearchFilters.label.clear-all"))))}},{key:"locations",set:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this._locationSelected&&0===t.length)return this._locationSelected=!1,!1;this._locationSelected=!1;var n=Nr();0===t.length?n.appendChild(Hr({className:"mt-search-filters-location-item"},this.localize("MindTouch.SearchFilters.label.location-empty"))):t.forEach((function(t){n.appendChild(Hr({className:"mt-search-filters-location-item"},qr({className:"mt-search-filters-location",href:"#",onclick:function(n){n.preventDefault(),e._currentFilters.paths.push(t.value),e._locationSelected=!0,e.callEvent("onfilteradded",{name:"path",value:t.value,analyticsName:"Location"})}},"".concat(t.title," "),Ur({className:"mt-search-filters-count"},"(".concat(t.count,")")))))})),ni(this._locationList),this._locationList.appendChild(n)}}]),i}(Di(Ti)),so=function(){function e(t){r(this,e),this._url=new URL(t);var n=this._url.searchParams.get("q")||this._url.searchParams.get("search");n&&(this._url.searchParams.delete("q"),this._url.searchParams.delete("search"),this.query=n)}return a(e,[{key:"_getArray",value:function(e){var t=this._url.searchParams.get(e);if(t&&Array.isArray(t))return t;var n=[];return t&&"string"==typeof t&&t.length>0&&(n=t.split(",")),n}},{key:"_setArray",value:function(e,t){t&&t.length>0?this._url.searchParams.set(e,t):this._url.searchParams.delete(e)}},{key:"query",get:function(){return this._url.searchParams.get("query")},set:function(e){this._url.searchParams.set("query",e)}},{key:"path",get:function(){return this._url.searchParams.get("path")||""},set:function(e){e&&e.length>0?this._url.searchParams.set("path",e):this._url.searchParams.delete("path")}},{key:"classifications",get:function(){return this._getArray("classifications")},set:function(e){this._setArray("classifications",e)}},{key:"tags",get:function(){return this._getArray("tags")},set:function(e){this._setArray("tags",e)}},{key:"type",get:function(){return this._getArray("type")},set:function(e){this._setArray("type",e)}},{key:"limit",get:function(){return this._url.searchParams.get("limit")},set:function(e){e&&e.length>0?this._url.searchParams.set("limit",e):this._url.searchParams.delete("limit")}},{key:"url",get:function(){return this._url.toString()}}]),e}(),lo=function(e){var t,i;function o(e){var t;return r(this,o),(t=h(this,l(o).call(this,e))).initialize({events:["onpathselected"]}),t}return s(o,e),a(o,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new o(t)).element=n._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.SearchLocationNav.label.current-location"]}}]),a(o,[{key:"update",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ni(this.element),"/"===t||""===t){e.next=7;break}return n=new Ut(t,this.martianSettings),e.next=5,n.getFullInfo();case 5:"pageParent"in(r=e.sent)&&((i=new so(window.location.href)).path=r.pageParent.path,this.element.appendChild(Hr({className:"mt-search-filters-location-navigation-item"},qr({onclick:function(e){e.preventDefault(),a.callEvent("onpathselected",{path:r.pageParent.path})},href:i.url},r.pageParent.title))),this.element.appendChild(Hr({className:"mt-search-filters-location-navigation-item"},"".concat(this.localize("MindTouch.SearchLocationNav.label.current-location")," ").concat(r.title))));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_createUi",value:function(){return Br({className:"mt-search-filters-location-navigation"})}}]),o}(Di(ea(Ti))),co="mt-search-filtersV2-option",uo="mt-search-filtersV2-sub-options";try{Ia=new Event("MT:SearchFilters:Hide")}catch(e){Ia=document.createEvent("Event"),event.initEvent("MT:SearchFilters:Hide",!0,!0)}var ho=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{classifications:[]},events:["onfilteradded","onresetfilters"]}),t.resetFilters(!1),t.addEvent("onfilteradded",(function(e){t._filtersResetButton.hidden=!1,"path"===e.detail.name&&(t._locationNav.update(e.detail.value),t._selectedPath=e.detail.value),0!==t._getCheckedClassifications.length||0!==t._getCheckedDocumentTypes.length||void 0!==t._selectedPath&&""!==t._selectedPath||(t._filtersResetButton.hidden=!0)})),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(t),e.next=3,lo.create({onpathselected:function(e){n.callEvent("onfilteradded",{analyticsName:"Location Navigation",name:"path",value:e.detail.path})}});case 3:return n._locationNav=e.sent,e.next=6,n._createUi();case 6:return n.element=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["MindTouch.SearchFilters.button.toggle.hide","MindTouch.SearchFilters.button.toggle.show","MindTouch.SearchFilters.label.attachments-description","MindTouch.SearchFilters.label.attachments.type.binary","MindTouch.SearchFilters.label.attachments.type.document","MindTouch.SearchFilters.label.attachments.type.image","MindTouch.SearchFilters.label.attachments.v2","MindTouch.SearchFilters.label.classification","MindTouch.SearchFilters.label.clear-all.v2","MindTouch.SearchFilters.label.description.v2","MindTouch.SearchFilters.label.filters","MindTouch.SearchFilters.label.location","MindTouch.SearchFilters.label.location-empty"].concat(p(lo.resourceKeys))}}]),a(i,[{key:"resetFilters",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.element&&(ni(this._allFilter),this._locationNav.update(""),this._allFilter.appendChild(this._createFilters())),e&&this.callEvent("onresetfilters")}},{key:"updateSelection",value:function(e){var t=this,n=e.path,r=void 0===n?"":n,i=e.classifications,a=void 0===i?[]:i,o=e.type,s=void 0===o?[]:o;if(s.length>1&&(this._toggleChildren({toggleElm:this._attachmentsToggle,hide:!1}),this._attachmentsToggle.checked="checked",s.forEach((function(e){var n=t.element.querySelector('.mt-search-filtersV2-document-type[value="'.concat(e,'"]'));n&&(n.checked=!0)}))),1===s.length&&"wiki"===s[0]&&(this._toggleChildren({toggleElm:this._attachmentsToggle,hide:!0}),this._attachmentsToggle.checked=!1),r.length>0){var l=this.element.querySelector(".mt-search-filtersV2-option-location .mt-search-filtersV2-option-toggle");this._toggleChildren({toggleElm:l,hide:!1})}if(this._locationNav.update(r),Array.from(this._classificationList.querySelectorAll("input")).forEach((function(e){e.checked=!1})),a.length>0){var c=this.element.querySelector(".mt-search-filtersV2-option-classifications .mt-search-filtersV2-option-toggle");this._toggleChildren({toggleElm:c,hide:!1}),a.forEach((function(e){var n=t.element.querySelector("input[value='".concat(e,"']"));n.checked=!0;var r=n.closest(".mt-search-filtersV2-classification-item").querySelector(".mt-search-filtersV2-classification");t._toggleChildren({toggleElm:r,hide:!1})}))}(a.length>0||s.length>1||r.length>0)&&(this._filtersResetButton.hidden=!1)}},{key:"_createUi",value:function(){var e=this,t=zr(this._filtersToggleAllButton=Mr({className:"mt-search-filtersV2-toggle-all","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.filters")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.filters")},onclick:function(){e._updateFiltersVisibility({hide:!1}),e._filtersHideButton.focus()}},this.localize("MindTouch.SearchFilters.label.filters")),this._allFilter=Br({className:"mt-search-filtersV2-options"},this._createFilters()));return t.addEventListener(Ia.type,(function(){e._updateFiltersVisibility({hide:!0})})),t}},{key:"_createFilters",value:function(){var e=this;return Nr(Hr({className:"mt-search-filtersV2-header"},this.localize("MindTouch.SearchFilters.label.description.v2"),zr({className:"mt-search-filtersV2-header-buttons"},this._filtersResetButton=Mr({className:"mt-search-filtersV2-reset",hidden:!0,onclick:function(){e.resetFilters()}},this.localize("MindTouch.SearchFilters.label.clear-all.v2")),this._filtersHideButton=Mr({className:"mt-search-filtersV2-close","aria-expanded":!0,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.hide")," ").concat(this.localize("MindTouch.SearchFilters.label.filters")),onclick:function(){e._updateFiltersVisibility({hide:!0}),e._filtersToggleAllButton.focus()}}))),Hr({className:"".concat(co," mt-search-filtersV2-option-location"),onclick:function(t){e._handleToggleClick(t)}},Mr({className:"mt-search-filtersV2-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.location")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.location")}},this.localize("MindTouch.SearchFilters.label.location")),this._locationNav.element,this._locationList=Br({className:"".concat(uo," mt-search-filtersV2-sub-options-locations"),hidden:!0},Hr({className:"mt-search-filtersV2-location-item"},Ir("i",this.localize("MindTouch.SearchFilters.label.location-empty"))))),Hr({className:"".concat(co," mt-search-filtersV2-option-classifications"),onclick:function(t){e._handleToggleClick(t)}},Mr({className:"mt-search-filtersV2-option-toggle","aria-expanded":!1,"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.classification")),dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.classification")}},this.localize("MindTouch.SearchFilters.label.classification")),this._classificationList=Br({className:uo,hidden:!0},this.options.classifications.map((function(t){return Hr({className:"mt-search-filtersV2-classification-item mt-search-filtersV2-classification-".concat(t.prefix)},Mr({className:"mt-search-filtersV2-classification","aria-expanded":!1,"aria-label":"".concat(e.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.label),dataset:{toggleLabel:t.label},onclick:function(t){e._handleToggleClick(t)}},t.label),Br({className:"".concat(uo," mt-search-filtersV2-sub-options-classification"),hidden:!0,onclick:function(e){e.stopPropagation()}},t.tags.map((function(n){return Hr({className:"mt-search-filtersV2-classification-".concat(t.prefix,"-").concat(n.tag)},$r({className:"mt-search-filtersV2-classification-label"},Wr({name:t.prefix,type:"checkbox",value:"".concat(t.prefix,":").concat(n.tag),onchange:function(){var t=e._getCheckedClassifications;e.callEvent("onfilteradded",{name:"classifications",value:t.map((function(e){return e.value})),analyticsName:"Classification"})}}),n.label))}))))})))),Hr({className:"".concat(co," mt-search-filtersV2-option-attachments"),onclick:function(t){t.currentTarget===t.target&&e._attachmentsToggle.click()}},zr({className:"mt-search-filtersV2-option-toggle-container",onclick:function(t){t.currentTarget===t.target&&e._attachmentsToggle.click()}},this.localize("MindTouch.SearchFilters.label.attachments.v2"),$r({className:"mt-toggle-switch mt-search-filtersV2-toggle-switch"},this._attachmentsToggle=Wr({"aria-label":"".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(this.localize("MindTouch.SearchFilters.label.attachments.v2")),className:"mt-search-filtersV2-attachments-toggle",dataset:{toggleLabel:this.localize("MindTouch.SearchFilters.label.attachments.v2")},onkeydown:function(e){13===e.keyCode&&e.currentTarget.click()},onchange:function(t){e._toggleAttachments(t)},type:"checkbox"}),Ur({className:"mt-toggle-switch-slider"}))),Br({className:uo,hidden:!0},Hr($r({className:"mt-search-filtersV2-sub-options-attachments-description"},this.localize("MindTouch.SearchFilters.label.attachments-description")),Br({className:"".concat(uo," mt-search-filtersV2-sub-options-attachments"),hidden:!0},this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.document"),"document"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.image"),"image"),this._documentTypeElm(this.localize("MindTouch.SearchFilters.label.attachments.type.binary"),"binary"))))))}},{key:"_toggleAttachments",value:function(e){this._handleToggleClick(e);var t=Boolean(e.currentTarget.checked);Array.from(this.element.querySelectorAll(".mt-search-filtersV2-document-type")).forEach((function(e){e.checked=t})),this._updateTypes({analyticsName:"Include attachments"})}},{key:"_updateTypes",value:function(e){var t=e.analyticsName,n=["wiki"];Array.from(this.element.querySelectorAll(".mt-search-filtersV2-document-type")).forEach((function(e){e.checked&&n.push(e.value)})),this.callEvent("onfilteradded",{name:"type",value:n,analyticsName:t})}},{key:"_documentTypeElm",value:function(e,t){var n=this;return Hr($r({className:"mt-search-filtersV2-classification-label"},Wr({className:"mt-search-filtersV2-document-type",name:"type",type:"checkbox",value:t,onchange:function(){n._updateTypes({analyticsName:"Content Type"})}}),e))}},{key:"_updateFiltersVisibility",value:function(e){var t=e.hide;t?this.element.removeChild(this._overlay):(this._overlay=zr({className:"mt-search-filtersV2-click-overlay"}),this.element.appendChild(this._overlay));var n,r=t?"show":"hide";this._allFilter.classList.toggle("expanded"),this._filtersToggleAllButton.classList.toggle("expanded"),this._filtersToggleAllButton.setAttribute("aria-expanded",!t),this._filtersToggleAllButton.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.".concat(r))," ").concat(this._filtersToggleAllButton.dataset.toggleLabel||"")),t?document.removeEventListener("click",Na):(n=this.element,Na=function(e){(e.target.classList.contains("mt-search-filtersV2-click-overlay")||!n.contains(e.target)&&!e.target.classList.contains("mt-search-filtersV2-reset"))&&(n.dispatchEvent(Ia),document.removeEventListener("click",Na))},document.addEventListener("click",Na))}},{key:"_handleToggleClick",value:function(e){var t;e.stopPropagation(),t="BUTTON"===e.target.nodeName||"INPUT"===e.target.nodeName?e.target:e.target.querySelector("button"),this._toggleChildren({toggleElm:t})}},{key:"_toggleChildren",value:function(e){var t=e.toggleElm,n=e.hide;if(null===t)return!1;void 0===n&&(n="true"===t.getAttribute("aria-expanded"));var r=t.closest("li"),i=r.querySelector(".".concat(uo));r.contains(this._locationNav.element)&&(this._locationNav.element.hidden=n),i.hidden=n,t.classList.toggle("expanded"),t.setAttribute("aria-expanded",!n),t.setAttribute("aria-label","".concat(this.localize("MindTouch.SearchFilters.button.toggle.show")," ").concat(t.dataset.toggleLabel||""))}},{key:"locations",set:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];ni(this._locationList);var n=Nr();t.forEach((function(t){n.appendChild(Hr({className:"mt-search-filtersV2-location-item"},qr({className:"mt-search-filtersV2-location",href:"#",onclick:function(n){n.stopPropagation(),n.preventDefault(),e.callEvent("onfilteradded",{name:"path",value:t.value,analyticsName:"Location"})}},"".concat(t.title," "),Ur({className:"mt-search-filtersV2-count"},"(".concat(t.count,")")))))})),this._locationList.appendChild(n)}},{key:"_getCheckedClassifications",get:function(){return Array.from(this._classificationList.querySelectorAll("input:checked"))}},{key:"_getCheckedDocumentTypes",get:function(){return Array.from(this.element.querySelectorAll(".mt-search-filtersV2-document-type:checked"))}}]),i}(Di(Ti)),mo=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({defaults:{initialQuery:"",path:"",queryKey:"q",targetNewTab:!1,url:"/Special:Search"},events:["onsubmit"]}),t.addEvent("onsubmit",(function(){t.doSearch(t._inputElement.value)})),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Help.Widget.button.text","Help.Widget.label.text","Help.Widget.placeholder.text"]}}]),a(i,[{key:"doSearch",value:function(e){if(""!==(e=e.trim())){var t=new cr(this.options.url.toString());t.addQueryParam(this.options.queryKey,e),this.options.path&&t.addQueryParam("path",this.options.path),dr.clearStorage("searchSessionId","session"),this.options.targetNewTab?window.open(t.toString(),"_blank"):window.location.href=t.toString()}}},{key:"_createUi",value:function(){var e=this;this.element=Ir("form",{className:"ui-dform mt-inputredirect-form",onsubmit:function(t){t.preventDefault(),e.callEvent("onsubmit")}},Ir("fieldset",{className:"ui-dform-fieldset"},zr({className:"mt-field"},$r({htmlFor:"mt-inputredirect-input",className:"mt-inputredirect-label ui-dform-label"},this.localize("Help.Widget.label.text")),this._inputElement=Wr({autocomplete:"off",className:"mt-help mt-inputredirect-input ui-dform-input",id:"mt-inputredirect-input",placeholder:this.localize("Help.Widget.placeholder.text"),value:this.options.initialQuery}),Mr({className:"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only mt-inputredirect-button",role:"button"},Ur({className:"ui-button-text"},this.localize("Help.Widget.button.text"))))))}}]),i}(Di(Ti)),fo=function(e){var t;function i(e){var t;return r(this,i),(t=h(this,l(i).call(this,e))).initialize({inputHint:"",queryKey:"query"}),t}return s(i,e),a(i,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new i(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a(i,[{key:"_createUi",value:function(){var e=this;this.element=zr({className:"mt-widget-search-input-container"},Mr({className:"mt-icon-search",onclick:function(t){t.preventDefault(),e.callEvent("onsubmit")}},Lr('\x3c!-- Generated by IcoMoon.io --\x3e\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">\n<title>search</title>\n<path d="M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6c0 3.314 2.686 6 6 6 1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"></path>\n</svg>\n')),Ir("form",{className:"mt-widget-search-form",onsubmit:function(t){t.preventDefault(),e.callEvent("onsubmit")}},this._inputElement=Ir("input",{autocomplete:"off",className:"mt-widget-search-input mt-help-search-input mt-text",placeholder:this.options.inputHint,type:"search",incremental:"incremental"})))}}]),i}(mo),po=function(e){var t,i;function o(e){var t;return r(this,o),(t=h(this,l(o).call(this,e))).initialize({defaults:{includeChooseLanguageOption:!0},events:["onlanguageselect"]}),t}return s(o,e),a(o,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi(n._getLanguages());case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.Translate.label.choose-language"].concat(p(Oi.resourceKeys))}},{key:"settingsKeys",get:function(){return["supportedTranslationTargetLanguages","pageLanguageCode"]}}]),a(o,[{key:"selectLanguage",value:function(e){if(e){var t=this.element.querySelector('option[value="'.concat(e,'"]'));if(t)return void(t.selected=!0)}this.element.selectedIndex=0}},{key:"_createUi",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Oi.resourceKey(this.getSetting("pageLanguageCode")||"EN"),this.element=Ir("select",{className:"mt-translate-language-picker",required:!0,title:this.localize("Component.Translate.label.choose-language"),onchange:function(e){r.callEvent("onlanguageselect",e.currentTarget.value)}},this.options.includeChooseLanguageOption&&Ir("option",{selected:!0,disabled:!0},this.localize("Component.Translate.label.choose-language")),[Ir("option",{value:""},this.localize(n)),t.map((function(e){return Ir("option",{value:e},r.localize(Oi.resourceKey(e)))}))]);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_getLanguages",value:function(){return Array.from(this.getSetting("supportedTranslationTargetLanguages")||[],(function(e){return Oi.normalizeLanguageCode(e)}))}}]),o}(Yi(Di(ea(Ti)))),go=function(e){var t,i,o;function c(e){var t;return r(this,c),(t=h(this,l(c).call(this,e))).initialize({events:["onlanguageselect","onsourcelanguageselect","onsuccess","onerror"]}),t._selectedLanguage=Oi.normalizeLanguageCode(e.selectedLanguage),t._translatedLanguage=t.getSetting("translatedLanguage"),t}return s(c,e),a(c,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c(t),e.next=3,n._fetchDependencies();case 3:return e.next=5,n._createUi();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"settingsKeys",get:function(){return["translatedLanguage"].concat(p(po.settingsKeys))}},{key:"resourceKeys",get:function(){return["Component.Translate.label.update-failed","Component.Translate.dialog.translated-mindtouch"].concat(p(po.resourceKeys),p(Oi.resourceKeys))}}]),a(c,[{key:"_createUi",value:(o=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.element=this._languagePicker.element,this._translatedStatus();case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_fetchDependencies",value:(i=n(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,po.create({onlanguageselect:function(e){t.callEvent("onlanguageselect",e.detail)}});case 2:this._languagePicker=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_translatedStatus",value:function(){void 0!==this._selectedLanguage&&null!==this._selectedLanguage&&(Oi.normalizeLanguageCode(this._selectedLanguage)===Oi.normalizeLanguageCode(this._translatedLanguage)?this.callEvent("onsuccess",{message:this.localize("Component.Translate.dialog.translated-mindtouch")}):this.callEvent("onerror",{message:this.localize("Component.Translate.label.update-failed")}),this._languagePicker.selectLanguage(this._selectedLanguage))}}]),c}(Yi(Di(Ti))),vo="https://success.mindtouch.com/@go/cid/youtubeupgrade",yo=/^(?:(?:https?:\/\/)*(?:www\.|))*(?:(?:youtube\.com\/(?:(?:watch\?(?:.*?&|)v=([a-zA-Z0-9_-]+)(?:$|&))|(?:embed\/([a-zA-Z0-9_-]+)(?:$|[\/\?].*))))|(?:youtu\.be\/([a-zA-Z0-9_-]+)(?:$|[\/\?].*)))/i,bo=function(e){var t,i,o,c;function u(e){var t;return r(this,u),(t=h(this,l(u).call(this,e))).initialize({defaults:{maxResults:10,searchString:"",autoSelect:!0,apiKey:"",widescreen:!0},events:["onselected","onresultsadded"]}),t._nextPageToken=null,t._lastQuery=null,t._widescreen=t.options.widescreen,t}return s(u,e),a(u,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Component.YoutubeSearch.error.key-invalid","Component.YoutubeSearch.error.key-missing","Component.YoutubeSearch.error.search-failed","Component.YoutubeSearch.info.not-found","Component.YoutubeSearch.label.video-url","Component.YoutubeSearch.label.success-center","Component.YoutubeSearch.placeholder.query"]}}]),a(u,[{key:"update",value:function(){var e=this._query.value;this._reset();var t=e.match(yo);if(t){var n=t[1]||t[2]||t[3];this._videoUrl=this._getYoutubeUrl(n),this._searchByIds([n],{q:e,pageToken:null,nextPageToken:null})}else!e.length||/^(?:https?|ftp|file):\/\//i.test(e)?this._videoUrl=e:(this._videoUrl="",this._search(e))}},{key:"_createUi",value:(c=n(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.element=zr(zr({className:"mt-field mt-youtube-video-url"},$r({className:"mt-label",htmlFor:"mt-youtube-video-url"},this.localize("Component.YoutubeSearch.label.video-url")),this._query=Wr({className:"mt-text",id:"mt-youtube-video-url",type:"text",autocomplete:"off",placeholder:this.localize("Component.YoutubeSearch.placeholder.query"),value:this.options.searchString})),this._message=Fr(Ra),this._resultsContainer=zr({className:"mt-youtube-video-results-wrapper"},this._results=zr({className:"mt-youtube-video-results mt-hide",id:"mt-youtube-video-results",onscroll:function(e){var n=e.currentTarget;n.scrollTop+n.clientHeight<n.scrollHeight||t._search(t._lastQuery)}},this._videos=Br({className:"mt-hide"})))),Qn.init(this._query,this.update,{timeout:200,minimum:1,reference:this}),e.next=4,this._message;case 4:this._message=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"_search",value:(o=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,l,c,u,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.apiKey){e.next=3;break}return this._showMessage(Nr("".concat(this.localize("Component.YoutubeSearch.error.key-missing")," "),qr({href:vo,target:"_blank"},this.localize("Component.YoutubeSearch.label.success-center")))),e.abrupt("return");case 3:return this._showSpinner(),this._lastQuery=t,n={part:"id",q:t,maxResults:this.options.maxResults,key:this.options.apiKey},this._nextPageToken&&(n.pageToken=this._nextPageToken),e.prev=7,e.next=10,fetch("https://www.googleapis.com/youtube/v3/search?".concat(dr.buildQueryString(n)));case 10:if((i=e.sent).ok){e.next=13;break}throw new Error(i.statusText);case 13:return e.next=15,i.json();case 15:r=e.sent,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(7),this._showMessage(this.localize("Component.YoutubeSearch.error.search-failed")),this._hideSpinner();case 22:if(this._checkData(r)){e.next=25;break}return this._hideSpinner(),e.abrupt("return");case 25:for(this._nextPageToken=r.nextPageToken,a=[],o=!0,s=!1,l=void 0,e.prev=30,c=r.items[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)d=u.value,a.push(d.id.videoId);e.next=38;break;case 34:e.prev=34,e.t1=e.catch(30),s=!0,l=e.t1;case 38:e.prev=38,e.prev=39,o||null==c.return||c.return();case 41:if(e.prev=41,!s){e.next=44;break}throw l;case 44:return e.finish(41);case 45:return e.finish(38);case 46:this._searchByIds(a,{q:t,pageToken:n.pageToken,nextPageToken:this._nextPageToken});case 47:case"end":return e.stop()}}),e,this,[[7,18],[30,34,38,46],[39,,41,45]])}))),function(e){return o.apply(this,arguments)})},{key:"_searchByIds",value:(i=n(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.apiKey){e.next=3;break}return this._showMessage(Nr("".concat(this.localize("Component.YoutubeSearch.error.key-missing")," "),qr({href:vo,target:"_blank"},this.localize("Component.YoutubeSearch.label.success-center")))),e.abrupt("return");case 3:return this._showSpinner(),r={part:"snippet,contentDetails",id:t.join(","),key:this.options.apiKey},e.next=7,fetch("https://www.googleapis.com/youtube/v3/videos?".concat(dr.buildQueryString(r)));case 7:if(i=e.sent,e.prev=8,i.ok){e.next=11;break}throw new Error(i.statusText);case 11:return e.next=13,i.json();case 13:a=e.sent,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(8),this._hideSpinner(),this._showMessage(this.localize("Component.YoutubeSearch.error.search-failed"));case 20:this._checkData(a)?(o=!1,n.pageToken&&(o=!0),this._addYoutubeVideos(a.items,o,this._query.value===n.q&&this._nextPageToken===n.nextPageToken)):this._hideSpinner();case 21:case"end":return e.stop()}}),e,this,[[8,16]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_showSpinner",value:function(){this._results.classList.remove("mt-hide"),Zr(this.spinner)}},{key:"_hideSpinner",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ei(this.spinner),e||this._results.classList.add("mt-hide")}},{key:"_showMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";ni(this._message),this._message[t]([e])}},{key:"_hideMessage",value:function(){di.EmptyFlash("all")}},{key:"_reset",value:function(){this._widescreen=!0,this._nextPageToken=null,this._hideSpinner(),this._videos.classList.add("mt-hide"),ni(this._videos),this._hideMessage()}},{key:"_getYoutubeUrl",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.location.protocol;n=-1!==n.search(/https?:/)?n:"http:";var r="";if(this._query.value.match(yo)){var i=new URL(this._query.value),a=parseInt(i.searchParams.get("start")||i.searchParams.get("t"),10);isNaN(a)||(r="?start=".concat(a))}return"".concat(n,"//www.youtube.com/").concat(t?"embed/":"watch?v=").concat(e).concat(r)}},{key:"_checkData",value:function(e){if(!e)return this._showMessage(this.localize("Component.YoutubeSearch.error.search-failed")),!1;if(e.pageInfo&&0===e.pageInfo.totalResults)return this._showMessage(this.localize("Component.YoutubeSearch.info.not-found"),"info"),!1;if(e.error){var t=e.error.errors&&e.error.errors[0]||{};switch(t.reason){case"keyInvalid":case"keyExpired":this._showMessage(Nr("".concat(this.localize("Component.YoutubeSearch.error.key-invalid")," "),qr({href:vo,target:"_blank"},this.localize("Component.YoutubeSearch.label.success-center"))));break;default:var n=this.localize("Component.YoutubeSearch.error.search-failed");t.message||t.reason?(n+=": ".concat(t.message||t.reason),t.message&&t.reason&&(n+=" (".concat(t.reason,")"))):e.error.message&&(n+=": ".concat(e.error.message)),this._showMessage(er(n))}return!1}return!0}},{key:"_addYoutubeVideos",value:function(e,t,n){for(var r=this,i=[],a=0;a<e.length;a++){var o=this._videoItem(e[a]);i.push(o)}i.length&&(t||ni(this._videos),i.forEach((function(e){r._videos.appendChild(e)})),this.callEvent("onresultsadded",{results:e}),n&&(this._videos.classList.remove("mt-hide"),this._hideSpinner(!0),this.options.autoSelect&&this._videos.children.length<=this.options.maxResults&&this._selectVideo(this._videos.firstElementChild)))}},{key:"_videoItem",value:function(e){var t=this,n=e.snippet,r="hd"===e.contentDetails.definition||"maxres"in e.snippet.thumbnails,i={id:e.id,thumb:n.thumbnails.default.url,title:n.title,description:n.description,widescreen:r,url:this._getYoutubeUrl(e.id,!1)};return Hr({className:"mt-youtube-video-item",title:i.title,dataset:{videoId:i.id,videoTitle:i.title,videoWidescreen:i.widescreen},onclick:function(e){t._selectVideo(e.currentTarget)},ondblclick:function(e){t._selectVideo(e.currentTarget,!0)}},zr({className:"mt-youtube-video-thumb"},Ir("img",{src:i.thumb,width:"120",height:"90"})),zr({className:"mt-youtube-video-info"},zr({className:"mt-youtube-video-title"},qr({href:i.url,target:"_blank"},i.title)),zr({className:"mt-youtube-video-description"},i.description),zr({className:"mt-youtube-video-url"},i.url)))}},{key:"_selectVideo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Array.from(this._videos.children).forEach((function(e){e.classList.remove("active")})),e.classList.add("active"),this._videoUrl=this._getYoutubeUrl(e.dataset.videoId),this._widescreen="true"===e.dataset.videoWidescreen,this.callEvent("onselected",{type:t?"submit":"select",id:e.dataset.videoId,url:this._videoUrl,aspectRatio:this._widescreen?"56.25":"75"})}},{key:"currentSelection",get:function(){return{url:this._videoUrl,aspectRatio:this._widescreen?"56.25":"75"}}}]),u}(Di(Ti)),wo={noRatingTags:["article:topic-guide","article:topic-portfolio","article:topic-category"],_trackClick:function(e){if(e){var t=e.currentTarget;t.dataset.trackUri&&fetch(t.dataset.trackUri,{method:"post",credentials:"include"})}},buildSearchConstraint:function(e){var t=[];if(e.namespace="main",t.push("+namespace:"+dr.searchEscape(e.namespace)),"path"in e){var n=e.path;n.startsWith("/")&&(n=ir(n,"/")),""!==n&&t.push("+path.ancestor:"+dr.ancestorEscape(n))}if("tags"in e){var r=e.tags;"string"==typeof r&&(r=""===r?[]:r.split(",")),r.forEach((function(e){t.push('+tag:"'+dr.searchEscape(e)+'"')}))}return"+("+t.join(" ")+")"},getTemplateData:function(e,t){var n=this,r=[];return{results:e.map((function(e,t){var i=e.page.path,a="mt-search-information";Bn.get("userIsSeated")&&(a+=" mt-seated");var o="file"===e.type?e.page.title:e.title,s={id:e.id,type:e.type,isRecommended:"recommended"===e.type,title:""===o?"Home":o,path:i,uri:e.page.uri,trackUri:e.uriTrack,content:"content"in e?sr(e.content,200):null,fullContent:"content"in e&&e.content.length>200?e.content:null,canRate:!1,infoClass:a,resultIndex:t};if("file"===e.type)s=Object.assign(s,{fileType:e.mime.split("/")[1].replace("+","-"),fileTitle:e.title,fileUri:e.uri});else if(Bn.get("userIsSeated")&&!Bn.get("isF1Request")){var l=void 0!==("tags"in e?e.tags:[]).find((function(e){return e.startsWith("article:")&&!n.noRatingTags.includes(e)}));l&&r.push(e.id),s.canRate=l}return s})),rateablePages:r,strings:t}},logSearchEvent:function(e,t,n,r){return new $e(_r).logSearch(Bn.get("userId"),{query:n.q,constraint:r,path:n.path,qid:t,totalresults:e.total,totalrecommended:e.recommended,offset:n.offset,limit:n.limit,_url:window.location.href})},_resultsTemplate:function(e,t){var n=this;return Hr({className:"result type-".concat(e.type)},zr({className:e.infoClass},zr({className:"title"},e.fileTitle&&qr({className:"go result-spacer mt-tracked-result",href:e.fileUri,onclick:function(e){return n._trackClick(e)},title:e.fileTitle,dataset:{trackUri:e.trackUri,tracking:"false"}},Ur({className:"mt-search-file mt-icon-".concat(e.fileType)},"")," ".concat(e.fileTitle)),e.fileTitle&&Ur({}," ".concat(t.fileInPage," ")),qr({className:"go result-spacer mt-tracked-result",href:e.uri,onclick:function(e){return n._trackClick(e)},title:e.title,dataset:{gaLabel:"Result ".concat(e.resultIndex),trackUri:e.trackUri,tracking:!1}},e.title),e.isRecommended&&Ur({className:"recommended-tag"}," ".concat(t.recommended))),zr({className:"meta"},zr({className:"url",title:e.uri},e.uri),e.content&&zr({className:"preview"},Ur({className:"mt-search-partial-content"},e.content),e.fullContent&&Ur({className:"mt-search-full-content mt-hide"},e.fullContent),e.fullContent&&zr({},qr({className:"mt-help-more-content",dataset:{gaLabel:"Help more content"},href:"#"},t.more))))),e.canRate&&zr({className:"mt-help-button-container",dataset:{pageId:e.id}},Mr({className:"mt-help-upvote ui-button-icon mt-icon-rating-yes"},t.rateYes),Mr({className:"mt-help-downvote ui-button-icon mt-icon-rating-no",type:"button"},t.rateNo)))},getResultsDom:function(e){var t=this;return Nr(e.results.reduce((function(n,r){return n.push(t._resultsTemplate(r,e.strings)),n}),[]))},search:function(e,t){return(e=Object.assign({limit:5,offset:0,tags:[],path:"",recommendations:!0},e)).q=e.q.replace(/(^|\s)\*($|\s)/g," ").trim(),t&&(e.sessionid=t),new _n(_r).search(e)}};function _o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Bn.get("pageLanguageCode"):n,i=t.includeDay,a=void 0===i||i,o=t.includeYear,s=void 0===o||o;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var l={month:"short"};return a&&(l.day="numeric"),s&&(l.year="numeric"),e.toLocaleString(r,l)}function ko(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Bn.get("pageLanguageCode"):n;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var i={day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"};return e.toLocaleString(r,i)}var Po=Object.freeze({numericDate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Bn.get("pageLanguageCode"):n;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var i={day:"numeric",month:"numeric",year:"numeric"};return e.toLocaleString(r,i)},numericTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Bn.get("pageLanguageCode"):n,i=t.includeSeconds,a=void 0!==i&&i;if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var o={hour:"numeric",minute:"numeric"};return a&&(o.second="numeric"),e.toLocaleString(r,o)},shortDate:_o,shortDateTime:ko,pageLastUpdatedTimestamp:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.locale,r=void 0===n?Bn.get("pageLanguageCode"):n;return Bn.get("userIsSeated")?ko(e,{locale:r}):_o(e,{locale:r})},apiDateTime:function(e){if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var t={year:e.getUTCFullYear(),month:"0".concat(e.getUTCMonth()+1).slice(-2),day:"0".concat(e.getUTCDate()).slice(-2),hours:"0".concat(e.getUTCHours()).slice(-2),minutes:"0".concat(e.getUTCMinutes()).slice(-2),seconds:"0".concat(e.getUTCSeconds()).slice(-2)};return"".concat(t.year).concat(t.month).concat(t.day).concat(t.hours).concat(t.minutes).concat(t.seconds)},apiDate:function(e){if(!(e instanceof Date))throw new TypeError("Input date must be an instance of Date");var t={year:e.getUTCFullYear(),month:"0".concat(e.getUTCMonth()+1).slice(-2),day:"0".concat(e.getUTCDate()).slice(-2)};return"".concat(t.year).concat(t.month).concat(t.day)},dateDiff:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.unit,i=void 0===r?"days":r;if(!(e instanceof Date&&t instanceof Date))throw new TypeError("Input dates must both be an instance of Date");var a={milliseconds:{factor:1},seconds:{factor:1e3},minutes:{factor:6e4},hours:{factor:36e5},days:{factor:864e5}};if(!Object.keys(a).includes(i))throw new RangeError("The supplied diff unit must be one of ".concat(Object.keys(a).join(", ")));var o=e.getTime(),s=t.getTime(),l=Math.abs(o-s);return Math.round(l/a[i].factor)},dayRange:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.step,i=void 0===r?1:r;if(!(e instanceof Date&&t instanceof Date))throw new TypeError("Input dates must both be an instance of Date");for(var a=[],o=new Date(e),s=t.getTime();o.getTime()<s;)a.push(new Date(o)),o.setDate(o.getDate()+i);return a}}),To=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.component,i=void 0===n?null:n,a=t.environment,o=void 0===a?"mindtouch-web":a;r(this,e),this._component=i,this._environment=o}return a(e,[{key:"newEventName",value:function(e){return null!==this._component?"".concat(this._environment,":").concat(this._component,":").concat(e):"".concat(this._environment,":").concat(e)}},{key:"newErrorEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.newEvent("error",Object.assign(t,{_error:e}))}},{key:"newEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new CustomEvent(this.newEventName(e),{bubbles:!0,cancelable:!0});return n.data=t,n}}]),e}(),So=function(e){var t,i;function o(){var e;return r(this,o),(e=h(this,l(o).call(this)))._events=new $e(e.martianSettings),e._eventFactory=null,e._id=null,e._type=null,e}return s(o,e),a(o,null,[{key:"init",value:(t=n(regeneratorRuntime.mark((function e(){var t,n,r,i,a,s,l,c,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.eventFactory,r=t.id,i=void 0===r?null:r,a=t.type,s=void 0===a?"case":a,(l=new o)._eventFactory=n,l._type=s,null!==i){e.next=19;break}return c=null,e.prev=6,e.next=9,l._events.logFormInit(s);case 9:c=e.sent,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(6),document.dispatchEvent(l._eventFactory.newErrorEvent(e.t0,{message:"Form logger could not be initialized",type:l._type})),e.abrupt("return",null);case 16:l._id=c.id,e.next=20;break;case 19:l._id=i;case 20:return document.dispatchEvent(l._eventFactory.newEvent("form-activity-logger-ready",{logger:l})),e.abrupt("return",l);case 22:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(){return t.apply(this,arguments)})}]),a(o,[{key:"submit",value:(i=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._events.logFormSubmit(this._id,this._type);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),document.dispatchEvent(this._eventFactory.newErrorEvent(e.t0,{id:this._id,message:"Form submission could not be logged",type:this._type})),e.abrupt("return",!1);case 9:return document.dispatchEvent(this._eventFactory.newEvent("form-activity-logger-submitted",{id:this._id,type:this._type})),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return i.apply(this,arguments)})},{key:"id",get:function(){return this._id}},{key:"type",get:function(){return this._type}}]),o}(ea(function(){return function e(){r(this,e)}}())),Eo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.eventFactory,i=void 0===n?new To({component:"analytics"}):n,a=t.getCurrentUserActivityToken,o=void 0===a?null:a;r(this,e),this._eventFactory=i,this._getCurrentUserActivityToken=o}var t;return a(e,[{key:"initFormActivityLogger",value:(t=n(regeneratorRuntime.mark((function e(t){var n,r,i,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},r=n.id,i=void 0===r?null:r,e.next=3,So.init({eventFactory:this._eventFactory,errorHandler:this._errorHandler,id:i,type:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"userActivityToken",get:function(){var e=this._getCurrentUserActivityToken;return"function"!=typeof e?null:e()}}]),e}(),Co={analytics:new Eo({getCurrentUserActivityToken:function(){return"".concat(Gi("userId"),":").concat(Gi("sessionId"))}})};var xo=function(e,t){return e=e.toLowerCase(),Ir("i",{className:"mt-review-icon-".concat(e),title:t("Page.ReviewWorkflow.label.reviewer-".concat(e))})},Ro=function(e){return"assign-to-me"!==e&&"reassign"!==e},jo={resourceKeys:["Page.ReviewBanner.label.single-review-description.accepted","Page.ReviewBanner.label.single-review-description.cancelled","Page.ReviewBanner.label.single-review-description.reviewRequested","Page.ReviewBanner.label.single-review-description.editsRequested"],key:function(e){var t=Object.keys(ln.states).find((function(t){return ln.states[t]===e}));return t?"Page.ReviewBanner.label.single-review-description.".concat(t):null}},Ao=Object.freeze({reviewerTypeIcon:xo,canDisplayCommentBlock:Ro,reviewDescription:jo}),Io=function(e){var t,i,o;function c(e){var t;if(r(this,c),(t=h(this,l(c).call(this,e))).initialize({defaults:{hidden:!0},events:["onhistoryshow","onhistoryhide"]}),!t.options.reviewId)throw new Error("A reviewId is required");return t}return s(c,e),a(c,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new c(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Dialog.ReviewWorkflow.message.no-review","Page.ReviewWorkflow.button.toggle.review-history","Page.ReviewWorkflow.label.section.select"].concat(p(jo.resourceKeys))}}]),a(c,[{key:"_createUi",value:(o=n(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.element=Kr({className:"mt-recent-review-history",dataset:{reviewId:this.options.reviewId},hidden:this.options.hidden},Gr({colSpan:"7"})),this.toggleButtonElement=Mr({className:"mt-review-history-toggle-collapse",ariaLabel:"".concat(this.localize("Page.ReviewWorkflow.button.toggle.review-history")),ariaExpanded:!1,onclick:function(){var e=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._getRecentReviewHistory();case 2:t._toggleReviewHistory(t.options.reviewId);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}),this.options.hidden||this._getRecentReviewHistory();case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_getRecentReviewHistory",value:(i=n(regeneratorRuntime.mark((function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.element.children[0].children.length){e.next=16;break}return e.next=3,new ln(this.martianSettings).getInfo(this.options.reviewId);case 3:if(this.review=e.sent,!(t=this.review.states.reverse().slice(0,5)).some((function(e){return"string"==typeof e.pageSection}))){e.next=15;break}return r=new Ut(this.review.page.id,this.martianSettings),e.next=10,r.getTableOfContents();case 10:if(!(i=e.sent)){e.next=15;break}return e.next=14,this._parseTOC(i);case 14:n=e.sent;case 15:t.forEach((function(e){var t;if(e.pageSection){var r=n.querySelector('a[href="#'.concat(e.pageSection,'"]'));r&&(t=r.innerText)}a.element.children[0].appendChild(Nr(Or({className:"mt-single-review-history-detail mt-icon-arrow2"},Ir("strong","".concat(e.label," - ")),a.localize(jo.key(e.label),e.requestedBy.name,e.requestedOf.name)," ",Ir("time",{title:ko(e.createdTime),dateTime:e.createdTime},ko(e.createdTime)),t&&Nr(" - ",Ir("strong",a.localize("Page.ReviewWorkflow.label.section.select")," - "),t)),a._reviewComment(e.comment)))}));case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_parseTOC",value:function(e){var t=new DOMParser;try{return t.parseFromString(e,"text/html").body.querySelector("ol")}catch(e){return Ir("ol")}}},{key:"_reviewComment",value:function(e){var t=e.length>0?'"'.concat(e,'"'):Ir("i",this.localize("Dialog.ReviewWorkflow.message.no-review"));return Or({className:"mt-single-review-history-comment"},t)}},{key:"_toggleReviewHistory",value:function(e){this.element.hidden?(this.element.hidden=!1,this.toggleButtonElement.setAttribute("aria-expanded",!0),this.toggleButtonElement.classList.remove("mt-review-history-toggle-collapse"),this.toggleButtonElement.classList.add("mt-review-history-toggle-expand"),this.callEvent("onhistoryshow",{reviewId:this.options.reviewId})):(this.element.hidden=!0,this.toggleButtonElement.setAttribute("aria-expanded",!1),this.toggleButtonElement.classList.add("mt-review-history-toggle-collapse"),this.toggleButtonElement.classList.remove("mt-review-history-toggle-expand"),this.callEvent("onhistoryhide",{reviewId:e}))}}]),c}(ea(Di(Ti))),No=function(e){var t,i;function o(e){var t;return r(this,o),(t=h(this,l(o).call(this,e))).initialize({defaults:{},events:["onupdate","onerror","showreviewhistory"]}),t._pageId=t.getSetting("pageId"),t._userId=t.getSetting("userId"),t._userName=t.getSetting("userName"),t}return s(o,e),a(o,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewBanner.label.accept","Page.ReviewBanner.label.cancel","Page.ReviewBanner.label.multiple-reviews-description","Page.ReviewBanner.label.multiple-reviews","Page.ReviewBanner.label.reassign","Page.ReviewBanner.label.request-edits","Page.ReviewBanner.label.request-review","Page.ReviewBanner.label.review-history","Page.ReviewBanner.label.show-all-reviews","Page.ReviewBanner.label.assign-to-me"].concat(p(jo.resourceKeys),p(Io.resourceKeys),p(Fi.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageId","userId","userName","isDraftRequest"]}}]),a(o,[{key:"_createUi",value:(i=n(regeneratorRuntime.mark((function e(){var t,n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getSetting("isDraftRequest")?"listForDraft":"listForPage",e.next=4,new ln(this.martianSettings)[n](this._pageId);case 4:t=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),this.callEvent("onerror",e.t0),e.abrupt("return");case 11:t.length>1?this.element=Nr(Or({className:"mt-review-banner-description"},Ir("strong",this.localize("Page.ReviewBanner.label.multiple-reviews")),Ir("br"),this.localize("Page.ReviewBanner.label.multiple-reviews-description",t.length)),Ir("ol",{className:"mt-review-banner-actions"},Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-show-all-reviews",onclick:function(e){e.preventDefault(),i.callEvent("onupdate")}},this.localize("Page.ReviewBanner.label.show-all-reviews"))))):1===t.length&&((r=t[0]).currentState=r.states.find((function(e){return e.id===r.currentStateId})),this.element=Nr(Or({className:"mt-review-banner-description"},Ir("strong",r.currentState.label),Ir("br"),this.localize(jo.key(r.currentState.label),r.currentState.requestedBy.name,r.currentState.requestedOf.name)," ",Ir("time",{title:ko(r.currentState.createdTime),dateTime:r.currentState.createdTime},_o(r.currentState.createdTime))),this._getReviewActions(r)));case 12:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return i.apply(this,arguments)})},{key:"_getReviewActions",value:function(e){var t,r=this,i=Ir("ol",{className:"mt-review-banner-actions"});return e.rules.canAccept&&e.rules.canNeedsEdits&&(i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-needs-edits",onclick:function(t){t.preventDefault(),r.callEvent("onupdate",{reviewId:e.id,label:ln.states.editsRequested,flag:"needs-edits"})}},this.localize("Page.ReviewBanner.label.request-edits")))),i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-accept",onclick:function(t){t.preventDefault(),r.callEvent("onupdate",{reviewId:e.id,label:ln.states.accepted,flag:"accepted"})}},this.localize("Page.ReviewBanner.label.accept"))))),e.rules.canRequestReview&&i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-request-review",onclick:function(t){t.preventDefault(),r.callEvent("onupdate",{reviewId:e.id,label:ln.states.reviewRequested,flag:"request-review"})}},this.localize("Page.ReviewBanner.label.request-review")))),e.rules.canReassign&&i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-reassign",onclick:function(t){t.preventDefault(),r.callEvent("onupdate",{reviewId:e.id,flag:"reassign"})}},this.localize("Page.ReviewBanner.label.reassign")))),e.rules.canPickup&&i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-assign-to-me",onclick:function(t){t.preventDefault(),r.callEvent("onupdate",{reviewId:e.id,flag:"assign-to-me",user:{name:r._userName,id:r._userId}})}},this.localize("Page.ReviewBanner.label.assign-to-me")))),e.rules.canCancel&&i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-cancel",onclick:function(t){t.preventDefault(),r.callEvent("onupdate",{reviewId:e.id,label:ln.states.cancelled,flag:"cancel"})}},this.localize("Page.ReviewBanner.label.cancel")))),i.appendChild(Ir("li",{className:"mt-review-banner-action"},qr({className:"mt-review-banner-action-review-history",onclick:(t=n(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Io.create({reviewId:e.id,hidden:!1});case 2:return n=t.sent,t.next=5,Fi.create({content:n.element,showSecondaryButton:!1,title:r.localize("Page.ReviewBanner.label.review-history")});case 5:r._dialog=t.sent,r.callEvent("showreviewhistory");case 7:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},this.localize("Page.ReviewBanner.label.review-history")))),i}}]),o}(Yi(ea(Di(Ti)))),Do=function(e){var t,i;function o(e){var t;return r(this,o),(t=h(this,l(o).call(this,e))).initialize({defaults:{},events:["onrequestedofselected","onreset"]}),t}return s(o,e),a(o,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new o(t))._createUi(),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewWorkflow.label.required","Page.ReviewWorkflow.label.reviewer-group","Page.ReviewWorkflow.label.reviewer-user","Page.ReviewWorkflow.label.reviewer","Page.ReviewWorkflow.title.selected-requested-of-reset","Page.ReviewWorkflow.grant.input.select.filter","Page.ReviewWorkflow.placeholder.user-group"]}},{key:"settingsKeys",get:function(){return["isArticleReviewCommunityMembersEnabled"]}}]),a(o,[{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.callEvent("onreset"),p(this._typeFilters).concat([this._reviewerInput]).forEach((function(e){return e.hidden=!1})),this._autoCompleteResults.hidden=!1,this._selectedReviewer.hidden=!0,this._reviewerInput.value="",e&&this._reviewerInput.focus()}},{key:"setSelectedReviewer",value:function(e){var t=e.type,n=e.name,r=e.hideReset,i=void 0!==r&&r;this._selectedReviewer.innerText=n,this._selectedReviewer.classList.remove("mt-review-selected-requested-of-user","mt-review-selected-requested-of-group"),this._selectedReviewer.classList.add("mt-review-selected-requested-of-".concat(t)),i&&(this._selectedReviewer.hidden=!0,this.element.querySelector(".mt-review-required").hidden=!0),this._autoCompleteResults.hidden=!0,this._selectedReviewer.hidden=!1,p(this._typeFilters).concat([this._reviewerInput]).forEach((function(e){return e.hidden=!0}))}},{key:"_setAutocompletePlaceholder",value:function(){var e=this,t=[],n=[this.element.querySelector('.mt-review-requested-of-type[name="users"]'),this.element.querySelector('.mt-review-requested-of-type[name="groups"]')];this._reviewerInput.setAttribute("disabled","disabled"),this._reviewerInput.setAttribute("placeholder",this._reviewerInput.dataset.selectFilter),n.forEach((function(n){n.checked&&(e._reviewerInput.removeAttribute("disabled"),t.push(n.parentElement.innerText.trim()))})),!1===this._reviewerInput.disabled&&(this._reviewerInput.setAttribute("placeholder",t.join(" & ")),this._reviewerInput.setAttribute("aria-label",t.join(" & ")))}},{key:"_createUi",value:function(){var e,t,n=this,r="mt-review-requested-of-input";this.element=Ir("fieldset",{className:"mt-review-requested-of"},$r({htmlFor:r,className:"mt-review-form-label"},this.localize("Page.ReviewWorkflow.label.reviewer")," ",Ur({className:"mt-review-required"},"(".concat(this.localize("Page.ReviewWorkflow.label.required"),")"))),this._typeFilters=[$r({className:"mt-review-requested-of-type-label mt-review-requested-of-type-label-first"},e=Wr({className:"mt-review-requested-of-type",defaultChecked:!0,name:"users",onclick:function(){return n._setAutocompletePlaceholder()},type:"checkbox"}),xo("user",this.localize),this.localize("Page.ReviewWorkflow.label.reviewer-user")),$r({className:"mt-review-requested-of-type-label"},t=Wr({className:"mt-review-requested-of-type",defaultChecked:!0,name:"groups",onclick:function(){return n._setAutocompletePlaceholder()},type:"checkbox"}),xo("group",this.localize),this.localize("Page.ReviewWorkflow.label.reviewer-group"))],this._reviewerInput=Wr({type:"text",id:r,autocomplete:"off",autofocus:!0,dataset:{selectFilter:this.localize("Page.ReviewWorkflow.grant.input.select.filter")},placeholder:this.localize("Page.ReviewWorkflow.placeholder.user-group")}),this._autoCompleteResults=zr({className:"mt-review-requested-of-results"}),this._selectedReviewer=Mr({className:"mt-review-selected-requested-of-reset",onclick:function(e){e.preventDefault(),n.reset(!0)},title:this.localize("Page.ReviewWorkflow.title.selected-requested-of-reset"),hidden:!0})),this._setUpAutocomplete(e,t)}},{key:"_setUpAutocomplete",value:(i=n(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ea.create({inputElement:this._reviewerInput,dataProvider:this._autocompleteDataProvider(t,n),parentElement:this._autoCompleteResults,onitemselected:function(e){r.callEvent("onrequestedofselected",{id:e.detail.id,type:e.detail.type,name:e.detail.label}),r.setSelectedReviewer({type:e.detail.type,name:e.detail.label})}});case 2:this._autocomplete=e.sent,this._autocomplete.itemsTemplate=this._autocompleteItemsTemplate;case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_autocompleteItemsTemplate",value:function(e){var t=this;return Br({className:"mt-review-requested-of-list ui-menu"},e.map((function(e){return Hr({onmousedown:function(e){return t.itemSelected(e)},dataset:e,className:"ui-menu-item"},e.label||e.value)})))}},{key:"_autocompleteDataProvider",value:function(e,t){var n=this;return function(r){var i=[],a=[];if(e.checked){var o=new Rn(n.martianSettings),s={active:!0,format:"autocomplete",fullname:r,username:r};n.getSetting("isArticleReviewCommunityMembersEnabled")||(s.seated=!0);var l=o.searchUsers(s);a.push(l)}if(t.checked){var c=new mt(n.martianSettings).getGroupList({nameFilter:r,limit:"all"});a.push(c)}return Promise.all(a).then((function(e){return e.forEach((function(e){e.users&&i.push.apply(i,p(e.users.map((function(e){return n._formatUserForAutoComplete(e)})))),e.groups&&i.push.apply(i,p(e.groups.map((function(e){return n._formatGroupForAutoComplete(e)}))))})),i}))}}},{key:"_formatUserForAutoComplete",value:function(e){var t=e.username;return e.fullname!==e.username&&""!==e.fullname&&(t+=" (".concat(e.fullname,")")),{value:e.username,label:Nr(xo("user",this.localize),t),type:"user",id:e.id}}},{key:"_formatGroupForAutoComplete",value:function(e){return{id:e.id,label:Nr(xo("group",this.localize),e.groupName),type:"group",value:e.groupName}}}]),o}(Yi(ea(Di(Ti)))),Lo=function(e){var t,i,o,c;function u(e){var t;return r(this,u),(t=h(this,l(u).call(this,e))).initialize({defaults:{},events:["onsuccess","onerror","onsubmit","onrequestedofselected"]}),t._pageId=parseInt(t.getSetting("pageId"),10),t._reviewApi=new ln(t.martianSettings),t}return s(u,e),a(u,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u(t),e.next=3,n._createUi();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewWorkflow.button.cancel-create-review","Page.ReviewWorkflow.error.type-user-or-group","Page.ReviewWorkflow.label.date","Page.ReviewWorkflow.label.reassign","Page.ReviewWorkflow.label.review-comments","Page.ReviewWorkflow.label.section.entire-document","Page.ReviewWorkflow.label.section.no-headings","Page.ReviewWorkflow.label.section.remove","Page.ReviewWorkflow.label.section.table-of-contents","Page.ReviewWorkflow.label.section.select","Page.ReviewWorkflow.label.status","System.API.Error.article-review-user-forbidden"].concat(p(Do.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageId","isDraftRequest"]}}]),a(u,[{key:"submitReview",value:(c=n(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={requestedOf:this._requestedOf.value.trim().length>0?parseInt(this._requestedOf.value,10):null,requestedOfType:this._requestedOf.dataset.type,comment:this._comment.value,draft:this.getSetting("isDraftRequest"),pageSection:this._selectedSection},n="create",void 0!==this.options.reviewId?(n="update",t.reviewId=this.options.reviewId,void 0!==this.options.label&&(t.label=this.options.label)):t.id=this._pageId,e.prev=3,e.next=6,this._reviewApi[n](t);case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),403===e.t0.status?(r={status:403,message:"Forbidden",info:{message:this.localize("System.API.Error.article-review-user-forbidden")}},this.callEvent("onerror",r)):("Page.ReviewWorkflow.error.user-or-group-must-be-provided"===e.t0.message&&(e.t0.message=this.localize("Page.ReviewWorkflow.error.type-user-or-group")),this.callEvent("onerror",e.t0)),e.abrupt("return");case 12:return this.callEvent("onsuccess",{id:t.requestedOf,type:t.requestedOfType,name:this._requestedOf.dataset.name,label:this.options.label}),e.next=15,this.element.reset();case 15:case"end":return e.stop()}}),e,this,[[3,8]])}))),function(){return c.apply(this,arguments)})},{key:"_setRequestedOf",value:function(e){var t=e.id,n=e.name,r=e.type;this._requestedOf.value=t,this._requestedOf.dataset.name=n,this._requestedOf.dataset.type=r}},{key:"_createUi",value:(o=n(regeneratorRuntime.mark((function e(){var t,r,i,a,o,s,l,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.options.reviewId){e.next=12;break}return e.prev=1,e.next=4,this._reviewApi.getInfo(this.options.reviewId);case 4:a=e.sent,r=a.states.find((function(e){return e.id===a.currentStateId})),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(1),this.callEvent("onerror",e.t0),e.abrupt("return");case 12:return o=new Ut(this._pageId,this.martianSettings),e.t1=this,e.next=16,o.getTableOfContents();case 16:return e.t2=e.sent,s=e.t1._parseTOC.call(e.t1,e.t2),r&&(l=r.label,"assign-to-me"===this.options.flag&&(l+="-> ".concat(this.localize("Page.ReviewWorkflow.label.reassign")),i={type:"user",name:this.options.user.name,id:this.options.user.id,hideReset:!0}),"reassign"===this.options.flag&&(l+="-> ".concat(this.localize("Page.ReviewWorkflow.label.reassign"))),void 0!==this.options.label&&(l+="-> ".concat(this.options.label),i={type:r.requestedBy.type,name:r.requestedBy.name,hideReset:!0})),e.t3=Ir,e.t4={className:"mt-review-form",onsubmit:function(e){e.preventDefault(),c.submitReview()},onreset:function(){var e=n(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:e.sent.reset();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},e.t5=r&&Nr($r({className:"mt-review-form-label"},"".concat(this.localize("Page.ReviewWorkflow.label.date"),": ")),Ir("time",{title:ko(r.createdTime),dateTime:r.createdTime},_o(r.createdTime)),Ir("br"),$r({className:"mt-review-form-label"},"".concat(this.localize("Page.ReviewWorkflow.label.status"),": ")),Ur({className:"mt-review-form-state"},l),Ir("br")),e.t6=t=Fr(Do,{onreset:function(){c._requestedOf.value=null,delete c._requestedOf.dataset.name,delete c._requestedOf.dataset.type},onrequestedofselected:function(e){c._setRequestedOf(e.detail),c._comment&&c._comment.focus(),c.callEvent("onrequestedofselected")}}),e.next=25,this._tableOfContentsDom(s);case 25:if(e.t7=e.sent,e.t8=Ro(this.options.flag)&&$r(this.localize("Page.ReviewWorkflow.label.review-comments")),e.t9=this._comment=Ro(this.options.flag)&&Ir("textarea",{className:"mt-review-form-textarea",rows:4,autofocus:!0}),e.t10=this._requestedOf=Wr({type:"hidden",name:"requestedOf"}),this.element=(0,e.t3)("form",e.t4,e.t5,e.t6,e.t7,e.t8,e.t9,e.t10),!i){e.next=36;break}return e.next=33,t;case 33:e.t11=i,e.sent.setSelectedReviewer(e.t11),"assign-to-me"===this.options.flag&&this._setRequestedOf({id:this.options.user.id,name:this.options.user.name,type:"user"});case 36:this.addEvent("onsubmit",(function(){c.submitReview()}));case 37:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return o.apply(this,arguments)})},{key:"_parseTOC",value:function(e){var t,n=new DOMParser;try{t=n.parseFromString(e,"text/html")}catch(e){}return t.body.querySelector("ol")}},{key:"_tableOfContentsDom",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="mt-review-form-section-selection",r=Nr($r({className:"mt-review-form-label"},"".concat(this.localize("Page.ReviewWorkflow.label.section.select"),": ")),this._selectedSectionElm=Ur({className:"mt-review-form-selected-section"})),null!==t){e.next=6;break}r.appendChild(Or({className:"".concat(n," mt-review-form-section-selection-no-headings")},this.localize("Page.ReviewWorkflow.label.section.no-headings"))),e.next=12;break;case 6:return e.next=8,qi.create({collapsed:!0,content:t,toggleTitle:this.localize("Page.ReviewWorkflow.label.section.table-of-contents")});case 8:this._collapsibleSection=e.sent,this._collapsibleSection.element.classList.add(n),this._collapsibleSection.element.addEventListener("click",(function(e){e.target.hasAttribute&&e.target.hasAttribute("href")&&(e.preventDefault(),i._setSelection({urlFragment:e.target.getAttribute("href"),title:e.target.innerText}),i._collapsibleSection.close())})),r.appendChild(this._collapsibleSection.element);case 12:return this._setSelection({}),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_setSelection",value:function(e){var t=this,n=e.urlFragment,r=void 0===n?null:n,i=e.title;"string"==typeof r&&0===r.indexOf("#")&&(r=r.slice(1)),this._selectedSection=r,ni(this._selectedSectionElm);var a=!1,o=Nr(this.localize("Page.ReviewWorkflow.label.section.entire-document"));null!==r&&(a=!0,o=Mr({className:"mt-review-form-selected-section-reset",title:this.localize("Page.ReviewWorkflow.label.section.remove"),type:"button",onclick:function(){t._setSelection({})}},i)),this._selectedSectionElm.appendChild(o),this._collapsibleSection&&this._collapsibleSection.element&&(this._collapsibleSection.element.hidden=a)}}]),u}(Yi(ea(Di(Ti)))),Fo=function(e){var t,i,o,c,u;function d(e){var t;return r(this,d),(t=h(this,l(d).call(this,e))).initialize({defaults:{},events:["onupdate"]}),t._pageId=t.getSetting("pageId"),t._userIsAdmin=t.getSetting("userIsAdmin"),t._reviewApi=new ln(t.martianSettings),t._userId=t.getSetting("userId"),t._userName=t.getSetting("userName"),t}return s(d,e),a(d,null,[{key:"create",value:(t=n(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d(t),e.next=3,n._fetchDependencies();case 3:return e.next=5,n._createUi();case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resourceKeys",get:function(){return["Page.ReviewWorkflow.button.cancel","Page.ReviewWorkflow.label.accept","Page.ReviewWorkflow.label.date","Page.ReviewWorkflow.label.no-open-reviews","Page.ReviewWorkflow.label.reassign","Page.ReviewWorkflow.label.request-edits","Page.ReviewWorkflow.label.request-review","Page.ReviewWorkflow.label.status","Page.ReviewWorkflow.table.actions","Page.ReviewWorkflow.label.assign-to-me","Page.ReviewWorkflow.table.requested-by","Page.ReviewWorkflow.table.requested-of","Page.ReviewWorkflow.table.review-history"].concat(p(Do.resourceKeys),p(Io.resourceKeys))}},{key:"settingsKeys",get:function(){return["pageId","userIsAdmin","userId","userName","isDraftRequest"]}}]),a(d,[{key:"updateUiFromStateTransition",value:(u=n(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n!==ln.states.cancelled&&n!==ln.states.accepted){e.next=4;break}this._reviews=this._reviews.filter((function(e){return e.id!==t})),e.next=6;break;case 4:return e.next=6,this._fetchDependencies();case 6:this._createUi();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"_keepSelectedButtonEnabled",value:function(e){var t=this.element.querySelector(".mt-review-form-currently-selected");t&&t!==e.target&&t.classList.remove("mt-review-form-currently-selected"),e.target.classList.add("mt-review-form-currently-selected")}},{key:"_fetchDependencies",value:(c=n(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSetting("isDraftRequest")?"listForDraft":"listForPage",e.next=3,new ln(this.martianSettings)[t](this._pageId);case 3:this._reviews=e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"_createUi",value:(o=n(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Or(this.localize("Page.ReviewWorkflow.label.no-open-reviews")),this.element||(this.element=zr(t)),!(this._reviews.length<1)){e.next=5;break}return this.element.replaceChild(t,this.element.children[0]),e.abrupt("return");case 5:return n=[Qr(this.localize("Page.ReviewWorkflow.label.date")),Qr(this.localize("Page.ReviewWorkflow.table.requested-by")),Qr(this.localize("Page.ReviewWorkflow.table.requested-of")),Qr(this.localize("Page.ReviewWorkflow.label.status")),Qr(this.localize("Page.ReviewWorkflow.table.actions")),Qr(this.localize("Page.ReviewWorkflow.table.review-history"))],e.t0=this.element,e.t1=Vr,e.t2={width:"100%"},e.t3=Ir("thead",Kr(n)),e.t4=Ir,e.next=13,Promise.all(this._reviews.map((function(e){return r._reviewElm(e)})));case 13:e.t5=e.sent,e.t6=(0,e.t4)("tbody",e.t5),e.t7=(0,e.t1)(e.t2,e.t3,e.t6),e.t8=this.element.children[0],e.t0.replaceChild.call(e.t0,e.t7,e.t8);case 18:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_reviewElm",value:(i=n(regeneratorRuntime.mark((function e(t){var n,r,i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.states.find((function(e){return e.id===t.currentStateId})),r="mt-review-form-currently-selected",i=Nr(),e.next=5,Io.create({reviewId:t.id});case 5:return a=e.sent,t.rules.canAccept&&t.rules.canNeedsEdits&&(i.appendChild(Mr({className:"mt-review-button-needs-edits ".concat("needs-edits"===this.options.flag?r:""),onclick:function(e){o._keepSelectedButtonEnabled(e),o.callEvent("onupdate",{reviewId:t.id,label:ln.states.editsRequested,flag:"needs-edits"})}},this.localize("Page.ReviewWorkflow.label.request-edits"))),i.appendChild(Mr({className:"mt-review-button-accept ".concat("accepted"===this.options.flag?r:""),onclick:function(e){o._keepSelectedButtonEnabled(e),o.callEvent("onupdate",{reviewId:t.id,label:ln.states.accepted,flag:"accepted"})}},this.localize("Page.ReviewWorkflow.label.accept")))),t.rules.canRequestReview&&i.appendChild(Mr({className:"mt-review-button-request-review ".concat("request-review"===this.options.flag?r:""),onclick:function(e){o._keepSelectedButtonEnabled(e),o.callEvent("onupdate",{reviewId:t.id,label:ln.states.reviewRequested,flag:"request-review"})}},this.localize("Page.ReviewWorkflow.label.request-review"))),(this._userIsAdmin||t.rules.canReassign)&&i.appendChild(Mr({className:"mt-review-button-reassign ".concat("reassign"===this.options.flag?r:""),onclick:function(e){o._keepSelectedButtonEnabled(e),o.callEvent("onupdate",{reviewId:t.id,flag:"reassign"})}},this.localize("Page.ReviewWorkflow.label.reassign"))),(this._userIsAdmin||t.rules.canPickup)&&i.appendChild(Mr({className:"mt-review-button-assign-to-me ".concat("assign-to-me"===this.options.flag?r:""),onclick:function(e){o._keepSelectedButtonEnabled(e),o.callEvent("onupdate",{reviewId:t.id,flag:"assign-to-me",user:{name:o._userName,id:o._userId}})}},this.localize("Page.ReviewWorkflow.label.assign-to-me"))),(this._userIsAdmin||t.rules.canCancel)&&i.appendChild(Mr({className:"mt-review-button-cancel ".concat("cancel"===this.options.flag?r:""),onclick:function(e){o._keepSelectedButtonEnabled(e),o.callEvent("onupdate",{reviewId:t.id,label:ln.states.cancelled,flag:"cancel"})}},this.localize("Page.ReviewWorkflow.button.cancel"))),e.abrupt("return",Nr(Kr({dataset:{reviewId:t.id}},Gr({title:ko(n.createdTime)},_o(n.createdTime)),Gr(n.requestedBy.name),Gr(xo(n.requestedOf.type,this.localize),n.requestedOf.name),Gr(n.label),Gr(i),Gr({className:"mt-review-history"},a.toggleButtonElement)),a.element));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})}]),d}(Yi(ea(Di(Ti)))),qo={dialog:null,_alertDialogTmpl:function(e){var t=e.title,n=e.message,r=e.okButton;return zr({className:"mt-dialog-root",title:t},zr({className:"mt-scrolling-dialog-content"},zr({className:"mt-dialog-alert mt-dialog-content"},Or(n))),zr({className:"mt-dialog-button-container"},zr({className:"ui-dialog-buttonset"},Mr({id:"mt-dialog-alert-ok",type:"button",className:"ui-button ui-button-primary ui-widget ui-state-default ui-corner-all ui-button-text-only",role:"button"},Ur({className:"ui-button-text"},r)))))},show:function(e){var t=this,n=this._alertDialogTmpl(e);this.dialog=$("<div></div>").modal({content:n,width:450,modal:!0,title:e.title,naming:"alert",resizable:!1,dialogClass:"mt-dialog",load:function(){t.init()}})},init:function(){var e=this;$("#mt-dialog-alert-ok").on("click",(function(){e.dialog.remove()}))}},Mo={markedAsRead:function(){Vn().at("layout","feature-banner","status.json").post("","").then((function(){$(".mt-new-features-container").slideUp(800),$("#mt-new-features-bar").remove()}))}};$((function(){$(document).on("click",".mt-new-features-close",Mo.markedAsRead)}));var zo,Oo=["Page.FeedbackRating.label.last-rated","Page.FeedbackRating.message.contact.yes","Page.FeedbackRating.message.contact.no","Page.FeedbackRating.message.submit.success","Page.FeedbackRating.message.submit.error"],Uo=!1,Bo={buttonClick:function(e,t){var n=e.hasClass("mt-selected");!0!==t||n||this.showFeedback(),this.elements.allButtons.removeClass("mt-selected"),n||e.addClass("mt-selected")},showFeedback:function(){var e=window.scrollY||document.documentElement.scrollTop,t=$(".mt-feedback-rating-container").offset().top;this.elements.feedbackForm.show(),e<t&&window.innerHeight+e<t+this.elements.feedbackForm.outerHeight()&&($("body, html").animate({scrollTop:t},100),this.elements.feedbackTextArea.focus())},getLocalStorageRatings:function(){var e=dr.fetch("mt-page-ratings")||null,t={};return null!==e&&(t=JSON.parse(e)),t},updateRatingUi:function(e){this.currentRating=e,0===e?this.buttonClick(this.elements.noButton):e>0&&this.buttonClick(this.elements.yesButton)},getRating:function(){var e=this;if(this.ratingInfo.useLocalStorage){var t=this.getLocalStorageRatings();if(this.ratingInfo.ratingKey in t){var n=window.parseInt(t[this.ratingInfo.ratingKey],10);this.updateRatingUi(n)}}else{new Ut(Bn.get("pageId"),_r).getRating().then((function(t){t.userRatedBy&&(e.updateRatingUi(t.userRatedBy.score),e.setRatedDate(t.userRatedBy.date))}),(function(){}))}},rate:function(e){var t=this;if(new Ut(Bn.get("pageId"),_r).rate(e,this.currentRating).then((function(){t.currentRating=e,null===e?t.elements.lastRating.empty():t.ratingInfo.useLocalStorage||t.setRatedDate(new Date)})),this.ratingInfo.useLocalStorage){var n=this.getLocalStorageRatings();""===e?delete n[this.ratingInfo.ratingKey]:n[this.ratingInfo.ratingKey]=e,dr.store("mt-page-ratings",JSON.stringify(n)),this.currentRating=e}},setRatedDate:function(e){this.elements.lastRating.text(zo("Page.FeedbackRating.label.last-rated",ko(e)))},submitFeedback:function(){var e=$(".mt-feedback-consent-checkbox").prop("checked"),t=Bo.elements.feedbackTextArea.val().trim(),n=Bo.elements.feedbackForm.data(),r=n.userEmail,i=n.pageTitle,a=n.siteUrl,o=n.path.split("/").map(encodeURIComponent).join("/");if(""!==t&&!Uo){var s={target:"mt-feedback-flash-message"};Uo=!0,new Mn(_r).submitFeedback({_path:o,userEmail:r,pageTitle:i,siteUrl:a,content:t,contactAllowed:zo(e?"Page.FeedbackRating.message.contact.yes":"Page.FeedbackRating.message.contact.no")}).then((function(){Uo=!1,Bo.elements.feedbackForm.hide(),Bo.elements.feedbackTextArea.val(""),Bo.elements.feedbackSubmit.addClass("mt-disabled"),di.Flash(zo("Page.FeedbackRating.message.submit.success"),"success",s)})).catch((function(){Uo=!1,di.Flash(zo("Page.FeedbackRating.message.submit.error"),"error",s),Bo.elements.feedbackSubmit.one("click",Bo.submitFeedback)}))}}};$((function(){var e=$(".mt-feedback-rating-container");if(0!==e.length&&(zo=ki("mt-localizations-feedback-rating",Oo),!Bn.get("isDraftRequest")&&!e.is(":empty"))){var t=Bn.get("pageId");if(void 0===t||0===t)return;Bo.ratingInfo={ratingKey:"".concat(t,":").concat(e.data("pageRevision")),useLocalStorage:e.data("useLocalStorage")},Bo.currentRating=null,Bo.elements={yesButton:$(".mt-rating-button-yes"),noButton:$(".mt-rating-button-no"),allButtons:$(".mt-feedback-rating-button"),lastRating:$(".mt-last-rating-date"),feedbackForm:$(".mt-feedback-form"),feedbackTextArea:$(".mt-feedback-improve-description"),feedbackSubmit:$(".mt-feedback-submit")},Bo.elements.yesButton.on("click keypress",(function(){var e=Bo.elements.yesButton.hasClass("mt-selected")?null:1;Bo.rate(e),Bo.buttonClick(Bo.elements.yesButton,!0),Bo.elements.yesButton.blur()})),Bo.elements.noButton.on("click keypress",(function(){var e=Bo.elements.noButton.hasClass("mt-selected")?null:0;Bo.rate(e),Bo.buttonClick(Bo.elements.noButton,!0),Bo.elements.noButton.blur()})),$(".mt-feedback-button").on("click keypress",(function(){di.EmptyFlash("success"),Bo.showFeedback()})),Bo.elements.feedbackSubmit.on("click",Bo.submitFeedback),Bo.elements.feedbackTextArea.on("keyup",(function(){""===Bo.elements.feedbackTextArea.val().trim()?Bo.elements.feedbackSubmit.addClass("mt-disabled"):Bo.elements.feedbackSubmit.removeClass("mt-disabled")})),Bo.getRating()}})),$.widget("mt.inputRedirect",{options:{url:"/",key:"query",params:{},label:"Query",placeholder:"Search",button:null,buttontext:"Search",val:"",beforeCreate:null,afterCreate:null,beforeRefresh:null,afterRefresh:null,beforeDestroy:null,afterDestroy:null},_create:function(){this._trigger("beforeCreate");var e=this;if(e.options=dr.extendObject(e.options,e.element.data()),e.element.is("input"))e.$input=e.element,e.$form=e.$input.wrap("<form></form>").parent(),e.$element=e.$form.wrap("<div></div>").parent();else{if(!e.element.is("div"))throw new Error("ERROR: This inputRedirect widget can only be constructed on an <div> or <input> element.");e.element.empty(),e.$element=e.element,e.$input=$(document.createElement("input")),e.$form=$(document.createElement("form")),e.$form.append(e.$input),e.$element.append(e.$form)}e.$input.wrap('<fieldset class="ui-dform-fieldset"><div class="mt-field"></div></fieldset>'),e.$input.parents(".mt-field").prepend($('<label for="mt-inputRedirect-input" class="mt-inputRedirect-label ui-dform-label">'.toLowerCase()+e.options.label+"</label>")),!1!==e.options.button&&(e.options.button?e.$button=$(e.options.button):e.$button=$("<button>").button().html('<span class="ui-button-text">'.concat(e.options.buttontext,"</span>")).addClass("mt-inputRedirect-button".toLowerCase()).appendTo(e.$input.parents(".mt-field"))),e.$element.addClass("mt-inputRedirect".toLowerCase()),e.$form.addClass("ui-dform mt-inputRedirect-form".toLowerCase()).attr("autocomplete","off"),e.$input.addClass("mt-inputRedirect-input ui-dform-input".toLowerCase()).attr("placeholder",e.options.placeholder),e.$input.val(e.$input.attr("value")||e.options.val),e._on(e.$form,{submit:function(t){t.preventDefault(),e.search()}}),e._on(e.$button,{click:function(){e.search()}}),e._trigger("afterCreate")},destroy:function(){var e=this;e._trigger("beforeDestroy"),e.element.is("div")?e.element.removeClass("mt-inputRedirect".toLowerCase()).empty():e.element.is("input")&&(e.element.appendTo(this.$element.parent()),e.$element.remove()),e._trigger("afterDestroy")},search:function(){var e=this,t=e.$input.val().trim();if(""!==t){e.options.params[e.options.key]=t;var n="";Object.keys(e.options.params).length>0&&(n=dr.buildQueryString(e.options.params)),window.location=e.options.url+"?"+n}}});var Ho=Object.assign(window.Deki||{},{get loc(){return dr.formatLocalization},Utility:dr,DelayedSearch:Qn,Uri:cr,UriHash:hi,WindowHistory:mi,Fonts:fi,Related:hr,Ui:Object.assign(di,{Events:Jr,NewFeatures:Mo,Dialog:{Alert:qo}}),_mtLib:Object.assign({srcAnalyticsAnalyticsDispatcher:{AnalyticsDispatcher:ia},srcAnalyticsInteractionAnalytics:{InteractionAnalytics:oa},srcAnalyticsPageViewAnalytics:{PageViewAnalytics:ca},srcAnalyticsPageViewConsumptionAnalytics:{PageViewConsumptionAnalytics:da},srcAnalyticsPageViewPerformanceAnalytics:{PageViewPerformanceAnalytics:ma},srcCommunityAppPlug:Gn,srcCommunityDekiDelayedSearch:{delayedSearch:Qn},srcCommunityDekiRelated:{related:hr},srcCommunityDekiUi:{ui:di},srcCommunityDekiUriHash:{UriHash:hi},srcCommunityDekiUtility:{utility:dr},srcCommunityDekiWindowHistory:{windowHistory:mi},srcCommunityFonts:{fonts:fi},srcCommunityGuideTabsManager:{GuideTabsManager:Hi},srcCommunityRevealListing:{revealListing:function(e,t){if(e){t=Object.assign({showCount:5,showSelector:"li",allowCollapse:!0,collapsed:!1},t);var n=Mr({className:"mt-icon-expand-collapse mt-reveal-listing-expand-link",title:t.showAllLabel,onclick:function(i){i.preventDefault(),t.collapsed?(Array.from(e.getElementsByTagName(t.showSelector)).forEach((function(e){return e.removeAttribute("style")})),n.title=t.showLessLabel,n.innerText=t.showLessLabel,t.collapsed=!1):t.allowCollapse&&r()}},t.showAllLabel);e.classList.add("mt-reveal-listing"),e.querySelectorAll(t.showSelector).length>t.showCount+1&&!e.parentNode.querySelector("button.mt-icon-expand-collapse.mt-reveal-listing-expand-link")&&(e.parentNode.appendChild(n),r(),t.collapsed=!0)}function r(){Array.from(e.getElementsByTagName(t.showSelector)).splice(t.showCount).forEach((function(e){return e.style.display="none"})),n.title=t.showAllLabel,n.innerText=t.showAllLabel,t.collapsed=!0}}},srcCommunitySettings:{settings:Bn},srcCommunityUiEvents:Xr,srcCommunityUiWidgetEditableText:{editableText:fa},srcCommunityUiWidgetExpandablelist:{expandableList:pa},srcCommunityUiWidgetGrid:{grid:va},srcCommunityUiWidgetModal:{modal:wa},srcCommunityUiWidgetTabbedContent:Ta,srcComponentsComponentBase:{ComponentBase:Sa},srcComponentsAutocompleteAutocomplete:{Autocomplete:Ea},srcComponentsCollapsibleSectionCollapsibleSection:{CollapsibleSection:qi},srcComponentsDialogDialog:{Dialog:Fi},srcComponentsFileUploaderFileUploader:{FileUploader:xa},srcComponentsFlashMessageFlashMessage:{FlashMessage:Ra},srcComponentsTabsGuideTabs:{GuideTabs:ja},srcComponentsKcsWorkflowKcsWorkflow:{KcsWorkflow:Qa},srcComponentsTranslateTranslateBanner:{TranslateBanner:go},srcComponentsTranslateTranslateUtils:Ui,srcComponentsPageTitleEditorPageTitleEditor:{PageTitleEditor:Ja},srcComponentsSortableSortable:{Sortable:Mi},srcComponentsTreeHierarchyTree:{HierarchyTree:Da},srcComponentsNavigationHierarchyNavigation:{HierarchyNavigation:La},srcComponentsYoutubeSearchYoutubeSearch:{YoutubeSearch:bo},srcComponentsRelatedPagesRelatedPages:{RelatedPages:Xa},srcComponentsReviewWorkflowReviewBanner:{ReviewBanner:No},srcComponentsReviewWorkflowReviewForm:{ReviewForm:Lo},srcComponentsReviewWorkflowReviewHistory:{ReviewHistory:Io},srcComponentsReviewWorkflowReviewList:{ReviewList:Fo},srcComponentsReviewWorkflowReviewSelect:{ReviewSelect:Do},srcComponentsReviewWorkflowReviewHelper:Ao,srcComponentsSearchSearch:{Search:to},srcComponentsSearchSearchFilters:{SearchFilters:oo},srcComponentsSearchSearchFiltersSpaceballs2:{SearchFiltersSpaceballs2:ho},srcComponentsSearchSearchLocationNav:{SearchLocationNav:lo},srcComponentsSearchSearchUrl:{SearchUrl:so},srcComponentsSearchSearchRedirect:{SearchRedirect:mo},srcComponentsSearchSearchRedirectWidget:{SearchRedirectWidget:fo},srcComponentsSearchResultsSearchResults:{SearchResults:Za},srcControllersSearch:{searchController:wo},srcIntegrationsAnalyticsAnalyticsConnector:{AnalyticsConnector:Eo},srcIntegrationsDekiDekiIntegration:{DekiIntegration:Co},srcLibEnvironmentSettings:Ji,srcLibLocalizer:Li,srcLibMartianSettingsManager:ta,srcLibMartianSettings:kr,srcUiDateTimeUtility:Po,srcUiDomBuilder:Yr,srcUiDomEventFactory:{DomEventFactory:To},srcUiDomTools:ui,srcUiLocalization:Pi,srcUiSpinner:ti,srcUiStringUtility:lr,srcUiUri:{Uri:cr},srcStandaloneUiSignInTabs:{signInTabsInit:function(e){if("querySelector"in e){var t=e.querySelector("#mt-login-form");t&&t.addEventListener("submit",(function(){Zr(t)}));var n=e.querySelectorAll(".login-password-register ul li");n.forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault(),a(e)})),e.addEventListener("keydown",(function(t){"Enter"===t.code&&a(e)}))}));var r=new hi(window.location.hash),i=e.querySelector("#widget-".concat(r.getParam("tab")));null===i&&(i=e.querySelector("#widget-login")),a(i)}function a(t){if(null!==t){n.forEach((function(e){e.classList.remove("ui-state-active","ui-tabs-selected")})),t.classList.add("ui-state-active","ui-tabs-selected"),e.querySelectorAll("div.widget-panel").forEach((function(e){e.classList.remove("show","active-panel"),e.classList.add("hide")}));var r=e.querySelector("#".concat(t.id,"-panel"));if(r){r.classList.remove("hide"),r.classList.add("show","active-panel");var i=r.querySelector("#text-username");i&&i.focus()}window.location.hash=(new hi).withParam("tab",rr(t.id,"-")).toHashString()}}}},srcStandaloneUiHomepageNav:{homePageNavInit:function(){var e={rootNav:"elm-header-homepage-nav",openNav:"elm-header-homepage-nav-open",detailedNav:"elm-homepage-nav-detail",selectedPage:"elm-homepage-nav-selected",getSelector:function(e){return".".concat(this[e])}},t=document.querySelector(e.getSelector("rootNav"));function n(){t.classList.remove(e.detailedNav),ii(e.getSelector("selectedPage")).forEach((function(t){return t.classList.remove(e.selectedPage)}))}function r(){n(),document.body.classList.remove([e.openNav])}null!==t&&(document.querySelector(".elm-homepage-nav-show").addEventListener("click",(function(){document.body.classList.add(e.openNav)})),document.querySelector(".elm-homepage-nav-hide").addEventListener("click",r),ii(".elm-homepage-nav-expand").forEach((function(r){r.addEventListener("click",(function(r){r.preventDefault();var i=r.currentTarget.closest(".elm-homepage-nav-item");document.querySelector(".elm-homepage-nav-list-root").scrollTop=0,n(),i.classList.add(e.selectedPage),t.classList.add(e.detailedNav)}))})),document.querySelector(".elm-homepage-nav-back").addEventListener("click",n),document.addEventListener("click",(function(t){null===t.target.closest(e.getSelector("rootNav"))&&r()})))}}},zn)});["PageId","BaseHref","PageTitle","PageName","PageIsRedirect","PageLanguageCode","FollowRedirects","PathSkin","PathCommon","UserName","UserSystemName","UserIsAnonymous","UserPermissions","PageEditable","PageNamespace","CDNHostname","WebFontConfig","isDraftRequest","isDraftAllowed","isXhrF1WebWidgetEnabled","PageRevision","isSkinResponsive","attachFileMax","moduleMode"].forEach((function(e){var t=e[0].toLowerCase()+e.slice(1);"CDNHostname"===e&&(t="cdnHostname"),Ho[e]=Bn.get(t)}));var Wo,$o=["Article.Attach.table-description-blank","Article.Attach.table-description-character","Article.Attach.table-description-character-warning","Article.Attach.grid.empty-grid-text","Article.Attach.table-search-text","Article.Attach.table-header-file","Article.Attach.table-file-title","Article.Attach.table-description-button","Article.Attach.table-description-cancel","Article.Attach.menu.move","Article.Attach.menu.attachnew","Article.Attach.menu.delete","Article.Attach.menu.description","Article.Attach.table-header-date","Article.Attach.table-version-link","Article.Attach.table-header-size","Article.Attach.table-header-addedby"],Vo=_i($o,"Article.Attach"),Ko={descriptionCharLimit:500,currentCount:0,extensionList:["jpg","jpeg","jpe","gif","png","sh","txt","doc","zip","pdf","xls","csv","xlsx","xlsm","xltx","xltm","xlsb","xlam","ppt","pps","pptx","pptm","potx","potm","ppam","ppsx","ppsm","doc","rtf","txt","docx","docm","dotx","dotm","fla","swf","tar","rar","gzip","html","htm","shtml","wmv","avi","mov","mpg","mp4","mpeg","dwg","msg","dwf"],transIcon:dr.getCacheUrl("/skins/common/icons/icon-trans.gif"),filenameDom:function(e){return zr(zr({className:"file-name-row"},Ur({className:"icon mt-icon-".concat(e.extension)},Ir("img",{src:e.icon,className:"mt-ext-".concat(e.extension),alt:e.extension})),qr({className:"file-name-link",href:e.href,title:e.title,target:"_blank"},e.filename),e.editable&&zr({className:"file-attachment-actions"},e.movable&&qr({className:"ui-icon ui-icon-transferthick-e-w file-move-button file-attachment-action",title:e.moveMsg,href:"#"}),e.revisionAllowed&&qr({className:"ui-icon ui-icon-arrowthick-1-n file-revision-launcher file-attachment-action",title:e.uploadMsg,href:"#",dataset:{fileInfo:e.dataAttr,userTz:e.userTz,allowedExtensions:e.extensions}}),e.deleteAllowed&&qr({className:"ui-icon ui-icon-close file-delete-button file-attachment-action",title:e.deleteMsg,href:"#"}))),zr({className:"file-row-description"},Ur({className:"file-row-description-display"},e.noDescription?Ur({className:"note"},Wo(Vo.tableDescriptionBlank)):e.displayDescription),e.editable&&zr({className:"file-description-actions"},qr({href:"#",className:"ui-icon ui-icon-pencil file-row-description-edit",title:e.descriptionEditMsg})),e.editable&&zr({className:"file-row-description-editor"},Ir("input",{className:"file-row-description-text"}),zr({className:"file-row-description-buttons"},qr({href:"#",className:"ui-button ui-button-primary file-row-description-save"},e.buttonText),qr({href:"#",className:"ui-button file-row-description-cancel"},e.cancelText),Ur({className:"note file-row-description-charlimit"}," ",e.charLimitText)))))},transformRow:function(e){var t=e.filename,n=rr(t,".").toLowerCase();this.extensionList.includes(n)||(n="unknown");var r=tr(e.description);r=r.substring(0,this.descriptionCharLimit);var i="contents"in e?e.contents.size:e.size;return{id:e.id,filename:t,revision:e.revision,size:i,formattedSize:dr.formatBytes(i),date:e.lastModified||e.date,extension:n,user:"userCreatedBy"in e?er(e.userCreatedBy.fullname||e.userCreatedBy.username):e.user,uri:"contents"in e?e.contents.href:e.uri,revisions:e.revisions,noDescription:""===r,description:e.description,descriptionText:r}},getDescriptionWarning:function(e){var t="",n=this.descriptionCharLimit-e;return n<0?t=Wo(Vo.tableDescriptionCharacterWarning,or(-1*n,0)):n<=50&&(t=Wo(Vo.tableDescriptionCharacter,or(n,0))),t},updateCountInfo:function(){},attachRevisionClickListener:function(e,t){var n=t.querySelector(".file-revision-launcher");n&&n.addEventListener("click",(function(){Ko.launchRevisionDialog(e,t)}))},setUpGrid:function(){var e=this;return new Promise((function(t){var n=e,r={paginate:!1,showInfo:!1,enableSpinner:!0,responsive:Bn.get("isSkinResponsive"),emptyGridText:Wo(Vo.gridEmptyGridText),searchText:Wo(Vo.tableSearchText),dataSource:{_limit:e.options.attachFileMax,getData:function(){var e=Bn.get("pageId");return(Bn.get("isDraftRequest")?new Ie(e,_r):new Ut(e,_r)).getFiles({limit:this._limit}).then((function(e){return e.files}))}},colDefs:[{title:'<span class="mt-datatables-header-title">'.concat(Wo(Vo.tableHeaderFile),"</span>"),class:"file-name all control",width:"51%",formatter:function(e){var t=e.description,r=new cr(e.uri);r.addQueryParam("origin","mt-web");var i={filename:e.filename,extension:e.extension,title:Wo(Vo.tableFileTitle,e.filename,e.user),href:r.toString(),displayDescription:e.descriptionText,description:t,noDescription:e.noDescription,buttonText:Wo(Vo.tableDescriptionButton),cancelText:Wo(Vo.tableDescriptionCancel),charLimitText:n.getDescriptionWarning(t.length),moveMsg:Wo(Vo.menuMove),uploadMsg:Wo(Vo.menuAttachnew),deleteMsg:Wo(Vo.menuDelete),descriptionEditMsg:Wo(Vo.menuDescription),dataAttr:JSON.stringify(e),extensions:JSON.stringify(n.extensionList),editable:Bn.get("pageEditable"),movable:!Bn.get("isDraftRequest"),deleteAllowed:Bn.get("isDraftAllowed")&&Bn.get("isDraftRequest")||!Bn.get("isDraftAllowed")||Bn.get("pageEditable"),revisionAllowed:Bn.get("isDraftAllowed")&&Bn.get("isDraftRequest")||!Bn.get("isDraftAllowed")||Bn.get("pageEditable"),userTz:n.options.attachFileUserTz,icon:n.transIcon};return n.filenameDom(i).outerHTML}},{title:'<span class="mt-datatables-header-title">'.concat(Wo(Vo.tableHeaderDate),"</span>"),class:"file-date min-tablet-l",width:"19%",searchable:!1,formatter:function(e,t){if("display"===t){var r=n._gridWidget.isColumnVisible(1),i=ko(e.date);return 1!==e.revision&&1!==e.count&&Bn.get("pageEditable")&&r?'<div class="file-revision-wrapper"><a href="#" title="'.concat(Wo(Vo.tableVersionLink),'" class="file-version-link">').concat(i,"</a></div>"):"<div>".concat(i,"</div>")}return e.date.toISOString()}},{title:'<span class="mt-datatables-header-title">'.concat(Wo(Vo.tableHeaderSize),"</span>"),class:"file-size min-desktop",width:"12%",searchable:!1,formatter:function(e,t){return"display"===t?e.formattedSize:window.parseInt(e.size,10)}},{title:'<span class="mt-datatables-header-title">'.concat(Wo(Vo.tableHeaderAddedby),"</span>"),class:"file-addedby min-desktop",width:"18%",searchable:!1,formatter:function(e){return e.user}},{title:"hidden description column",class:"never",width:"0",searchable:!0,visible:!1,formatter:function(e){return e.description}}],onRowAdd:function(e,t){Ko.attachRevisionClickListener(t.data,t.tr)},onGridDraw:function(){Ko.updateCountInfo()},transformData:function(e){return e&&!Array.isArray(e)&&(e=[e]),0===e.length?[]:e.map((function(e){return Ko.transformRow(e)}))},afterCreate:function(){t()}};e._gridWidget=va(r,Ko.$grid)}))}};$((function(){Ko.$grid=$("#fileAttachTable"),0!==Ko.$grid.length&&0!==Bn.get("pageId")&&(Wo=ki("mt-localizations-file-attachments",$o),0===Ko.$grid.length&&$(".dataTables_scrollHeadInner").css("width","100% !important"),Ko.options=Ko.$grid.data(),Ko.gridSetupComplete=Ko.setUpGrid())})),$((function(){function e(e,t,n){var r=$(e);t.init(n),r.trigger("dialoginit")}$(".feedback-popup-trigger").on("click",(function(t){t.preventDefault();var n=JSON.parse($(this).attr("feedbackparams"))||{};$("<div></div>").modal({width:450,naming:{view:"page_feedback",namespace:"PageFeedback"},load:function(){var t=this;"context"in n||(n.context="generic"),dr.importModule({path:"/@lib/src/standalone/dialog.pageFeedback.js",moduleName:"pageFeedbackDialog"}).then((function(r){e(t,r,n)}))},params:n})})),$(document).on(Jr.Rating.NegativeFeedbackLeft,(function(t,n){$("<div></div>").modal({width:450,naming:{view:"page_feedback",namespace:"PageFeedback"},load:function(){var t=this;"context"in n||(n.context="generic"),dr.importModule({path:"/@lib/src/standalone/dialog.pageFeedback.js",moduleName:"pageFeedbackDialog"}).then((function(r){e(t,r,n)}))},params:n})})),$(".page-pdf-export-launcher").on("click",(function(t){t.preventDefault();var n=$(this).attr("href");$("<div></div>").modal({width:425,naming:{view:"pdf_export",namespace:"PagePdfExport"},load:function(){var t=this;dr.importModule({path:"/@lib/src/standalone/dialog.pdfExport.js",moduleName:"pdfExportDialog"}).then((function(r){e(t,r,{uri:n})}))}})}))}));var Go=Object.assign(Ho,{Ui:Object.assign(Ho.Ui,{FileAttachments:Ko})});window.Deki=Go}();